# 索引创建清单（按集合名称排序）

> **使用说明**：按照集合名称字母顺序排列，便于逐个创建  
> **索引总数**：26个索引，分布在6个集合中  
> **操作方式**：云开发控制台 → 数据库 → 选择集合 → 索引管理 → 添加索引

---

## 📋 索引创建总览

| 集合名称 | 索引数量 | 完成状态 |
|---------|---------|---------|
| artist_applications | 3个 | ⬜ |
| income_ledger | 4个 | ⬜ |
| orders | 10个 | ⬜ |
| products | 4个 | ⬜ |
| users | 2个 | ⬜ |
| withdraw_records | 3个 | ⬜ |
| **总计** | **26个** | ⬜ |

---

## 1️⃣ artist_applications（画师申请表）- 3个索引

### 索引1.1：userId（唯一索引）

**字段名称**：`userId`  
**排序方向**：升序  
**是否唯一**：✅ 是  
**用途说明**：快速查找某个用户的申请记录，确保一个用户只能提交一次申请

**创建步骤**：
1. 点击 `artist_applications` 集合
2. 点击"索引管理"标签
3. 点击"添加索引"
4. 切换到"JSON"模式
5. 粘贴：`{"keys": {"userId": 1}, "unique": true}`
6. 点击确定

---

### 索引1.2：artistNumber（唯一索引）

**字段名称**：`artistNumber`  
**排序方向**：升序  
**是否唯一**：✅ 是  
**用途说明**：快速查找某个画师编号，确保画师编号唯一（001, 002, 003...）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"artistNumber": 1}, "unique": true}`
4. 点击确定

---

### 索引1.3：status

**字段名称**：`status`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：按状态筛选申请（pending待审核、approved已通过、rejected已拒绝）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"status": 1}}`
4. 点击确定

✅ **artist_applications 集合索引创建完成！应有3个索引。**

---

## 2️⃣ income_ledger（收入账本）- 4个索引

### 索引2.1：userId

**字段名称**：`userId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：查询某个用户的所有收入记录

**创建步骤**：
1. 点击 `income_ledger` 集合
2. 点击"索引管理"标签
3. 点击"添加索引"
4. 切换到"JSON"模式
5. 粘贴：`{"keys": {"userId": 1}}`
6. 点击确定

---

### 索引2.2：orderId

**字段名称**：`orderId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：查询某个订单产生的收入记录（一个订单可能产生多条收入：客服分成、管理员分成等）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"orderId": 1}}`
4. 点击确定

---

### 索引2.3：incomeType

**字段名称**：`incomeType`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：按收入类型筛选（service客服分成、admin_share管理员分成、reward打赏）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"incomeType": 1}}`
4. 点击确定

---

### 索引2.4：createTime（倒序）

**字段名称**：`createTime`  
**排序方向**：倒序（-1）  
**是否唯一**：❌ 否  
**用途说明**：按时间倒序排列收入记录，最新的记录排在前面

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"createTime": -1}}`
4. 点击确定

✅ **income_ledger 集合索引创建完成！应有4个索引。**

---

## 3️⃣ orders（订单表）- 10个索引 ⭐ 最重要

### 索引3.1：orderId（唯一索引）

**字段名称**：`orderId`  
**排序方向**：升序  
**是否唯一**：✅ 是  
**用途说明**：订单号唯一索引，快速查找特定订单

**创建步骤**：
1. 点击 `orders` 集合
2. 点击"索引管理"标签
3. 点击"添加索引"
4. 切换到"JSON"模式
5. 粘贴：`{"keys": {"orderId": 1}, "unique": true}`
6. 点击确定

---

### 索引3.2：buyerId

**字段名称**：`buyerId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：买家查看自己的订单列表

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"buyerId": 1}}`
4. 点击确定

---

### 索引3.3：artistId

**字段名称**：`artistId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：画师查看分配给自己的订单

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"artistId": 1}}`
4. 点击确定

---

### 索引3.4：serviceId

**字段名称**：`serviceId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：客服查看分配给自己的订单

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"serviceId": 1}}`
4. 点击确定

---

### 索引3.5：status

**字段名称**：`status`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：按订单状态筛选（unpaid待支付、inProgress进行中、completed已完成等）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"status": 1}}`
4. 点击确定

---

### 索引3.6：createTime（倒序）

**字段名称**：`createTime`  
**排序方向**：倒序（-1）  
**是否唯一**：❌ 否  
**用途说明**：按下单时间倒序排列，最新订单排在前面

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"createTime": -1}}`
4. 点击确定

---

### 索引3.7：deadline

**字段名称**：`deadline`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：按截稿时间排序，用于计算临近截稿和脱稿订单

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"deadline": 1}}`
4. 点击确定

---

### 索引3.8：status + createTime（复合索引）

**字段组合**：`status` + `createTime`  
**排序方向**：status升序 + createTime倒序  
**是否唯一**：❌ 否  
**用途说明**：查询某状态的订单并按时间倒序排列（如"查看所有进行中的订单，最新的在前"）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"status": 1, "createTime": -1}}`
4. 点击确定

---

### 索引3.9：buyerId + status（复合索引）

**字段组合**：`buyerId` + `status`  
**排序方向**：均为升序  
**是否唯一**：❌ 否  
**用途说明**：买家查询自己特定状态的订单（如"我的进行中订单"）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"buyerId": 1, "status": 1}}`
4. 点击确定

---

### 索引3.10：artistId + status（复合索引）

**字段组合**：`artistId` + `status`  
**排序方向**：均为升序  
**是否唯一**：❌ 否  
**用途说明**：画师查询自己特定状态的订单（如"我的待处理订单"）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"artistId": 1, "status": 1}}`
4. 点击确定

✅ **orders 集合索引创建完成！应有10个索引。**

---

## 4️⃣ products（商品表）- 4个索引

### 索引4.1：productId（唯一索引）

**字段名称**：`productId`  
**排序方向**：升序  
**是否唯一**：✅ 是  
**用途说明**：商品ID唯一索引，快速查找特定商品

**创建步骤**：
1. 点击 `products` 集合
2. 点击"索引管理"标签
3. 点击"添加索引"
4. 切换到"JSON"模式
5. 粘贴：`{"keys": {"productId": 1}, "unique": true}`
6. 点击确定

---

### 索引4.2：artistId

**字段名称**：`artistId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：查询某个画师的所有商品

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"artistId": 1}}`
4. 点击确定

---

### 索引4.3：categoryId

**字段名称**：`categoryId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：按分类筛选商品

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"categoryId": 1}}`
4. 点击确定

---

### 索引4.4：status

**字段名称**：`status`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：按上架状态筛选商品（active已上架、inactive已下架）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"status": 1}}`
4. 点击确定

✅ **products 集合索引创建完成！应有4个索引。**

---

## 5️⃣ users（用户表）- 2个索引

### 索引5.1：userId（唯一索引）

**字段名称**：`userId`  
**排序方向**：升序  
**是否唯一**：✅ 是  
**用途说明**：用户ID唯一索引，快速查找特定用户

**创建步骤**：
1. 点击 `users` 集合
2. 点击"索引管理"标签
3. 点击"添加索引"
4. 切换到"JSON"模式
5. 粘贴：`{"keys": {"userId": 1}, "unique": true}`
6. 点击确定

---

### 索引5.2：openid（唯一索引）

**字段名称**：`openid`  
**排序方向**：升序  
**是否唯一**：✅ 是  
**用途说明**：微信openid唯一索引，用于权限验证和用户查找

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"openid": 1}, "unique": true}`
4. 点击确定

✅ **users 集合索引创建完成！应有2个索引。**

---

## 6️⃣ withdraw_records（提现记录）- 3个索引

### 索引6.1：userId

**字段名称**：`userId`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：查询某个用户的所有提现记录

**创建步骤**：
1. 点击 `withdraw_records` 集合
2. 点击"索引管理"标签
3. 点击"添加索引"
4. 切换到"JSON"模式
5. 粘贴：`{"keys": {"userId": 1}}`
6. 点击确定

---

### 索引6.2：status

**字段名称**：`status`  
**排序方向**：升序  
**是否唯一**：❌ 否  
**用途说明**：按提现状态筛选（pending待审核、processing处理中、completed已完成、rejected已拒绝）

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"status": 1}}`
4. 点击确定

---

### 索引6.3：time（倒序）

**字段名称**：`time`  
**排序方向**：倒序（-1）  
**是否唯一**：❌ 否  
**用途说明**：按提现时间倒序排列，最新的提现记录排在前面

**创建步骤**：
1. 点击"添加索引"
2. 切换到"JSON"模式
3. 粘贴：`{"keys": {"time": -1}}`
4. 点击确定

✅ **withdraw_records 集合索引创建完成！应有3个索引。**

---

## ✅ 索引创建完成检查清单

### 逐个集合检查

- [ ] **artist_applications**：3个索引（userId唯一、artistNumber唯一、status）
- [ ] **income_ledger**：4个索引（userId、orderId、incomeType、createTime倒序）
- [ ] **orders**：10个索引（orderId唯一、buyerId、artistId、serviceId、status、createTime倒序、deadline、3个复合索引）
- [ ] **products**：4个索引（productId唯一、artistId、categoryId、status）
- [ ] **users**：2个索引（userId唯一、openid唯一）
- [ ] **withdraw_records**：3个索引（userId、status、time倒序）

### 索引数量统计

| 集合名称 | 应有索引数 | 实际索引数 | 状态 |
|---------|-----------|-----------|------|
| artist_applications | 3 | ___ | ⬜ |
| income_ledger | 4 | ___ | ⬜ |
| orders | 10 | ___ | ⬜ |
| products | 4 | ___ | ⬜ |
| users | 2 | ___ | ⬜ |
| withdraw_records | 3 | ___ | ⬜ |
| **总计** | **26** | ___ | ⬜ |

---

## 📝 操作技巧

### 快速创建流程

1. **打开集合**：点击左侧集合名称
2. **进入索引管理**：点击"索引管理"标签
3. **添加索引**：点击"添加索引"按钮
4. **切换模式**：切换到"JSON"模式（更快捷）
5. **粘贴配置**：复制本文档中的JSON配置，粘贴到输入框
6. **确认创建**：点击"确定"按钮
7. **检查结果**：索引列表中应该出现新创建的索引
8. **继续下一个**：重复步骤3-7，直到该集合的所有索引创建完成

### 常见问题

**Q：创建索引时提示"字段不存在"？**  
A：这是正常的！索引可以提前创建，等数据插入时会自动使用。

**Q：索引名称显示为 `userId_1` 而不是 `userId`？**  
A：这是正常的！微信云数据库会自动给索引命名，不影响使用。

**Q：唯一索引是什么意思？**  
A：表示该字段的值必须唯一，不能重复。例如：
- `userId` 唯一 → 每个用户只有一个ID
- `orderId` 唯一 → 每个订单只有一个订单号

**Q：倒序（-1）和升序（1）有什么区别？**  
A：
- `1` = 升序：从小到大（A→Z，1→9，旧→新）
- `-1` = 倒序：从大到小（Z→A，9→1，新→旧）
- 例如：`createTime: -1` 表示按时间倒序，最新的数据排在前面

**Q：复合索引是什么？**  
A：包含多个字段的索引，可以加速组合查询。例如：
- `{status: 1, createTime: -1}` 
- 可以加速查询"某状态的订单按时间倒序排列"

**Q：创建索引需要多久？**  
A：
- 集合为空：1-2秒
- 集合有数据：几秒到几分钟（取决于数据量）

---

## 🎯 创建顺序建议

### 推荐顺序（按重要性）

1. **users**（2个） - 用户相关的基础
2. **orders**（10个） - 订单是核心业务
3. **products**（4个） - 商品展示需要
4. **artist_applications**（3个） - 画师管理
5. **income_ledger**（4个） - 财务数据
6. **withdraw_records**（3个） - 提现管理

### 预计用时

- **users**: 2分钟
- **orders**: 10分钟（最多）
- **products**: 4分钟
- **artist_applications**: 3分钟
- **income_ledger**: 4分钟
- **withdraw_records**: 3分钟

**总计**：约25-30分钟

---

**完成后告诉我："所有索引创建完成"** 🎉

