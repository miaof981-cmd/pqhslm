# 🔴 客服工作台进度条显示问题分析报告

## 📋 问题描述

**症状**：客服工作台的订单进度条**完全不显示**
- ❌ 没有渐变背景色（绿色/橙色/红色）
- ❌ 没有显示"下单时间"和"截稿时间"
- ❌ 进度条只有一条细线，没有填充

**期望**：应该像画师工作台一样，显示：
- ✅ 完整的进度条背景（带渐变）
- ✅ 下单时间和截稿时间
- ✅ 根据状态显示不同颜色的进度条填充

---

## 🔍 根本原因

### 核心问题：字段名不匹配

| 数据源 | 字段名 | 说明 |
|--------|--------|------|
| **订单数据**（order-success保存） | `createTime` | 实际保存的字段 |
| **客服工作台**（service-workspace读取） | `order.createdAt` | 错误的字段名 |
| **画师工作台**（workspace使用） | `order.createTime` | 正确使用硬编码数据 |

### 详细分析

#### 1. **订单保存逻辑**（order-success/index.js）

```javascript
// 第 142-144 行
const newOrder = {
  // ... 其他字段
  createTime: orderInfo.createTime,  // ✅ 保存为 createTime
  deadline: orderInfo.deadline,      // ✅ 保存为 deadline
  // ...
}
```

#### 2. **客服工作台读取逻辑**（service-workspace/index.js）

```javascript
// 第 113-114 行 ❌ 错误
const finalOrders = processedOrders.map(order => {
  return {
    ...order,
    createTime: this.formatTime(order.createdAt),  // ❌ 读取 createdAt（不存在！）
    deadline: this.formatTime(order.deadline)      // ✅ 读取 deadline（正确）
  }
})
```

**结果**：
- `order.createdAt` → `undefined`
- `this.formatTime(undefined)` → `''` (空字符串)
- WXML 中 `{{item.createTime}}` → 显示为空

#### 3. **画师工作台为什么正常**

画师工作台使用的是**硬编码的测试数据**（第20-103行）：

```javascript
pendingOrders: [
  {
    id: '202510260001',
    productName: 'Q版头像',
    createTime: '10-25 14:32',  // ✅ 直接硬编码格式化好的字符串
    deadline: '10-30 23:59',    // ✅ 直接硬编码格式化好的字符串
    // ...
  }
]
```

所以画师工作台**没有经过 formatTime 转换**，直接使用了已经格式化好的字符串。

---

## 🐛 连锁问题

### 问题 1：进度百分比计算错误

```javascript
// service-workspace/index.js 第 159-172 行
calculateProgressPercent(order) {
  if (!order.createdAt || !order.deadline) return 0  // ❌ 使用 createdAt
  
  const createTime = new Date(order.createdAt).getTime()  // ❌ 读取不存在的字段
  const deadline = new Date(order.deadline).getTime()
  // ...
}
```

**结果**：
- `order.createdAt` → `undefined`
- `new Date(undefined).getTime()` → `NaN`
- `progressPercent` → `0`
- 进度条宽度 → `width: 0%` → **不可见**

### 问题 2：业务状态判断错误

```javascript
// service-workspace/index.js 第 135-156 行
getBusinessStatus(order) {
  if (!order.deadline) return ''  // ✅ deadline 存在
  
  const now = Date.now()
  const deadline = new Date(order.deadline).getTime()  // ✅ 正确
  const diffTime = deadline - now
  
  // ...判断逻辑
}
```

这个函数**只依赖 deadline**，所以还能部分工作。

但是 `orderStatusUtil.calculateOrdersStatus()` 内部也需要 `createdAt` 或 `createTime` 来计算状态！

---

## 🔧 解决方案

### 修改文件：`miniprogram/pages/service-workspace/index.js`

#### 修改 1：统一使用 `createTime` 字段（第 113 行）

```javascript
// 修改前 ❌
createTime: this.formatTime(order.createdAt),

// 修改后 ✅
createTime: this.formatTime(order.createTime),
```

#### 修改 2：修复进度计算（第 159-160 行）

```javascript
// 修改前 ❌
calculateProgressPercent(order) {
  if (!order.createdAt || !order.deadline) return 0
  
  const createTime = new Date(order.createdAt).getTime()
  // ...
}

// 修改后 ✅
calculateProgressPercent(order) {
  if (!order.createTime || !order.deadline) return 0
  
  const createTime = new Date(order.createTime).getTime()
  // ...
}
```

---

## 📊 影响范围

| 工作台 | createTime | deadline | 进度条 | 状态 |
|--------|-----------|----------|--------|------|
| **画师工作台** | ✅ 硬编码 | ✅ 硬编码 | ✅ 正常 | ✅ 正常 |
| **客服工作台** | ❌ createdAt | ✅ deadline | ❌ 不显示 | ⚠️ 部分错误 |
| **管理后台** | ⚠️ 未检查 | ⚠️ 未检查 | ⚠️ 待验证 | ⚠️ 待验证 |

---

## ✅ 修复后验证

修复后，客服工作台应该能正确显示：

1. **下单时间**：`10月30日 15:29` 格式
2. **截稿时间**：`11月6日 15:29` 格式  
3. **进度条背景**：
   - 正常：淡绿色 `#F8FFF9 → #F0F9F1`
   - 临近截稿：淡橙色 `#FFF8E1 → #FFECB3`
   - 已拖稿：淡红色 `#FFEBEE → #FFCDD2`
4. **进度条填充**：
   - 正常：绿色渐变 `#A5D6A7 → #66BB6A → #4CAF50`
   - 临近截稿：橙色渐变 `#FFCC80 → #FFA726 → #FF9800`
   - 已拖稿：红色渐变 `#FFAB91 → #FF6B6B → #E53935`
5. **进度百分比**：根据实际时间计算，例如 7天订单过了3天 → 42.86%

---

## 📝 总结

**根本原因**：
- 订单数据保存时使用 `createTime`
- 客服工作台读取时使用 `createdAt`
- 字段名不匹配导致读取为 `undefined`
- 最终导致进度条完全不显示

**教训**：
- 统一字段命名规范
- 画师工作台应该也使用真实订单数据，而不是硬编码
- 所有工作台应该使用相同的数据读取逻辑

**下一步**：
1. 修复客服工作台的字段名
2. 检查管理后台是否有同样问题
3. 将画师工作台改为使用真实订单数据

