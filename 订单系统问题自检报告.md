# 订单系统问题自检报告

## 🔍 问题1：时间线视觉效果弱

### 现状
- 进度条（线条）太细
- 时间点不够突出
- 整体视觉引导不明确

### 解决方案
- 增加线条粗细：2rpx → 6rpx
- 增大圆点尺寸：24rpx → 32rpx
- 增加时间文字大小
- 添加背景卡片效果

---

## 🔍 问题2：画师显示"待分配"

### 数据流检查

**步骤1：商品创建**
- ✅ 已添加 artistName 保存逻辑
- ❌ 但旧商品没有 artistName

**步骤2：购物车**
- ❌ 购物车项可能没有 artistName（旧数据）

**步骤3：订单保存**
- ✅ 已接收 artistName 参数
- ❌ 但如果参数为空，会使用默认值

### 根本原因
**旧商品数据没有 artistName 字段！**

### 解决方案
1. 读取商品时，如果没有 artistName，使用当前用户信息
2. 兜底逻辑：从用户信息获取昵称

---

## 🔍 问题3：截稿时间显示"Invalid Date"

### 数据流检查

**createTime 格式**
```javascript
// 订单成功页生成
createTime: "2025/10/27下午02:11:43"
```

**calculateDeadline 接收**
```javascript
new Date("2025/10/27下午02:11:43")  // ❌ 无法解析中文"下午"
```

### 根本原因
**toLocaleString 生成的中文日期格式无法被 new Date() 解析！**

### 解决方案
使用 ISO 格式或统一的日期格式：
```javascript
// 改为：
createTime: new Date().toISOString()
// 或：
createTime: "2025-10-27 14:11:43"
```

---

## 🔍 问题4：商品图片不显示

### 数据流检查

**商品创建**
- images: ["http://tmp/..."] ✅

**购物车**
- productImage: images[0] ✅

**订单**
- productImage: "http://tmp/..." ✅

### 可能原因
1. 临时文件路径过期
2. 图片未正确传递
3. 图片路径编码问题

### 检查方法
控制台输出订单的 productImage 字段

---

## 🔍 问题5：订单号生成逻辑

### 当前逻辑
```javascript
generateOrderNo() {
  const year = now.getFullYear()
  const month = String(now.getMonth() + 1).padStart(2, '0')
  const day = String(now.getDate()).padStart(2, '0')
  const hours = String(now.getHours()).padStart(2, '0')
  const minutes = String(now.getMinutes()).padStart(2, '0')
  const seconds = String(now.getSeconds()).padStart(2, '0')
  const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0')
  
  return `${year}${month}${day}${hours}${minutes}${seconds}${random}`
}
```

### 格式
`20251027141436404`
- 前14位：年月日时分秒
- 后4位：随机数（0-9999）

### 重复概率分析
- 同一秒内：10000个订单才会重复
- 实际场景：单用户小程序，几乎不可能重复

### 结论
✅ 订单号生成逻辑正常，不会重复

---

## 🎯 修复优先级

1. **高优先级**
   - 截稿时间格式（影响功能）
   - 画师信息兜底逻辑（影响显示）

2. **中优先级**
   - 时间线视觉强化（影响体验）
   - 商品图片显示（需排查）

3. **低优先级**
   - 订单号格式（无问题）

