# 画师申请流程说明

## 完整业务链路

### 1. 普通用户 → 申请成为画师

```
┌─────────────────────────────────────────────────┐
│ 第一步：进入申请页面                              │
├─────────────────────────────────────────────────┤
│ 方式1：首页底部 → 点击"画师认证"                  │
│ 方式2：点击"工作台" → 提示无权限 → 点击"去申请"   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│ 第二步：填写申请表单                              │
├─────────────────────────────────────────────────┤
│ • 姓名（必填）                                    │
│ • 联系方式（必填）                                │
│ • 擅长类型（选填）                                │
│ • 上传作品图片（必填，最多9张）                    │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│ 第三步：提交申请                                  │
├─────────────────────────────────────────────────┤
│ • 系统验证表单完整性                              │
│ • 提交到后端（目前是模拟提交）                     │
│ • 显示"申请提交成功"                              │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│ 第四步：等待管理员审核                            │
├─────────────────────────────────────────────────┤
│ • 管理员在"管理后台"查看申请                       │
│ • 审核通过 → 为用户添加artist权限                 │
│ • 审核驳回 → 通知用户原因                         │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│ 第五步：成为画师                                  │
├─────────────────────────────────────────────────┤
│ • 用户中心显示"工作台"入口                         │
│ • 可以进入画师工作台                              │
│ • 可以上传商品、管理订单                          │
└─────────────────────────────────────────────────┘
```

## 当前实现状态

### ✅ 已实现

1. **申请页面** (`/pages/apply/index`)
   - 表单输入（姓名、电话、擅长类型）
   - 图片上传（最多9张）
   - 表单验证
   - 模拟提交

2. **权限检查**
   - 工作台入口权限验证
   - 无权限时显示引导
   - 提供"去申请"快捷入口

3. **工作台**
   - 画师工作台（数据统计、订单管理、商品管理、打赏记录）
   - 客服工作台（订单管理、咨询记录）

### ⚠️ 待完善（需要接入后端）

1. **申请提交**
   - 目前是模拟提交，需要调用云函数
   - 需要上传图片到云存储
   - 需要保存申请记录到数据库

2. **管理员审核**
   - 管理后台需要添加"画师申请审核"页面
   - 审核通过后更新用户权限
   - 发送审核结果通知

3. **权限管理**
   - 目前权限存储在本地（测试用）
   - 需要从云数据库读取用户权限
   - 需要实现权限同步机制

## 测试方法

### 测试1：普通用户申请画师

```javascript
// 1. 清空权限（模拟普通用户）
wx.setStorageSync('userRoles', ['customer'])

// 2. 进入首页，点击"画师认证"
// 3. 填写表单并提交
// 4. 提交成功后，模拟管理员审核通过

// 5. 手动添加画师权限
wx.setStorageSync('userRoles', ['customer', 'artist'])

// 6. 返回用户中心，点击"工作台"
// 7. 应该能看到画师工作台
```

### 测试2：无权限访问工作台

```javascript
// 1. 清空权限
wx.setStorageSync('userRoles', ['customer'])

// 2. 点击"工作台"
// 3. 应该看到：
//    - 弹窗提示"权限不足"
//    - 页面显示无权限提示
//    - 提供"去申请"按钮
```

### 测试3：画师权限正常使用

```javascript
// 1. 设置画师权限
wx.setStorageSync('userRoles', ['artist'])

// 2. 点击"工作台"
// 3. 应该看到：
//    - 显示"画师工作台"标题
//    - 4个快捷功能
//    - 待处理订单统计
//    - 推广链接
```

## 数据库设计（待实现）

### 画师申请表 (artist_applications)

```javascript
{
  _id: 'auto',
  userId: 'user_openid',
  userName: '张三',
  phone: '13800138000',
  specialty: '头像设计',
  portfolio: [
    'cloud://xxx/portfolio1.jpg',
    'cloud://xxx/portfolio2.jpg'
  ],
  status: 'pending', // pending/approved/rejected
  applyTime: '2024-10-26 12:00:00',
  reviewTime: '',
  reviewBy: '',
  reviewNote: '',
  createTime: '2024-10-26 12:00:00',
  updateTime: '2024-10-26 12:00:00'
}
```

### 用户权限表 (users)

```javascript
{
  _id: 'auto',
  openid: 'user_openid',
  userId: 1001, // 自增ID
  roles: ['customer', 'artist'], // 用户角色数组
  artistInfo: {
    name: '张三',
    phone: '13800138000',
    specialty: '头像设计',
    approvedTime: '2024-10-26 12:00:00'
  },
  createTime: '2024-10-26 12:00:00',
  updateTime: '2024-10-26 12:00:00'
}
```

## 云函数设计（待实现）

### 1. submitArtistApplication (提交画师申请)

```javascript
// 输入
{
  name: '张三',
  phone: '13800138000',
  specialty: '头像设计',
  portfolio: ['temp://xxx1.jpg', 'temp://xxx2.jpg']
}

// 输出
{
  success: true,
  message: '申请提交成功',
  applicationId: 'app_xxx'
}
```

### 2. reviewArtistApplication (审核画师申请)

```javascript
// 输入
{
  applicationId: 'app_xxx',
  action: 'approve', // approve/reject
  note: '审核通过'
}

// 输出
{
  success: true,
  message: '审核成功'
}
```

### 3. getUserRoles (获取用户权限)

```javascript
// 输入
{
  openid: 'user_openid'
}

// 输出
{
  success: true,
  roles: ['customer', 'artist'],
  userId: 1001
}
```

## 下一步开发计划

### 阶段1：完善申请流程（优先级：高）

1. 创建云函数 `submitArtistApplication`
2. 实现图片上传到云存储
3. 保存申请记录到数据库
4. 发送申请成功通知

### 阶段2：管理员审核（优先级：高）

1. 管理后台添加"画师申请"页面
2. 显示待审核申请列表
3. 实现审核通过/驳回功能
4. 审核通过后自动添加artist权限

### 阶段3：权限同步（优先级：中）

1. 创建云函数 `getUserRoles`
2. 小程序启动时从云端同步权限
3. 移除本地权限管理（仅用于测试）
4. 实现权限缓存机制

### 阶段4：通知系统（优先级：低）

1. 申请提交成功通知
2. 审核结果通知
3. 订单状态变更通知
4. 系统公告推送

## 常见问题

### Q1: 为什么点击"工作台"还是能看到页面？

**A**: 已修复。现在无权限时会显示专门的"无权限提示"页面，不会显示工作台内容。

### Q2: 如何测试画师权限？

**A**: 在控制台执行：
```javascript
wx.setStorageSync('userRoles', ['artist'])
```

### Q3: 申请提交后为什么没有变化？

**A**: 目前是模拟提交，需要手动添加权限。正式版会由管理员审核后自动添加。

### Q4: 管理员如何审核申请？

**A**: 管理员从"用户中心" → "管理后台" → "画师管理"（待开发）查看和审核申请。

### Q5: 客服权限如何获得？

**A**: 客服权限由管理员直接在后台分配，不需要申请流程。

## 总结

整个业务链路设计完整，核心流程清晰：

1. **申请入口**：首页"画师认证"或工作台"去申请"
2. **申请流程**：填写表单 → 上传作品 → 提交申请
3. **审核流程**：管理员审核 → 通过/驳回
4. **权限生效**：审核通过 → 添加权限 → 可访问工作台

目前前端流程已完善，待接入后端后即可正式使用。

