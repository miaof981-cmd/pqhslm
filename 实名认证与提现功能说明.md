# å®åè®¤è¯ä¸æç°åŠŸèƒ½è¯´æ˜

## âœ… å·²å®ŒæˆåŠŸèƒ½

### ä¸€ã€å®åè®¤è¯æ¨¡å—

**é¡µé¢è·¯å¾„**ï¼š`pages/identity-verify/index`

#### åŠŸèƒ½æ¸…å•
1. âœ… å®åä¿¡æ¯é‡‡é›†
   - çœŸå®å§“å
   - èº«ä»½è¯å·ï¼ˆå¸¦æ ¡éªŒï¼‰
   - é“¶è¡Œå¡å·ï¼ˆ16-19ä½ï¼‰
   - å¼€æˆ·é“¶è¡Œï¼ˆ15å®¶ä¸»æµé“¶è¡Œï¼‰
   - æ”¯è¡Œåç§°
   - é¢„ç•™æ‰‹æœºå·
   - çŸ­ä¿¡éªŒè¯ç ï¼ˆæ¨¡æ‹Ÿï¼‰

2. âœ… è¡¨å•éªŒè¯
   - èº«ä»½è¯æ ¼å¼æ ¡éªŒ
   - é“¶è¡Œå¡å·æ ¡éªŒ
   - æ‰‹æœºå·æ ¡éªŒ
   - çŸ­ä¿¡éªŒè¯ç æ ¡éªŒï¼ˆæµ‹è¯•ç ï¼š123456ï¼‰

3. âœ… è®¤è¯çŠ¶æ€ç®¡ç†
   - æœªè®¤è¯ï¼šæ˜¾ç¤ºè¡¨å•
   - å·²è®¤è¯ï¼šæ˜¾ç¤ºè®¤è¯ä¿¡æ¯ï¼ˆè„±æ•ï¼‰

4. âœ… æ•°æ®å­˜å‚¨
   - å­˜å‚¨é”®ï¼š`identity_verify_records`
   - æ•°æ®ç»“æ„ï¼šè§ä¸‹æ–¹

---

### äºŒã€æç°åŠŸèƒ½æ”¹é€ 

#### æç°æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»æç°æŒ‰é’®
  â†“
æ£€æŸ¥å®åè®¤è¯çŠ¶æ€
  â†“ æœªè®¤è¯
è·³è½¬å®åè®¤è¯é¡µé¢
  â†“ å·²è®¤è¯
æ˜¾ç¤ºæç°å¼¹çª—
  â†“
è¾“å…¥æç°é‡‘é¢
  â†“
è°ƒç”¨æç°APIï¼ˆwithdraw-api.jsï¼‰
  â†“
åˆ›å»ºæç°è®°å½•ï¼ˆstatus='pending'ï¼‰
  â†“
ğŸ¯ æ¨¡æ‹Ÿè‡ªåŠ¨æˆåŠŸï¼ˆ3ç§’åstatus='success'ï¼‰
  â†“
æ‰£å‡ç”¨æˆ·ä½™é¢
å‘é€æˆåŠŸé€šçŸ¥
```

#### ä¿®æ”¹å†…å®¹
1. âœ… æç°å‰å¼ºåˆ¶æ£€æŸ¥å®åè®¤è¯
2. âœ… æç°è®°å½•å¢åŠ å­—æ®µï¼š
   - `realName` - æç°äººå§“å
   - `bankCard` - é“¶è¡Œå¡å°¾å·
   - `bankName` - å¼€æˆ·é“¶è¡Œ
   - `apiOrderId` - APIè®¢å•å·
   - `apiStatus` - APIè¿”å›çŠ¶æ€
   - `apiMessage` - APIæ¶ˆæ¯
   - `completedTime` - å®Œæˆæ—¶é—´

3. âœ… æ¨¡æ‹Ÿè‡ªåŠ¨æç°æˆåŠŸï¼ˆå¼€å‘ç¯å¢ƒï¼‰

---

### ä¸‰ã€APIå¯¹æ¥å±‚

**æ–‡ä»¶è·¯å¾„**ï¼š`utils/withdraw-api.js`

#### æ¥å£æ¸…å•

##### 1. æäº¤å®åè®¤è¯
```javascript
submitIdentityVerify(data)
// å¼€å‘ç¯å¢ƒï¼š1.5ç§’åè¿”å›æˆåŠŸ
// ç”Ÿäº§ç¯å¢ƒï¼šå¯¹æ¥åç«¯æ¥å£
```

##### 2. æäº¤æç°ç”³è¯·
```javascript
submitWithdrawRequest(data)
// å¼€å‘ç¯å¢ƒï¼š1.5ç§’åè¿”å›æˆåŠŸ
// ç”Ÿäº§ç¯å¢ƒï¼šå¯¹æ¥åˆ†è´¦å…¬å¸æ¥å£
```

##### 3. æŸ¥è¯¢æç°çŠ¶æ€
```javascript
queryWithdrawStatus(orderId)
// å¼€å‘ç¯å¢ƒï¼š0.5ç§’åè¿”å›æˆåŠŸ
// ç”Ÿäº§ç¯å¢ƒï¼šå¯¹æ¥æŸ¥è¯¢æ¥å£
```

##### 4. æ¨¡æ‹Ÿè‡ªåŠ¨æˆåŠŸ
```javascript
mockAutoWithdrawSuccess(recordId, callback)
// ğŸ¯ å¼€å‘ç¯å¢ƒä¸“ç”¨
// 3ç§’åè‡ªåŠ¨å°†pendingæ”¹ä¸ºsuccess
```

---

### å››ã€ç”¨æˆ·ä¸­å¿ƒå…¥å£

**é¡µé¢è·¯å¾„**ï¼š`pages/user-center/index`

#### æ–°å¢å†…å®¹
1. âœ… å®åè®¤è¯å…¥å£ï¼ˆå…¶ä»–åŠŸèƒ½åŒºï¼‰
2. âœ… æ˜¾ç¤ºè®¤è¯çŠ¶æ€ï¼ˆâœ“ å·²è®¤è¯ï¼‰
3. âœ… è‡ªåŠ¨æ£€æŸ¥è®¤è¯çŠ¶æ€

---

## ğŸ“Š æ•°æ®ç»“æ„

### 1. å®åè®¤è¯è®°å½•
```javascript
identity_verify_records = [
  {
    id: 1730918400000,
    userId: '1001',
    status: 'verified', // verified/pending/rejected/unverified
    realName: 'å¼ ä¸‰',
    idCard: '110101199001011234',
    bankCard: '6217000000000000000',
    bankName: 'ä¸­å›½é“¶è¡Œ',
    bankBranch: 'åŒ—äº¬æœé˜³æ”¯è¡Œ',
    phoneNumber: '13800138000',
    submitTime: '2025-11-06 22:50:00',
    verifyTime: '2025-11-06 22:50:00',
    rejectReason: ''
  }
]
```

### 2. æç°è®°å½•ï¼ˆæ–°å¢å­—æ®µï¼‰
```javascript
withdraw_records = [
  {
    id: 1730918500000,
    amount: 100.00,
    status: 'success', // pending/success/failed
    statusText: 'æç°æˆåŠŸ',
    time: '2025-11-06 22:51:00',
    userId: '1001',
    roles: ['artist'],
    source: 'artist', // artist/staff/mixed
    incomeBreakdown: {
      artist: 100.00,
      service: 0.00,
      staff: 0.00
    },
    // ğŸ¯ æ–°å¢å­—æ®µ
    realName: 'å¼ ä¸‰',
    bankCard: '0000', // å°¾å·
    bankName: 'ä¸­å›½é“¶è¡Œ',
    apiOrderId: 'WD1730918500000',
    apiStatus: 'success',
    apiMessage: 'æç°æˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰',
    completedTime: '2025-11-06 22:51:05'
  }
]
```

---

## ğŸ”§ å¼€å‘ç¯å¢ƒå¼€å…³

**ä½ç½®**ï¼š`utils/withdraw-api.js` ç¬¬6è¡Œ

```javascript
const IS_DEV = true  // true: å¼€å‘æ¨¡å¼, false: ç”Ÿäº§æ¨¡å¼
```

### å¼€å‘æ¨¡å¼ç‰¹æ€§
1. âœ… å®åè®¤è¯ç›´æ¥é€šè¿‡ï¼ˆ1.5ç§’ï¼‰
2. âœ… æç°ç”³è¯·ç›´æ¥æˆåŠŸï¼ˆ1.5ç§’ï¼‰
3. âœ… æç°3ç§’åè‡ªåŠ¨å˜ä¸ºsuccess
4. âœ… çŸ­ä¿¡éªŒè¯ç å›ºå®šï¼š123456

### ç”Ÿäº§æ¨¡å¼ç‰¹æ€§
1. ğŸ“¡ å¯¹æ¥åç«¯å®åè®¤è¯æ¥å£
2. ğŸ“¡ å¯¹æ¥åˆ†è´¦å…¬å¸æç°æ¥å£
3. ğŸ“¡ ç­‰å¾…Webhookå›è°ƒæ›´æ–°çŠ¶æ€
4. ğŸ“¡ çœŸå®çŸ­ä¿¡éªŒè¯ç 

---

## ğŸ¯ æµ‹è¯•æµç¨‹

### æ­¥éª¤1ï¼šå®åè®¤è¯
1. è¿›å…¥ç”¨æˆ·ä¸­å¿ƒ
2. ç‚¹å‡»"å®åè®¤è¯"å…¥å£
3. å¡«å†™è¡¨å•ï¼š
   - å§“åï¼šå¼ ä¸‰
   - èº«ä»½è¯ï¼š110101199001011234
   - é“¶è¡Œå¡ï¼š6217000000000000000
   - é“¶è¡Œï¼šä¸­å›½é“¶è¡Œ
   - æ”¯è¡Œï¼šåŒ—äº¬æœé˜³æ”¯è¡Œ
   - æ‰‹æœºï¼š13800138000
   - éªŒè¯ç ï¼š123456
4. æäº¤è®¤è¯
5. 1.5ç§’åæ˜¾ç¤º"è®¤è¯æˆåŠŸ"

### æ­¥éª¤2ï¼šæç°ç”³è¯·
1. ç¡®ä¿æœ‰å¯æç°ä½™é¢
2. ç‚¹å‡»"æç°"æŒ‰é’®
3. è¾“å…¥æç°é‡‘é¢ï¼ˆ10-5000å…ƒï¼‰
4. ç¡®è®¤æç°
5. 1.5ç§’åæ˜¾ç¤º"æç°ç”³è¯·å·²æäº¤"
6. 3ç§’åè‡ªåŠ¨å˜ä¸º"æç°æˆåŠŸ"
7. ä½™é¢è‡ªåŠ¨æ‰£å‡

### æ­¥éª¤3ï¼šéªŒè¯æ•°æ®
```javascript
// æ§åˆ¶å°è¿è¡Œ
console.log('å®åè®¤è¯è®°å½•:', wx.getStorageSync('identity_verify_records'))
console.log('æç°è®°å½•:', wx.getStorageSync('withdraw_records'))
```

---

## ğŸ“¡ å¯¹æ¥åç«¯æ¥å£æŒ‡å—

### æ¥å£1ï¼šæäº¤å®åè®¤è¯
**è¯·æ±‚**
```http
POST https://your-backend.com/api/identity/verify
Content-Type: application/json

{
  "userId": "1001",
  "realName": "å¼ ä¸‰",
  "idCard": "110101199001011234",
  "bankCard": "6217000000000000000",
  "bankName": "ä¸­å›½é“¶è¡Œ",
  "bankBranch": "åŒ—äº¬æœé˜³æ”¯è¡Œ",
  "phoneNumber": "13800138000"
}
```

**å“åº”**
```json
{
  "success": true,
  "verifyId": "VER1730918400000",
  "message": "è®¤è¯æˆåŠŸ"
}
```

---

### æ¥å£2ï¼šæäº¤æç°ç”³è¯·
**è¯·æ±‚**
```http
POST https://your-backend.com/api/withdraw/submit
Content-Type: application/json

{
  "userId": "1001",
  "amount": 100.00,
  "verifyId": "VER1730918400000",
  "realName": "å¼ ä¸‰",
  "bankCard": "6217000000000000000"
}
```

**å“åº”**
```json
{
  "success": true,
  "orderId": "WD1730918500000",
  "message": "æç°ç”³è¯·å·²æäº¤",
  "estimatedTime": "2-24å°æ—¶"
}
```

---

### æ¥å£3ï¼šæç°çŠ¶æ€å›è°ƒï¼ˆWebhookï¼‰
**è¯·æ±‚**ï¼ˆåç«¯æ¨é€åˆ°å‰ç«¯ï¼‰
```http
POST https://your-miniapp.com/api/withdraw/callback
Content-Type: application/json

{
  "orderId": "WD1730918500000",
  "status": "success",
  "message": "æç°æˆåŠŸ",
  "completedTime": "2025-11-06 23:00:00"
}
```

**å‰ç«¯å¤„ç†**
```javascript
const withdrawApi = require('/utils/withdraw-api.js')
withdrawApi.handleWithdrawCallback(data)
```

---

### æ¥å£4ï¼šæŸ¥è¯¢æç°çŠ¶æ€ï¼ˆè½®è¯¢ï¼‰
**è¯·æ±‚**
```http
GET https://your-backend.com/api/withdraw/status?orderId=WD1730918500000
```

**å“åº”**
```json
{
  "success": true,
  "orderId": "WD1730918500000",
  "status": "success",
  "message": "æç°æˆåŠŸ",
  "completedTime": "2025-11-06 23:00:00"
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨é—®é¢˜
1. ğŸ”’ èº«ä»½è¯ã€é“¶è¡Œå¡éœ€åŠ å¯†å­˜å‚¨
2. ğŸ”’ æ•æ„Ÿä¿¡æ¯ä¼ è¾“éœ€HTTPS
3. ğŸ”’ å‰ç«¯å­˜å‚¨åªä¿ç•™è„±æ•æ•°æ®
4. ğŸ”’ çŸ­ä¿¡éªŒè¯ç éœ€åç«¯å‘é€

### ç”¨æˆ·ä½“éªŒ
1. âœ… å®åè®¤è¯ä¸€æ¬¡ï¼Œç»ˆèº«æœ‰æ•ˆ
2. âœ… å·²è®¤è¯æ˜¾ç¤ºè„±æ•ä¿¡æ¯
3. âœ… æç°å¤±è´¥è‡ªåŠ¨é€€å›ä½™é¢
4. âœ… æç°çŠ¶æ€å®æ—¶æ›´æ–°

### åç«¯å¯¹æ¥
1. ğŸ“¡ å°†`IS_DEV`æ”¹ä¸º`false`
2. ğŸ“¡ é…ç½®åç«¯æ¥å£åœ°å€
3. ğŸ“¡ å®ç°Webhookå›è°ƒæˆ–è½®è¯¢
4. ğŸ“¡ æµ‹è¯•å®Œæ•´æµç¨‹

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
1. `pages/identity-verify/index.js`
2. `pages/identity-verify/index.wxml`
3. `pages/identity-verify/index.wxss`
4. `pages/identity-verify/index.json`
5. `utils/withdraw-api.js`

### ä¿®æ”¹æ–‡ä»¶
1. `pages/withdraw/index.js` - å¢åŠ è®¤è¯æ£€æŸ¥
2. `pages/user-center/index.js` - å¢åŠ è®¤è¯å…¥å£
3. `pages/user-center/index.wxml` - å¢åŠ è®¤è¯æŒ‰é’®
4. `pages/user-center/index.wxss` - å¢åŠ è®¤è¯å›¾æ ‡æ ·å¼

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

- âœ… å®åè®¤è¯é¡µé¢
- âœ… APIå¯¹æ¥å±‚
- âœ… æç°æµç¨‹æ”¹é€ 
- âœ… ç”¨æˆ·ä¸­å¿ƒå…¥å£
- âœ… æ¨¡æ‹Ÿè‡ªåŠ¨æˆåŠŸ
- âœ… æ•°æ®ç»“æ„æ‰©å±•
- â³ åç«¯æ¥å£å¯¹æ¥ï¼ˆå¾…å¼€å‘ï¼‰

**å®Œæˆæ—¶é—´**ï¼š2025-11-06  
**é¢„ç•™æ¥å£**ï¼šå·²å®Œæˆ  
**æ¨¡æ‹ŸåŠŸèƒ½**ï¼šå·²å®Œæˆ  
**ç”Ÿäº§å°±ç»ª**ï¼šéœ€å¯¹æ¥åç«¯æ¥å£

