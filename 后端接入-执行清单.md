# åç«¯æ¥å…¥æ‰§è¡Œæ¸…å•

> **äº‘ç¯å¢ƒID**: cloud1-2gca1h9d11f4d9d2  
> **å½“å‰é˜¶æ®µ**: å‡†å¤‡é˜¶æ®µ  
> **æ›´æ–°æ—¶é—´**: 2025-11-12

---

## âœ… å·²å®Œæˆ

### 1. åŸºç¡€å·¥å…·ç±»åˆ›å»ºï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰

- âœ… `miniprogram/config/env.js` - ç¯å¢ƒé…ç½®
  - äº‘ç¯å¢ƒID: cloud1-2gca1h9d11f4d9d2
  - å¼€å…³ï¼šuseMockDataï¼ˆå¼€å‘=trueï¼Œç”Ÿäº§=falseï¼‰
  - ç´§æ€¥é™çº§ï¼šemergencyFallback
  - é›†åˆåé…ç½®ï¼š12ä¸ªé›†åˆ

- âœ… `miniprogram/utils/api.js` - APIç»Ÿä¸€å°è£…
  - åŒæ¨¡å¼æ”¯æŒï¼ˆmockæ•°æ® + äº‘æ•°æ®åº“ï¼‰
  - ç”¨æˆ·æ¨¡å—ï¼ˆgetUserInfo, saveUserInfoï¼‰
  - è®¢å•æ¨¡å—ï¼ˆcreateOrder, getOrderList, updateOrderStatusï¼‰
  - å•†å“æ¨¡å—ï¼ˆgetProductList, saveProductï¼‰
  - è´¢åŠ¡æ¨¡å—ï¼ˆcreateIncomeRecord, getIncomeListï¼‰
  - ç»Ÿä¸€é”™è¯¯å¤„ç†

- âœ… `miniprogram/utils/date-formatter.js` - æ—¶é—´æ ‡å‡†åŒ–
  - iOSå…¼å®¹è§£æï¼ˆparseDateï¼‰
  - å±•ç¤ºæ ¼å¼åŒ–ï¼ˆformatDateToDisplay, formatDateToShortï¼‰
  - ç›¸å¯¹æ—¶é—´ï¼ˆformatRelativeTimeï¼‰
  - å‰©ä½™æ—¶é—´ï¼ˆcalculateTimeLeftï¼‰
  - è®¢å•å·ç”Ÿæˆï¼ˆgenerateOrderIdï¼‰

- âœ… `miniprogram/utils/cache-manager.js` - ç¼“å­˜ç®¡ç†
  - å†…å­˜ç¼“å­˜ï¼ˆsetMemory, getMemoryï¼‰
  - Storageç¼“å­˜ï¼ˆsetStorage, getStorageï¼‰
  - æ¸…é™¤ç¼“å­˜ï¼ˆclear, clearAllï¼‰
  - ç¼“å­˜ç»Ÿè®¡ï¼ˆgetStatsï¼‰

- âœ… `db-init.js` - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
  - 12ä¸ªé›†åˆå®šä¹‰
  - ç´¢å¼•é…ç½®ï¼ˆ6ä¸ªæ ¸å¿ƒé›†åˆï¼Œå…±24ä¸ªç´¢å¼•ï¼‰
  - æ•°æ®è¿ç§»å‡½æ•°

---

## â³ å¾…æ‰§è¡Œï¼ˆéœ€æ‚¨æ“ä½œï¼‰

### 2. äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºé›†åˆ

æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ äº‘å¼€å‘ â†’ æ•°æ®åº“ â†’ åˆ›å»ºé›†åˆ

éœ€è¦åˆ›å»ºä»¥ä¸‹12ä¸ªé›†åˆï¼š

| åºå· | é›†åˆå | è¯´æ˜ | æƒé™è®¾ç½® |
|-----|-------|------|---------|
| 1 | `users` | ç”¨æˆ·è¡¨ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 2 | `orders` | è®¢å•è¡¨ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 3 | `products` | å•†å“è¡¨ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 4 | `artist_applications` | ç”»å¸ˆç”³è¯·è¡¨ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 5 | `categories` | åˆ†ç±»è¡¨ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 6 | `notices` | å…¬å‘Šè¡¨ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 7 | `banners` | è½®æ’­å›¾è¡¨ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 8 | `income_ledger` | æ”¶å…¥è´¦æœ¬ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 9 | `withdraw_records` | æç°è®°å½• | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 10 | `reward_records` | æ‰“èµè®°å½• | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 11 | `service_qrcodes` | å®¢æœäºŒç»´ç  | ä»…åˆ›å»ºè€…å¯è¯»å†™ |
| 12 | `buyer_shows` | ä¹°å®¶ç§€ | ä»…åˆ›å»ºè€…å¯è¯»å†™ |

**æ“ä½œæ­¥éª¤**ï¼š
1. ç‚¹å‡»"åˆ›å»ºé›†åˆ"
2. è¾“å…¥é›†åˆåï¼ˆä¸¥æ ¼æŒ‰ä¸Šè¡¨ï¼‰
3. æƒé™é€‰æ‹©"ä»…åˆ›å»ºè€…å¯è¯»å†™"
4. ç‚¹å‡»ç¡®å®š

**å®Œæˆåæˆªå›¾å‘ç»™æˆ‘ç¡®è®¤**

---

### 3. åˆ›å»ºæ•°æ®åº“ç´¢å¼•

åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ é€‰æ‹©é›†åˆ â†’ ç´¢å¼•ç®¡ç† â†’ æ·»åŠ ç´¢å¼•

#### 3.1 users è¡¨ç´¢å¼•ï¼ˆ2ä¸ªï¼‰

```javascript
// ç´¢å¼•1ï¼šuserIdï¼ˆå”¯ä¸€ï¼‰
{
  "keys": { "userId": 1 },
  "unique": true
}

// ç´¢å¼•2ï¼šopenidï¼ˆå”¯ä¸€ï¼‰
{
  "keys": { "openid": 1 },
  "unique": true
}
```

#### 3.2 orders è¡¨ç´¢å¼•ï¼ˆ10ä¸ªï¼Œâš ï¸ æœ€é‡è¦ï¼‰

```javascript
// ç´¢å¼•1ï¼šorderIdï¼ˆå”¯ä¸€ï¼‰
{ "keys": { "orderId": 1 }, "unique": true }

// ç´¢å¼•2ï¼šbuyerId
{ "keys": { "buyerId": 1 } }

// ç´¢å¼•3ï¼šartistId
{ "keys": { "artistId": 1 } }

// ç´¢å¼•4ï¼šserviceId
{ "keys": { "serviceId": 1 } }

// ç´¢å¼•5ï¼šstatus
{ "keys": { "status": 1 } }

// ç´¢å¼•6ï¼šcreateTimeï¼ˆå€’åºï¼‰
{ "keys": { "createTime": -1 } }

// ç´¢å¼•7ï¼šdeadline
{ "keys": { "deadline": 1 } }

// ç´¢å¼•8ï¼šstatus + createTimeï¼ˆå¤åˆç´¢å¼•ï¼‰
{ "keys": { "status": 1, "createTime": -1 } }

// ç´¢å¼•9ï¼šbuyerId + statusï¼ˆå¤åˆç´¢å¼•ï¼‰
{ "keys": { "buyerId": 1, "status": 1 } }

// ç´¢å¼•10ï¼šartistId + statusï¼ˆå¤åˆç´¢å¼•ï¼‰
{ "keys": { "artistId": 1, "status": 1 } }
```

#### 3.3 products è¡¨ç´¢å¼•ï¼ˆ4ä¸ªï¼‰

```javascript
// ç´¢å¼•1ï¼šproductIdï¼ˆå”¯ä¸€ï¼‰
{ "keys": { "productId": 1 }, "unique": true }

// ç´¢å¼•2ï¼šartistId
{ "keys": { "artistId": 1 } }

// ç´¢å¼•3ï¼šcategoryId
{ "keys": { "categoryId": 1 } }

// ç´¢å¼•4ï¼šstatus
{ "keys": { "status": 1 } }
```

#### 3.4 artist_applications è¡¨ç´¢å¼•ï¼ˆ3ä¸ªï¼‰

```javascript
// ç´¢å¼•1ï¼šuserIdï¼ˆå”¯ä¸€ï¼‰
{ "keys": { "userId": 1 }, "unique": true }

// ç´¢å¼•2ï¼šartistNumberï¼ˆå”¯ä¸€ï¼‰
{ "keys": { "artistNumber": 1 }, "unique": true }

// ç´¢å¼•3ï¼šstatus
{ "keys": { "status": 1 } }
```

#### 3.5 income_ledger è¡¨ç´¢å¼•ï¼ˆ4ä¸ªï¼‰

```javascript
// ç´¢å¼•1ï¼šuserId
{ "keys": { "userId": 1 } }

// ç´¢å¼•2ï¼šorderId
{ "keys": { "orderId": 1 } }

// ç´¢å¼•3ï¼šincomeType
{ "keys": { "incomeType": 1 } }

// ç´¢å¼•4ï¼šcreateTimeï¼ˆå€’åºï¼‰
{ "keys": { "createTime": -1 } }
```

#### 3.6 withdraw_records è¡¨ç´¢å¼•ï¼ˆ3ä¸ªï¼‰

```javascript
// ç´¢å¼•1ï¼šuserId
{ "keys": { "userId": 1 } }

// ç´¢å¼•2ï¼šstatus
{ "keys": { "status": 1 } }

// ç´¢å¼•3ï¼štimeï¼ˆå€’åºï¼‰
{ "keys": { "time": -1 } }
```

**æ“ä½œæ­¥éª¤**ï¼š
1. é€‰æ‹©é›†åˆ
2. ç‚¹å‡»"ç´¢å¼•ç®¡ç†"
3. ç‚¹å‡»"æ·»åŠ ç´¢å¼•"
4. è¾“å…¥JSONé…ç½®
5. ç‚¹å‡»ç¡®å®š

**å®Œæˆåå‘Šè¯‰æˆ‘**

---

### 4. æ•°æ®è¿ç§»ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦å°†æœ¬åœ°Storageæ•°æ®è¿ç§»åˆ°äº‘æ•°æ®åº“ï¼š

**æ–¹å¼ä¸€ï¼šä½¿ç”¨æ§åˆ¶å°è„šæœ¬**
1. åœ¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
const dbInit = require('./db-init.js')
dbInit.migrateLocalData()
```

**æ–¹å¼äºŒï¼šæˆ‘æä¾›è¿ç§»è„šæœ¬**
å‘Šè¯‰æˆ‘éœ€è¦è¿ç§»ï¼Œæˆ‘ç”Ÿæˆç‹¬ç«‹è„šæœ¬

**æ˜¯å¦éœ€è¦è¿ç§»ï¼Ÿ**ï¼ˆå›ç­”"éœ€è¦"æˆ–"è·³è¿‡"ï¼‰

---

## ğŸ“Š è¿›åº¦ç»Ÿè®¡

- âœ… å·¥å…·ç±»åˆ›å»ºï¼š5/5ï¼ˆ100%ï¼‰
- â³ é›†åˆåˆ›å»ºï¼š0/12ï¼ˆ0%ï¼‰
- â³ ç´¢å¼•åˆ›å»ºï¼š0/26ï¼ˆ0%ï¼‰
- â³ æ•°æ®è¿ç§»ï¼šå¾…å®š

---

## ğŸ¯ ä¸‹ä¸€æ­¥ï¼ˆå®Œæˆä¸Šè¿°åï¼‰

### é˜¶æ®µäºŒï¼šäº‘å‡½æ•°å¼€å‘
- è®¢å•å®Œæˆäº‘å‡½æ•°ï¼ˆå«åˆ†æˆè®¡ç®—ï¼‰
- æ¶ˆæ¯æ¨é€äº‘å‡½æ•°
- å›¾ç‰‡ä¸Šä¼ äº‘å‡½æ•°

### é˜¶æ®µä¸‰ï¼šAPIæ›¿æ¢
- ç”¨æˆ·æ¨¡å—è¿ç§»
- è®¢å•æ¨¡å—è¿ç§»
- å•†å“æ¨¡å—è¿ç§»
- è´¢åŠ¡æ¨¡å—è¿ç§»

### é˜¶æ®µå››ï¼šæµ‹è¯•éªŒè¯
- åŠŸèƒ½æµ‹è¯•
- å‹åŠ›æµ‹è¯•
- å…¼å®¹æ€§æµ‹è¯•

---

**è¯·æŒ‰é¡ºåºå®Œæˆç¬¬2ã€3æ­¥ï¼Œå®Œæˆåå‘Šè¯‰æˆ‘ï¼**

