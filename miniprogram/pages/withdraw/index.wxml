<view class="withdraw-container">
  <!-- 余额卡片 -->
  <view class="balance-card">
    <text class="balance-label">可提现余额</text>
    <view class="balance-amount">
      <text class="symbol">¥</text>
      <text class="value">{{balance}}</text>
    </view>
    <view class="income-summary">
      <view wx:if="{{incomeSummary.order > 0}}" class="summary-item">
        <text class="summary-label">订单稿费</text>
        <text class="summary-value">¥{{incomeSummary.order}}</text>
      </view>
      <view wx:if="{{incomeSummary.order > 0 && (incomeSummary.reward > 0 || incomeSummary.service > 0 || incomeSummary.staff > 0)}}" class="summary-divider"></view>
      <view wx:if="{{incomeSummary.reward > 0}}" class="summary-item">
        <text class="summary-label">画师打赏</text>
        <text class="summary-value">¥{{incomeSummary.reward}}</text>
      </view>
      <view wx:if="{{incomeSummary.reward > 0 && (incomeSummary.service > 0 || incomeSummary.staff > 0)}}" class="summary-divider"></view>
      <view wx:if="{{incomeSummary.service > 0}}" class="summary-item">
        <text class="summary-label">客服分成</text>
        <text class="summary-value">¥{{incomeSummary.service}}</text>
      </view>
      <view wx:if="{{incomeSummary.service > 0 && incomeSummary.staff > 0}}" class="summary-divider"></view>
      <view wx:if="{{incomeSummary.staff > 0}}" class="summary-item">
        <text class="summary-label">管理员分成</text>
        <text class="summary-value">¥{{incomeSummary.staff}}</text>
      </view>
    </view>
    <text class="balance-hint">订单、打赏与分成收入可提现</text>
  </view>

  <!-- 历史记录入口 -->
  <view class="view-records">
    <view class="record-entry" bindtap="viewIncomeDetail">
      <text class="entry-label">历史记录</text>
      <view class="entry-right">
        <text class="entry-hint">账单流水</text>
        <text class="entry-arrow">›</text>
      </view>
    </view>
    <view class="record-entry" bindtap="showWithdrawRecordsModal">
      <text class="entry-label">提现记录</text>
      <view class="entry-right">
        <text class="entry-hint">查看提现明细</text>
        <text class="entry-arrow">›</text>
      </view>
    </view>
  </view>

  <!-- 提现说明 -->
  <view class="tips-section">
    <text class="tip-line">• 每日最多可提现3次</text>
    <text class="tip-line">• 单笔提现金额：10-5000元</text>
    <text class="tip-line">• 提现预计1-3个工作日到账</text>
    <text class="tip-line">• 首次提现需要实名认证</text>
  </view>

  <!-- 提现按钮 -->
  <button class="withdraw-btn" bindtap="startWithdraw">提现</button>
</view>

<!-- 提现弹窗 -->
<view wx:if="{{showWithdrawModal}}" class="modal-mask" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">提现</text>
      <text class="modal-close" bindtap="closeModal">×</text>
    </view>

    <!-- 提现金额输入 -->
    <view class="modal-section">
      <text class="section-label">提现金额</text>
      <view class="amount-input-row">
        <text class="input-symbol">¥</text>
        <input class="amount-input" 
               type="digit" 
               placeholder="请输入提现金额" 
               value="{{withdrawAmount}}"
               bindinput="onAmountInput"/>
      </view>
      <view class="balance-tip">可提现余额 ¥{{balance}}</view>
    </view>

    <!-- 提现按钮 -->
    <button class="modal-submit-btn" bindtap="submitWithdraw">确认提现</button>
  </view>
</view>

<!-- 实名认证弹窗 -->
<view wx:if="{{showVerifyModal}}" class="modal-mask" bindtap="closeVerifyModal">
  <view class="modal-content verify-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">实名认证</text>
      <text class="modal-close" bindtap="closeVerifyModal">×</text>
    </view>

    <view class="verify-hint">首次提现需要完成实名认证</view>

    <!-- 实名信息 -->
    <view class="modal-section">
      <view class="input-item">
        <text class="item-label required">真实姓名</text>
        <input class="item-input" placeholder="请输入真实姓名" value="{{realName}}" bindinput="onRealNameInput"/>
      </view>
      <view class="input-item">
        <text class="item-label required">身份证号</text>
        <input class="item-input" placeholder="请输入身份证号" value="{{idCard}}" bindinput="onIdCardInput"/>
      </view>
      <view class="input-item">
        <text class="item-label required">手机号码</text>
        <input class="item-input" type="number" placeholder="银行预留手机号" value="{{phoneNumber}}" bindinput="onPhoneInput"/>
      </view>
      <view class="input-item verify-code-item">
        <text class="item-label required">验证码</text>
        <input class="item-input verify-code-input" type="number" placeholder="请输入验证码" value="{{verifyCode}}" bindinput="onVerifyCodeInput"/>
        <button class="send-code-btn {{codeSending || countdown > 0 ? 'disabled' : ''}}" 
                bindtap="sendVerifyCode"
                disabled="{{codeSending || countdown > 0}}">
          {{countdown > 0 ? countdown + 's' : '获取验证码'}}
        </button>
      </view>
    </view>

    <!-- 银行卡信息 -->
    <view class="modal-section">
      <text class="section-label">银行卡信息</text>
      <view class="input-item">
        <text class="item-label required">开户银行</text>
        <input class="item-input" placeholder="如：中国工商银行" value="{{bankName}}" bindinput="onBankNameInput"/>
      </view>
      <view class="input-item">
        <text class="item-label required">银行卡号</text>
        <input class="item-input" type="digit" placeholder="请输入银行卡号" value="{{bankCard}}" bindinput="onBankCardInput"/>
      </view>
      <view class="input-item">
        <text class="item-label">开户支行</text>
        <input class="item-input" placeholder="如：XX支行（可选）" value="{{bankBranch}}" bindinput="onBankBranchInput"/>
      </view>
    </view>

    <!-- 提交按钮 -->
    <button class="modal-submit-btn" bindtap="submitVerify">完成认证</button>
  </view>
</view>

<!-- 🎯 提现记录弹窗 -->
<view wx:if="{{showWithdrawRecordsModal}}" class="records-modal-mask" bindtap="closeWithdrawRecordsModal">
  <view class="records-modal-content" catchtap="stopPropagation">
    <view class="records-modal-header">
      <text class="records-modal-title">提现记录</text>
      <text class="records-modal-close" bindtap="closeWithdrawRecordsModal">×</text>
    </view>
    
    <view class="records-modal-body">
      <view wx:if="{{withdrawRecords.length === 0}}" class="records-empty">
        <text class="records-empty-icon">📝</text>
        <text class="records-empty-text">暂无提现记录</text>
      </view>
      
      <view wx:else class="records-list">
        <view wx:for="{{withdrawRecords}}" wx:key="id" class="records-item status-{{item.status}}">
          <view class="records-item-header">
            <text class="records-item-amount">-¥{{item.amount}}</text>
            <view class="records-item-status">{{item.statusText}}</view>
          </view>
          <view class="records-item-info">
            <text class="records-info-line">提现银行：{{item.bankName || '未知银行'}}(****{{item.bankCard || '0000'}})</text>
            <text class="records-info-line">提现时间：{{item.time}}</text>
            <text wx:if="{{item.completedTime}}" class="records-info-line">完成时间：{{item.completedTime}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
