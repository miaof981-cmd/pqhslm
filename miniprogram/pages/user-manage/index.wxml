<view class="container">
  <view class="header">
    <view class="header-title">用户权限管理</view>
    <view class="header-subtitle">直接赋予或解除用户权限</view>
  </view>

  <view class="content">
    <!-- 搜索用户 -->
    <view class="search-section">
      <view class="search-box">
        <input class="search-input" 
               placeholder="输入用户ID或微信号搜索" 
               value="{{searchKeyword}}"
               bindinput="onSearchInput"
               bindconfirm="searchUser" />
        <button class="search-btn" bindtap="searchUser">搜索</button>
      </view>
    </view>

    <!-- 用户信息 -->
    <view wx:if="{{currentUser}}" class="user-card">
      <view class="user-header">
        <view class="user-avatar">{{currentUser.name ? currentUser.name.charAt(0) : '用'}}</view>
        <view class="user-info">
          <view class="user-name">{{currentUser.name || '未设置姓名'}}</view>
          <view class="user-id">ID: {{currentUser.userId}}</view>
        </view>
      </view>

      <view class="user-detail">
        <view class="detail-item">
          <text class="detail-label">微信号：</text>
          <text class="detail-value">{{currentUser.wechat || '未设置'}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">注册时间：</text>
          <text class="detail-value">{{currentUser.createTime || '未知'}}</text>
        </view>
      </view>

      <!-- 权限管理 -->
      <view class="permission-section">
        <view class="section-title">当前权限</view>
        <view class="role-list">
          <view wx:for="{{allRoles}}" wx:key="id" 
                class="role-item {{currentUser.roles.indexOf(item.id) !== -1 ? 'active' : ''}}"
                data-role="{{item.id}}"
                bindtap="toggleRole">
            <view class="role-icon {{item.id}}"></view>
            <text class="role-name">{{item.name}}</text>
            <view wx:if="{{currentUser.roles.indexOf(item.id) !== -1}}" class="role-check"></view>
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-buttons">
        <button class="action-btn save" bindtap="savePermissions">保存权限</button>
        <button class="action-btn reset" bindtap="resetPermissions">重置</button>
      </view>
    </view>

    <!-- 空状态 -->
    <view wx:else class="empty-state">
      <view class="empty-icon">🔍</view>
      <view class="empty-text">请输入用户ID或微信号进行搜索</view>
      <view class="empty-hint">搜索后可直接赋予或解除该用户的权限</view>
    </view>

    <!-- 最近操作记录 -->
    <view class="recent-section">
      <view class="section-title">最近操作记录</view>
      <view wx:if="{{recentLogs.length > 0}}" class="log-list">
        <view wx:for="{{recentLogs}}" wx:key="id" class="log-item">
          <view class="log-time">{{item.time}}</view>
          <view class="log-content">{{item.content}}</view>
        </view>
      </view>
      <view wx:else class="empty-logs">
        <text>暂无操作记录</text>
      </view>
    </view>
  </view>
</view>
