<view class="container">
  <view class="header">
    <view class="header-title">ç”¨æˆ·æƒé™ç®¡ç†</view>
    <view class="header-subtitle">ç›´æ¥èµ‹äºˆæˆ–è§£é™¤ç”¨æˆ·æƒé™</view>
  </view>

  <view class="content">
    <!-- æœç´¢ç”¨æˆ· -->
    <view class="search-section">
      <view class="search-box">
        <input class="search-input" 
               placeholder="è¾“å…¥ç”¨æˆ·IDæˆ–å¾®ä¿¡å·æœç´¢" 
               value="{{searchKeyword}}"
               bindinput="onSearchInput"
               bindconfirm="searchUser" />
        <button class="search-btn" bindtap="searchUser">æœç´¢</button>
      </view>
    </view>

    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view wx:if="{{currentUser}}" class="user-card">
      <view class="user-header">
        <view class="user-avatar">{{currentUser.name ? currentUser.name.charAt(0) : 'ç”¨'}}</view>
        <view class="user-info">
          <view class="user-name">{{currentUser.name || 'æœªè®¾ç½®å§“å'}}</view>
          <view class="user-id">ID: {{currentUser.userId}}</view>
        </view>
      </view>

      <view class="user-detail">
        <view class="detail-item">
          <text class="detail-label">å¾®ä¿¡å·ï¼š</text>
          <text class="detail-value">{{currentUser.wechat || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ³¨å†Œæ—¶é—´ï¼š</text>
          <text class="detail-value">{{currentUser.createTime || 'æœªçŸ¥'}}</text>
        </view>
      </view>

      <!-- æƒé™ç®¡ç† -->
      <view class="permission-section">
        <view class="section-title">å½“å‰æƒé™</view>
        <view class="role-list">
          <view wx:for="{{allRoles}}" wx:key="id" 
                class="role-item {{currentUser.roles.indexOf(item.id) !== -1 ? 'active' : ''}}"
                data-role="{{item.id}}"
                bindtap="toggleRole">
            <view class="role-icon {{item.id}}"></view>
            <text class="role-name">{{item.name}}</text>
            <view wx:if="{{currentUser.roles.indexOf(item.id) !== -1}}" class="role-check"></view>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="action-btn save" bindtap="savePermissions">ä¿å­˜æƒé™</button>
        <button class="action-btn reset" bindtap="resetPermissions">é‡ç½®</button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">è¯·è¾“å…¥ç”¨æˆ·IDæˆ–å¾®ä¿¡å·è¿›è¡Œæœç´¢</view>
      <view class="empty-hint">æœç´¢åå¯ç›´æ¥èµ‹äºˆæˆ–è§£é™¤è¯¥ç”¨æˆ·çš„æƒé™</view>
    </view>

    <!-- æœ€è¿‘æ“ä½œè®°å½• -->
    <view class="recent-section">
      <view class="section-title">æœ€è¿‘æ“ä½œè®°å½•</view>
      <view wx:if="{{recentLogs.length > 0}}" class="log-list">
        <view wx:for="{{recentLogs}}" wx:key="id" class="log-item">
          <view class="log-time">{{item.time}}</view>
          <view class="log-content">{{item.content}}</view>
        </view>
      </view>
      <view wx:else class="empty-logs">
        <text>æš‚æ— æ“ä½œè®°å½•</text>
      </view>
    </view>
  </view>
</view>
