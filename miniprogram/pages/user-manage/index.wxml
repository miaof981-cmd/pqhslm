<view class="container">
  <!-- ğŸ¯ é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="header-title">
      {{pageType === 'all' ? 'ç”¨æˆ·åˆ—è¡¨' : 'ä¸‹å•ç”¨æˆ·'}}
    </view>
    <view class="header-subtitle">
      {{pageType === 'all' ? 'æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œç”¨æˆ·åŠæ¶ˆè´¹æƒ…å†µ' : dateFilter === 'today' ? 'ä»Šæ—¥ä¸‹å•ç”¨æˆ·ç»Ÿè®¡' : 'ç­›é€‰æ—¶æ®µä¸‹å•ç”¨æˆ·'}}
    </view>
  </view>

  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:else class="content">
    <!-- ğŸ“Š ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-section">
      <view class="stat-card">
        <view class="stat-value">{{stats.totalUsers}}</view>
        <view class="stat-label">ç”¨æˆ·æ•°</view>
      </view>
      <view class="stat-card">
        <view class="stat-value">Â¥{{stats.totalSpent}}</view>
        <view class="stat-label">æ€»æ¶ˆè´¹</view>
      </view>
      <view class="stat-card">
        <view class="stat-value">{{stats.totalOrders}}</view>
        <view class="stat-label">è®¢å•æ•°</view>
      </view>
      <view class="stat-card">
        <view class="stat-value">Â¥{{stats.avgSpent}}</view>
        <view class="stat-label">äººå‡æ¶ˆè´¹</view>
      </view>
    </view>

    <!-- ğŸ” æœç´¢å’Œæ’åº -->
    <view class="toolbar">
      <view class="search-box">
        <view class="search-icon">ğŸ”</view>
        <input class="search-input" 
               placeholder="æœç´¢ç”¨æˆ·IDæˆ–æ˜µç§°" 
               value="{{searchKeyword}}"
               bindinput="onSearchInput" />
      </view>
      
      <view class="sort-buttons">
        <view class="sort-btn {{sortBy === 'totalSpent' ? 'active' : ''}}" 
              data-sort="totalSpent" 
              bindtap="toggleSort">
          æ¶ˆè´¹
          <text class="sort-arrow">{{sortBy === 'totalSpent' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
        </view>
        <view class="sort-btn {{sortBy === 'orderCount' ? 'active' : ''}}" 
              data-sort="orderCount" 
              bindtap="toggleSort">
          è®¢å•
          <text class="sort-arrow">{{sortBy === 'orderCount' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
        </view>
        <view class="sort-btn {{sortBy === 'lastOrderTime' ? 'active' : ''}}" 
              data-sort="lastOrderTime" 
              bindtap="toggleSort">
          æ—¶é—´
          <text class="sort-arrow">{{sortBy === 'lastOrderTime' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
        </view>
      </view>
    </view>

    <!-- ğŸ‘¥ ç”¨æˆ·åˆ—è¡¨ -->
    <view wx:if="{{displayUsers.length > 0}}" class="user-list">
      <view wx:for="{{displayUsers}}" 
            wx:key="userId" 
            class="user-card"
            bindtap="viewUserDetail"
            data-user-id="{{item.userId}}">
        
        <!-- ç”¨æˆ·åŸºç¡€ä¿¡æ¯ -->
        <view class="user-header">
          <image wx:if="{{item.avatar}}" 
                 class="user-avatar" 
                 src="{{item.avatar}}" 
                 mode="aspectFill" />
          <view wx:else class="user-avatar default">
            {{item.nickName.charAt(0)}}
          </view>
          
          <view class="user-info">
            <view class="user-name">{{item.nickName}}</view>
            <view class="user-id">
              <text>ID: {{item.userId}}</text>
              <view class="copy-btn" 
                    catchtap="copyUserId" 
                    data-user-id="{{item.userId}}">
                å¤åˆ¶
              </view>
            </view>
          </view>
          
          <view class="user-rank">
            <text class="rank-icon">{{index < 3 ? (index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰') : ''}}</text>
          </view>
        </view>

        <!-- æ¶ˆè´¹ç»Ÿè®¡ -->
        <view class="user-stats">
          <view class="stat-item">
            <view class="stat-label-small">æ€»æ¶ˆè´¹</view>
            <view class="stat-value-small highlight">Â¥{{item.totalSpent}}</view>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <view class="stat-label-small">è®¢å•æ•°</view>
            <view class="stat-value-small">{{item.orderCount}}ç¬”</view>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <view class="stat-label-small">äººå‡è®¢å•</view>
            <view class="stat-value-small">Â¥{{item.avgOrderAmount}}</view>
          </view>
        </view>

        <!-- æ—¶é—´ä¿¡æ¯ -->
        <view class="user-footer">
          <view class="time-info">
            <text class="time-label">æœ€è¿‘ä¸‹å•ï¼š</text>
            <text class="time-value">{{item.lastOrderTime}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“­</view>
      <view class="empty-text">
        {{searchKeyword ? 'æœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·' : 'æš‚æ— ç”¨æˆ·æ•°æ®'}}
      </view>
      <view wx:if="{{searchKeyword}}" class="empty-hint">
        è¯·å°è¯•å…¶ä»–å…³é”®è¯
      </view>
    </view>
  </view>
</view>
