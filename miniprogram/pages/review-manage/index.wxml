<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-title">ç”»å¸ˆå®¡æ ¸ç®¡ç†</view>
    <view class="today-stats">
      <text class="stats-label">ä»Šæ—¥å·²å®¡æ ¸</text>
      <text class="stats-value">{{todayReviewCount}}</text>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === 'pending' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="pending">
      <text class="tab-text">å¾…å®¡æ ¸</text>
      <view wx:if="{{pendingCount > 0}}" class="tab-badge">{{pendingCount}}</view>
    </view>
    <view 
      class="tab-item {{currentTab === 'approved' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="approved">
      <text class="tab-text">å·²é€šè¿‡</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'rejected' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="rejected">
      <text class="tab-text">å·²é©³å›</text>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å§“åã€å¾®ä¿¡æ˜µç§°æˆ–ç”¨æˆ·ID"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm" />
      <view wx:if="{{searchKeyword}}" class="clear-icon" bindtap="clearSearch">Ã—</view>
    </view>
  </view>

  <!-- ç”³è¯·åˆ—è¡¨ -->
  <view class="content">
    <!-- å¾…å®¡æ ¸ -->
    <view wx:if="{{currentTab === 'pending'}}">
      <view wx:if="{{applications.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“‹</text>
        <text class="empty-text">æš‚æ— å¾…å®¡æ ¸ç”³è¯·</text>
      </view>
      <view wx:else class="application-list">
        <view 
          wx:for="{{applications}}" 
          wx:key="id" 
          class="application-card"
          bindtap="viewDetail"
          data-id="{{item.id}}">
          <!-- ç”³è¯·äººä¿¡æ¯ -->
          <view class="card-header">
            <image class="avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
            <view class="user-info">
              <text class="nickname">{{item.nickName}}</text>
              <text class="realname">{{item.name}} Â· {{item.age}}å²</text>
            </view>
            <view class="time-badge">{{item.submitTime}}</view>
          </view>

          <!-- ä»·æ ¼ä¿¡æ¯ -->
          <view class="price-info">
            <view class="price-item">
              <text class="price-label">ç†æƒ³ç¨¿é…¬</text>
              <text class="price-value">Â¥{{item.idealPrice}}</text>
            </view>
            <view class="price-item">
              <text class="price-label">æœ€ä½ä»·æ ¼</text>
              <text class="price-value">Â¥{{item.minPrice}}</text>
            </view>
          </view>

          <!-- ä½œå“é¢„è§ˆ -->
          <view class="works-preview">
            <text class="preview-label">ä½œå“å±•ç¤ºï¼ˆ{{item.finishedWorks.length}}å¼ ï¼‰</text>
            <view class="preview-images">
              <image 
                wx:for="{{item.finishedWorks}}" 
                wx:key="*this" 
                wx:for-item="img"
                src="{{img}}" 
                mode="aspectFill" 
                class="preview-img" 
                catchtap="previewImage"
                data-urls="{{item.finishedWorks}}"
                data-current="{{img}}" />
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="card-actions" catchtap="stopPropagation">
            <button class="action-btn reject-btn" bindtap="showRejectModal" data-item="{{item}}">é©³å›</button>
            <button class="action-btn approve-btn" bindtap="approveApplication" data-id="{{item.id}}">é€šè¿‡</button>
          </view>
        </view>
      </view>
    </view>

    <!-- å·²é€šè¿‡ -->
    <view wx:if="{{currentTab === 'approved'}}">
      <view wx:if="{{applications.length === 0}}" class="empty-state">
        <text class="empty-icon">âœ…</text>
        <text class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³è®°å½•' : 'æš‚æ— é€šè¿‡è®°å½•'}}</text>
      </view>
      <view wx:else class="history-list">
        <view wx:for="{{applications}}" wx:key="id" class="history-card approved-card" bindtap="viewDetail" data-id="{{item.id}}">
          <view class="history-header">
            <image class="history-avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
            <view class="history-info">
              <text class="history-name">{{item.nickName}}</text>
              <text class="history-realname">{{item.name}} Â· ID: {{item.userId}}</text>
              <text class="history-time">é€šè¿‡æ—¶é—´ï¼š{{item.approveTime}}</text>
            </view>
            <view class="status-tag approved">å·²é€šè¿‡</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å·²é©³å› -->
    <view wx:if="{{currentTab === 'rejected'}}">
      <view wx:if="{{applications.length === 0}}" class="empty-state">
        <text class="empty-icon">âŒ</text>
        <text class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³è®°å½•' : 'æš‚æ— é©³å›è®°å½•'}}</text>
      </view>
      <view wx:else class="application-list">
        <view wx:for="{{applications}}" wx:key="id" class="application-card rejected-card" bindtap="viewDetail" data-id="{{item.id}}">
          <!-- ç”³è¯·äººä¿¡æ¯ -->
          <view class="card-header">
            <image class="avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
            <view class="user-info">
              <text class="nickname">{{item.nickName}}</text>
              <text class="realname">{{item.name}} Â· {{item.age}}å² Â· ID: {{item.userId}}</text>
            </view>
            <view class="status-tag rejected">å·²é©³å›</view>
          </view>

          <!-- ä»·æ ¼ä¿¡æ¯ -->
          <view class="price-info">
            <view class="price-item">
              <text class="price-label">ç†æƒ³ç¨¿é…¬</text>
              <text class="price-value">Â¥{{item.idealPrice}}</text>
            </view>
            <view class="price-item">
              <text class="price-label">æœ€ä½ä»·æ ¼</text>
              <text class="price-value">Â¥{{item.minPrice}}</text>
            </view>
          </view>

          <!-- æ—¶é—´ä¿¡æ¯ -->
          <view class="time-info">
            <text class="time-label">æäº¤æ—¶é—´ï¼š{{item.submitTime}}</text>
            <text class="time-label">é©³å›æ—¶é—´ï¼š{{item.rejectTime}}</text>
          </view>

          <!-- é©³å›åŸå›  -->
          <view wx:if="{{item.rejectReason}}" class="reject-reason">
            <text class="reason-label">é©³å›åŸå› ï¼š</text>
            <text class="reason-text">{{item.rejectReason}}</text>
          </view>

          <!-- ä½œå“é¢„è§ˆ -->
          <view class="works-preview">
            <text class="preview-label">ä½œå“å±•ç¤ºï¼ˆ{{item.finishedWorks.length}}å¼ ï¼‰</text>
            <view class="preview-images">
              <image 
                wx:for="{{item.finishedWorks}}" 
                wx:key="*this" 
                wx:for-item="img"
                src="{{img}}" 
                mode="aspectFill" 
                class="preview-img" 
                catchtap="previewImage"
                data-urls="{{item.finishedWorks}}"
                data-current="{{img}}" />
            </view>
          </view>

          <view class="view-detail-hint">ç‚¹å‡»æŸ¥çœ‹å®Œæ•´è¯¦æƒ… â€º</view>
        </view>
      </view>
    </view>
  </view>

  <!-- é©³å›è¯æœ¯è®¾ç½®æŒ‰é’® -->
  <view class="float-btn" bindtap="showRejectTemplates">
    <text class="float-icon">ğŸ’¬</text>
    <text class="float-text">è¯æœ¯</text>
  </view>

  <!-- é©³å›å¼¹çª— -->
  <view wx:if="{{showRejectModal}}" class="modal-mask" bindtap="hideRejectModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">é©³å›ç”³è¯·</text>
        <view class="modal-close" bindtap="hideRejectModal">Ã—</view>
      </view>
      <view class="modal-body">
        <text class="modal-label">é€‰æ‹©é©³å›åŸå› æˆ–è‡ªå®šä¹‰</text>
        <view class="quick-replies">
          <view 
            wx:for="{{rejectTemplates}}" 
            wx:key="index"
            class="reply-item"
            bindtap="selectTemplate"
            data-text="{{item}}">
            {{item}}
          </view>
        </view>
        <textarea 
          class="reject-input" 
          placeholder="è¯·è¾“å…¥é©³å›åŸå› "
          value="{{rejectReason}}"
          bindinput="onRejectReasonInput"
          maxlength="200" />
        <text class="char-count">{{rejectReason.length}}/200</text>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideRejectModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm-btn" bindtap="confirmReject">ç¡®è®¤é©³å›</button>
      </view>
    </view>
  </view>

  <!-- è¯æœ¯ç®¡ç†å¼¹çª— -->
  <view wx:if="{{showTemplateModal}}" class="modal-mask" bindtap="hideTemplateModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">é©³å›è¯æœ¯ç®¡ç†</text>
        <view class="modal-close" bindtap="hideTemplateModal">Ã—</view>
      </view>
      <view class="modal-body">
        <text class="modal-label">å¿«æ·å›å¤ï¼ˆæœ€å¤š5æ¡ï¼‰</text>
        <view class="template-list">
          <view wx:for="{{rejectTemplates}}" wx:key="index" class="template-item">
            <text class="template-text">{{index + 1}}. {{item}}</text>
            <view class="template-actions">
              <text class="template-btn edit" bindtap="editTemplate" data-index="{{index}}">ç¼–è¾‘</text>
              <text class="template-btn delete" bindtap="deleteTemplate" data-index="{{index}}">åˆ é™¤</text>
            </view>
          </view>
        </view>
        <button wx:if="{{rejectTemplates.length < 5}}" class="add-template-btn" bindtap="addTemplate">+ æ·»åŠ è¯æœ¯</button>
      </view>
      <view class="modal-footer">
        <button class="modal-btn confirm-btn" bindtap="hideTemplateModal">å®Œæˆ</button>
      </view>
    </view>
  </view>
</view>

