<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>
  
  <view wx:else class="detail-page">
    <!-- 商品图片轮播 -->
    <swiper class="image-swiper" 
            indicator-dots="{{true}}" 
            indicator-color="rgba(255,255,255,0.5)"
            indicator-active-color="#A8E6CF"
            circular="{{true}}"
            autoplay="{{true}}"
            interval="{{3000}}">
      <swiper-item wx:for="{{product.images}}" wx:key="*this">
        <image class="swiper-image" src="{{item}}" mode="aspectFill" />
      </swiper-item>
    </swiper>

    <!-- 价格区域 -->
    <view class="price-section">
      <view class="price-row">
        <text class="price-symbol">¥</text>
        <text class="price-value">{{product.price}}</text>
        <text wx:if="{{product.specs && product.specs.length > 0}}" class="price-suffix">起</text>
      </view>
      <view class="sales-info">
        <text class="sales-count">已售 {{product.sales || 0}}</text>
      </view>
    </view>

    <!-- 商品标题 -->
    <view class="title-section">
      <view class="product-name">{{product.name}}</view>
      <view wx:if="{{product.tags && product.tags.length > 0}}" class="tags">
        <view wx:for="{{product.tags}}" wx:key="*this" class="tag">{{item}}</view>
      </view>
    </view>

    <!-- 基础信息 -->
    <view class="info-section">
      <view class="info-row">
        <text class="info-label">出稿时间</text>
        <text class="info-value">{{product.deliveryDays}}天</text>
      </view>
      <view class="info-row" bindtap="viewArtist">
        <text class="info-label">画师</text>
        <text class="info-value">{{artist.name || '未知'}}</text>
        <text class="arrow">›</text>
      </view>
    </view>

    <!-- 商品详情 -->
    <view class="detail-section">
      <view class="section-title">商品详情</view>
      <view class="detail-content">
        <!-- 解析后的内容：文本和图片混排 -->
        <block wx:if="{{summaryContent && summaryContent.length > 0}}">
          <block wx:for="{{summaryContent}}" wx:key="index">
            <!-- 文本块 -->
            <text wx:if="{{item.type === 'text'}}" class="detail-text">{{item.content}}</text>
            <!-- 图片块 -->
            <image wx:if="{{item.type === 'image'}}" 
                   class="detail-image" 
                   src="{{item.content}}" 
                   mode="widthFix" 
                   lazy-load />
          </block>
        </block>
        
        <!-- 如果没有内容，显示默认文本 -->
        <text wx:if="{{!summaryContent || summaryContent.length === 0}}" class="detail-text">暂无详情</text>
      </view>
    </view>

    <!-- 底部占位 -->
    <view class="bottom-placeholder"></view>
  </view>

  <!-- 底部操作栏 -->
  <view wx:if="{{!loading}}" class="bottom-bar">
    <view class="service-btn" bindtap="toggleServiceQR">
      <text class="service-icon">◉</text>
      <text class="service-text">客服</text>
    </view>
    <button class="buy-btn" bindtap="buyProduct">立即购买</button>
  </view>

  <!-- 客服二维码弹窗 -->
  <view class="modal-overlay" wx:if="{{showServiceQR}}" bindtap="toggleServiceQR">
    <view class="modal-content" catchtap="">
      <view class="modal-title">扫码添加客服</view>
      <image class="qr-image" 
             src="{{hasOrder ? orderQR : serviceQR.imageUrl}}" 
             mode="aspectFit" />
      <text class="qr-hint">{{hasOrder ? '专属客服二维码' : '随机客服二维码'}}</text>
      <button class="modal-close" bindtap="toggleServiceQR">关闭</button>
    </view>
  </view>
</view>
