<view class="container">
  <!-- 头部标题栏 -->
  <view class="header-section">
    <view class="header-content">
      <text class="page-title">客服管理</text>
      <view class="add-btn" bindtap="showAddServiceModal">
        <text class="add-icon">+</text>
        <text class="add-text">添加客服</text>
      </view>
    </view>
  </view>

  <!-- 客服列表 -->
  <view class="service-list">
    <view wx:for="{{serviceList}}" wx:key="id" class="service-card">
      <!-- 左侧：头像 -->
      <view class="card-left" bindtap="viewServiceDetail" data-id="{{item.id}}">
        <view class="service-avatar-wrap">
          <image class="service-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="service-number-badge">{{item.serviceNumber}}</view>
        </view>
      </view>

      <!-- 中间：客服信息 -->
      <view class="card-middle" bindtap="viewServiceDetail" data-id="{{item.id}}">
        <view class="service-info-top">
          <text class="service-name">{{item.name}}</text>
          <view class="status-badge {{item.isActive ? 'badge-online' : 'badge-offline'}}">
            <view class="status-dot"></view>
            <text class="status-text">{{item.isActive ? '在线' : '离线'}}</text>
          </view>
        </view>
        <text class="service-id">编号：KF{{item.serviceNumber}}</text>
      </view>

      <!-- 右侧：操作区 -->
      <view class="card-right">
        <view class="switch-container">
          <switch 
            class="status-switch" 
            checked="{{item.isActive}}" 
            bindchange="toggleServiceStatus" 
            data-id="{{item.id}}" 
            color="#66BB6A" />
        </view>
        <view 
          class="edit-icon" 
          catchtap="viewServiceDetail" 
          data-id="{{item.id}}">
          <text class="icon-text">···</text>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view wx:if="{{serviceList.length === 0}}" class="empty-state">
      <view class="empty-icon"></view>
      <text class="empty-text">暂无客服</text>
      <text class="empty-hint">点击右上角按钮添加客服</text>
    </view>
  </view>

  <!-- 客服详情弹窗 -->
  <view wx:if="{{showDetailModal}}" class="detail-modal-overlay" catchtap="hideDetailModal">
    <view class="detail-modal-content" catchtap="stopPropagation">
      <view class="detail-modal-header">
        <text class="detail-modal-title">客服详情</text>
        <view class="detail-modal-close" catchtap="hideDetailModal">×</view>
      </view>
      
      <view class="detail-modal-body">
        <!-- 客服基本信息 -->
        <view class="detail-info-section">
          <view class="detail-avatar-wrap">
            <image class="detail-avatar" src="{{currentService.avatar}}" mode="aspectFill" />
            <view class="detail-number-badge">{{currentService.serviceNumber}}</view>
          </view>
          <view class="detail-info">
            <text class="detail-name">{{currentService.name}}</text>
            <text class="detail-id">客服编号：KF{{currentService.serviceNumber}}</text>
            <text class="detail-wechat">微信号：{{currentService.wechatId || '未设置'}}</text>
            <view class="detail-status">
              <text class="detail-status-label">状态：</text>
              <view class="status-badge {{currentService.isActive ? 'active' : 'inactive'}}">
                {{currentService.isActive ? '在线' : '离线'}}
              </view>
            </view>
          </view>
        </view>

        <!-- 二维码区域 -->
        <view class="detail-qrcode-section">
          <view class="detail-section-title">客服二维码</view>
          <view wx:if="{{currentService.qrcodeUrl}}" class="detail-qrcode-display">
            <image class="detail-qrcode-image" src="{{currentService.qrcodeUrl}}" mode="aspectFit" />
            <text class="detail-qrcode-label">编号: {{currentService.qrcodeNumber}}</text>
            <button class="detail-action-btn secondary" catchtap="changeQrcode" data-id="{{currentService.id}}">
              更换二维码
            </button>
          </view>
          <view wx:else class="detail-qrcode-empty">
            <text class="detail-empty-hint">暂未绑定客服二维码</text>
            <button class="detail-action-btn primary" catchtap="bindQrcode" data-id="{{currentService.id}}">
              上传二维码
            </button>
          </view>
        </view>

        <!-- 操作按钮 -->
        <view class="detail-actions">
          <button class="detail-action-btn danger" catchtap="deleteService" data-id="{{currentService.id}}">
            移除客服
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- 添加客服弹窗 -->
  <view wx:if="{{showAddModal}}" class="modal-overlay" catchtap="hideAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">添加客服</text>
        <view class="modal-close" catchtap="hideAddModal">×</view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">用户ID *</text>
          <input class="form-input" 
                 type="number" 
                 placeholder="请输入用户ID" 
                 value="{{newService.userId}}"
                 bindinput="onUserIdInput" />
          <text class="form-hint">输入现有用户的ID，将其设置为客服</text>
        </view>

        <view class="form-item">
          <text class="form-label">客服姓名 *</text>
          <input class="form-input" 
                 placeholder="请输入客服姓名" 
                 value="{{newService.name}}"
                 bindinput="onNameInput" />
        </view>

        <view class="form-item">
          <text class="form-label">微信号</text>
          <input class="form-input" 
                 placeholder="请输入微信号（选填）" 
                 value="{{newService.wechatId}}"
                 bindinput="onWechatIdInput" />
        </view>

        <view class="form-item">
          <text class="form-label">客服二维码</text>
          <view class="qrcode-upload">
            <view wx:if="{{newService.qrcodeUrl}}" class="qrcode-preview">
              <image class="preview-image" src="{{newService.qrcodeUrl}}" mode="aspectFit" />
              <view class="preview-remove" catchtap="removeQrcode">×</view>
            </view>
            <button wx:else class="upload-btn" bindtap="uploadQrcode">
              <text class="upload-icon">+</text>
              <text class="upload-text">上传二维码</text>
            </button>
          </view>
          <text class="form-hint">上传客服个人微信二维码</text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn cancel-btn" catchtap="hideAddModal">取消</button>
        <button class="modal-btn confirm-btn" catchtap="confirmAddService">确认添加</button>
      </view>
    </view>
  </view>
</view>