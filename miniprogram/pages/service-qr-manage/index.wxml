<view class="container">
  <!-- 头部标题栏 -->
  <view class="header-section">
    <view class="header-content">
      <text class="page-title">客服管理</text>
      <button class="add-btn" bindtap="showAddServiceModal">
        <text class="add-icon">+</text>
        添加客服
      </button>
    </view>
  </view>

  <!-- 客服列表 -->
  <view class="service-list">
    <view wx:for="{{serviceList}}" wx:key="id" class="service-card" bindtap="editService" data-id="{{item.id}}">
      <!-- 左侧：头像 -->
      <view class="card-left">
        <view class="service-avatar-wrap">
          <image class="service-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="service-number-badge">{{item.serviceNumber}}</view>
        </view>
      </view>

      <!-- 中间：客服信息 -->
      <view class="card-middle">
        <view class="service-name-row">
          <text class="service-name">{{item.name}}</text>
          <view class="status-badge {{item.isActive ? 'active' : 'inactive'}}">
            {{item.isActive ? '在线' : '离线'}}
          </view>
        </view>
        <text class="service-id">KF{{item.serviceNumber}}</text>
      </view>

      <!-- 右侧：二维码缩略图 -->
      <view class="card-right" catchtap="viewQrcode" data-id="{{item.id}}">
        <view wx:if="{{item.qrcodeUrl}}" class="qrcode-thumb-wrap">
          <image class="qrcode-thumb" src="{{item.qrcodeUrl}}" mode="aspectFit" />
          <text class="qrcode-label">二维码{{item.qrcodeNumber}}</text>
        </view>
        <view wx:else class="qrcode-empty" catchtap="bindQrcode" data-id="{{item.id}}">
          <text class="qrcode-empty-icon">+</text>
          <text class="qrcode-empty-text">绑定</text>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view wx:if="{{serviceList.length === 0}}" class="empty-state">
      <view class="empty-icon"></view>
      <text class="empty-text">暂无客服</text>
      <text class="empty-hint">点击右上角按钮添加客服</text>
    </view>
  </view>

  <!-- 查看二维码弹窗 -->
  <view wx:if="{{showQrcodeModal}}" class="qrcode-modal-overlay" catchtap="hideQrcodeModal">
    <view class="qrcode-modal-content" catchtap="stopPropagation">
      <view class="qrcode-modal-header">
        <text class="qrcode-modal-title">客服二维码</text>
        <view class="qrcode-modal-close" catchtap="hideQrcodeModal">×</view>
      </view>
      <view class="qrcode-modal-body">
        <image class="qrcode-full-image" src="{{currentQrcode.url}}" mode="aspectFit" />
        <text class="qrcode-full-label">编号: {{currentQrcode.number}}</text>
        <button class="change-qrcode-btn" catchtap="changeQrcode" data-id="{{currentQrcode.serviceId}}">
          更换二维码
        </button>
      </view>
    </view>
  </view>

  <!-- 添加客服弹窗 -->
  <view wx:if="{{showAddModal}}" class="modal-overlay" catchtap="hideAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">添加客服</text>
        <view class="modal-close" catchtap="hideAddModal">×</view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">用户ID *</text>
          <input class="form-input" 
                 type="number" 
                 placeholder="请输入用户ID" 
                 value="{{newService.userId}}"
                 bindinput="onUserIdInput" />
          <text class="form-hint">输入现有用户的ID，将其设置为客服</text>
        </view>

        <view class="form-item">
          <text class="form-label">客服姓名 *</text>
          <input class="form-input" 
                 placeholder="请输入客服姓名" 
                 value="{{newService.name}}"
                 bindinput="onNameInput" />
        </view>

        <view class="form-item">
          <text class="form-label">微信号</text>
          <input class="form-input" 
                 placeholder="请输入微信号（选填）" 
                 value="{{newService.wechatId}}"
                 bindinput="onWechatIdInput" />
        </view>

        <view class="form-item">
          <text class="form-label">客服二维码</text>
          <view class="qrcode-upload">
            <view wx:if="{{newService.qrcodeUrl}}" class="qrcode-preview">
              <image class="preview-image" src="{{newService.qrcodeUrl}}" mode="aspectFit" />
              <view class="preview-remove" catchtap="removeQrcode">×</view>
            </view>
            <button wx:else class="upload-btn" bindtap="uploadQrcode">
              <text class="upload-icon">+</text>
              <text class="upload-text">上传二维码</text>
            </button>
          </view>
          <text class="form-hint">上传客服个人微信二维码</text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn cancel-btn" catchtap="hideAddModal">取消</button>
        <button class="modal-btn confirm-btn" catchtap="confirmAddService">确认添加</button>
      </view>
    </view>
  </view>
</view>