<view class="container">
  <!-- 头部标题栏 -->
  <view class="header-section">
    <view class="header-content">
      <text class="page-title">客服管理</text>
      <button class="add-btn" bindtap="showAddServiceModal">
        <text class="add-icon">+</text>
        添加客服
      </button>
    </view>
  </view>

  <!-- 客服列表 -->
  <view class="service-list">
    <view wx:for="{{serviceList}}" wx:key="id" class="service-card">
      <!-- 客服信息 -->
      <view class="service-info">
        <view class="service-avatar-wrap">
          <image class="service-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="service-number-badge">{{item.serviceNumber}}</view>
        </view>
        
        <view class="service-details">
          <view class="service-name-row">
            <text class="service-name">{{item.name}}</text>
            <view class="status-badge {{item.isActive ? 'active' : 'inactive'}}">
              {{item.isActive ? '在线' : '离线'}}
            </view>
          </view>
          <text class="service-id">客服编号：KF{{item.serviceNumber}}</text>
          <text class="service-contact">微信：{{item.wechatId || '未设置'}}</text>
        </view>
      </view>

      <!-- 二维码信息 -->
      <view class="qrcode-section">
        <view class="qrcode-header">
          <text class="qrcode-title">客服二维码</text>
          <button wx:if="{{!item.qrcodeUrl}}" class="bind-qr-btn" bindtap="bindQrcode" data-id="{{item.id}}">
            绑定二维码
          </button>
          <button wx:else class="change-qr-btn" bindtap="changeQrcode" data-id="{{item.id}}">
            更换
          </button>
        </view>
        
        <view wx:if="{{item.qrcodeUrl}}" class="qrcode-display">
          <image class="qrcode-image" src="{{item.qrcodeUrl}}" mode="aspectFit" />
          <view class="qrcode-number">编号: {{item.qrcodeNumber}}</view>
        </view>
        <view wx:else class="qrcode-placeholder">
          <text class="placeholder-text">未绑定二维码</text>
        </view>
      </view>

      <!-- 统计信息 -->
      <view class="service-stats">
        <view class="stat-item">
          <text class="stat-value">{{item.orderCount || 0}}</text>
          <text class="stat-label">接单数</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{item.processingCount || 0}}</text>
          <text class="stat-label">处理中</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{item.completedCount || 0}}</text>
          <text class="stat-label">已完成</text>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="service-actions">
        <button class="action-btn edit-btn" bindtap="editService" data-id="{{item.id}}">
          编辑资料
        </button>
        <button class="action-btn toggle-btn" bindtap="toggleServiceStatus" data-id="{{item.id}}" data-active="{{item.isActive}}">
          {{item.isActive ? '设为离线' : '设为在线'}}
        </button>
        <button class="action-btn delete-btn" bindtap="deleteService" data-id="{{item.id}}">
          移除客服
        </button>
      </view>
    </view>

    <!-- 空状态 -->
    <view wx:if="{{serviceList.length === 0}}" class="empty-state">
      <view class="empty-icon"></view>
      <text class="empty-text">暂无客服</text>
      <text class="empty-hint">点击右上角按钮添加客服</text>
    </view>
  </view>

  <!-- 添加客服弹窗 -->
  <view wx:if="{{showAddModal}}" class="modal-overlay" catchtap="hideAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">添加客服</text>
        <view class="modal-close" catchtap="hideAddModal">×</view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">用户ID *</text>
          <input class="form-input" 
                 type="number" 
                 placeholder="请输入用户ID" 
                 value="{{newService.userId}}"
                 bindinput="onUserIdInput" />
          <text class="form-hint">输入现有用户的ID，将其设置为客服</text>
        </view>

        <view class="form-item">
          <text class="form-label">客服姓名 *</text>
          <input class="form-input" 
                 placeholder="请输入客服姓名" 
                 value="{{newService.name}}"
                 bindinput="onNameInput" />
        </view>

        <view class="form-item">
          <text class="form-label">微信号</text>
          <input class="form-input" 
                 placeholder="请输入微信号（选填）" 
                 value="{{newService.wechatId}}"
                 bindinput="onWechatIdInput" />
        </view>

        <view class="form-item">
          <text class="form-label">客服二维码</text>
          <view class="qrcode-upload">
            <view wx:if="{{newService.qrcodeUrl}}" class="qrcode-preview">
              <image class="preview-image" src="{{newService.qrcodeUrl}}" mode="aspectFit" />
              <view class="preview-remove" catchtap="removeQrcode">×</view>
            </view>
            <button wx:else class="upload-btn" bindtap="uploadQrcode">
              <text class="upload-icon">+</text>
              <text class="upload-text">上传二维码</text>
            </button>
          </view>
          <text class="form-hint">上传客服个人微信二维码</text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn cancel-btn" catchtap="hideAddModal">取消</button>
        <button class="modal-btn confirm-btn" catchtap="confirmAddService">确认添加</button>
      </view>
    </view>
  </view>
</view>