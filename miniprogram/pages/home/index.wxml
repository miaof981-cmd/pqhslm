<view class="container">
  <!-- 轮播图 -->
  <swiper class="banner-swiper" style="height: {{bannerHeight}}px;" autoplay="{{true}}" indicator-dots="{{true}}" circular="{{true}}" indicator-color="rgba(255,255,255,0.5)" indicator-active-color="#A8E6CF">
    <swiper-item wx:for="{{banners}}" wx:key="*this">
      <image class="banner-image" src="{{item}}" mode="widthFix" bindload="onBannerImageLoad" />
    </swiper-item>
  </swiper>

  <!-- 公告滚动条 -->
  <view class="notice-ticker" wx:if="{{notices.length > 0}}">
    <view class="notice-icon"></view>
    <scroll-view class="notice-scroll" scroll-x="{{true}}" show-scrollbar="{{false}}">
      <text wx:for="{{notices}}" wx:key="id" 
            class="notice-item" 
            data-id="{{item._id}}" 
            bindtap="onNoticeTap">
        {{item.title}}
      </text>
    </scroll-view>
  </view>

  <!-- 搜索筛选栏 -->
  <view class="search-filter-bar">
    <view class="search-input" bindtap="onSearch">
      <view class="search-icon"></view>
      <text class="search-placeholder">搜索你想要的画师作品</text>
    </view>
    <view class="filter-btn" bindtap="toggleFilter">
      <view class="filter-icon"></view>
      <text class="filter-text">筛选</text>
    </view>
  </view>

  <!-- 推荐区域 -->
  <view wx:if="{{currentCategory === 'all' && recommendProducts.length > 0}}" class="recommend-section">
    <view class="hot-title">
      <view class="hot-icon">HOT</view>
      <text class="hot-text">为你推荐</text>
    </view>
    <view class="product-grid">
      <view wx:for="{{recommendProducts}}" wx:key="_id" 
            class="product-card" 
            data-id="{{item._id}}" 
            bindtap="onProductTap">
        <!-- 商品图片（正方形） -->
        <view class="product-image-wrapper">
          <image class="product-image" src="{{item.coverImage}}" mode="aspectFill"></image>
        </view>
        <!-- 商品信息 -->
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-meta">
            <view class="product-price">¥{{item.price}}</view>
            <view class="product-delivery delivery-{{item.deliveryDays <= 1 ? 'fast' : (item.deliveryDays <= 3 ? 'quick' : (item.deliveryDays <= 7 ? 'normal' : 'slow'))}}">
              <text wx:if="{{item.deliveryDays === 1}}">极速出稿</text>
              <text wx:else>{{item.deliveryDays}}天出稿</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 筛选面板 -->
  <view class="filter-panel {{showFilter ? 'show' : ''}}">
    <view class="filter-mask" bindtap="toggleFilter"></view>
    <view class="filter-content">
      <view class="filter-header">
        <text class="filter-title">筛选条件</text>
        <view class="filter-close" bindtap="toggleFilter">×</view>
      </view>
      <view class="filter-body">
        <!-- 商品分类 -->
        <view class="filter-section">
          <view class="section-title">商品分类</view>
          <view class="filter-group">
            <view wx:for="{{categories}}" wx:key="id" 
                  class="filter-item {{item.active ? 'active' : ''}}" 
                  data-id="{{item.id}}" 
                  bindtap="switchCategory">
              <text class="filter-item-name">{{item.name}}</text>
            </view>
          </view>
        </view>
        
        <!-- 出稿时间排序 -->
        <view class="filter-section">
          <view class="section-title">出稿时间</view>
          <view class="filter-group">
            <view class="filter-item {{deliverySort === 'default' ? 'active' : ''}}" 
                  data-sort="default" 
                  bindtap="changeDeliverySort">
              <text class="filter-item-name">默认排序</text>
            </view>
            <view class="filter-item {{deliverySort === 'fastest' ? 'active' : ''}}" 
                  data-sort="fastest" 
                  bindtap="changeDeliverySort">
              <text class="filter-item-name">最快优先</text>
            </view>
            <view class="filter-item {{deliverySort === 'slowest' ? 'active' : ''}}" 
                  data-sort="slowest" 
                  bindtap="changeDeliverySort">
              <text class="filter-item-name">最慢优先</text>
            </view>
          </view>
        </view>
      </view>
      <view class="filter-footer">
        <button class="filter-reset" bindtap="resetFilter">重置</button>
        <button class="filter-confirm" bindtap="confirmFilter">确定</button>
      </view>
    </view>
  </view>

  <!-- 全部商品区域 -->
  <view class="product-section">
    <view class="divider-title">
      <view class="divider-line"></view>
      <text class="divider-text">{{currentCategoryName}}</text>
      <view class="divider-line"></view>
      <text wx:if="{{currentCategory !== 'all'}}" class="clear-filter" bindtap="clearFilter">取消筛选</text>
    </view>
    
    <view wx:if="{{loading}}" class="loading-state">
      <text>加载中...</text>
    </view>
    
    <view wx:elif="{{products.length === 0}}" class="empty-state">
      <text>暂无商品</text>
    </view>
    
    <view wx:else class="product-grid">
      <view wx:for="{{products}}" wx:key="_id" 
            class="product-card" 
            data-id="{{item._id}}" 
            bindtap="onProductTap">
        
        <!-- 商品图片（正方形） -->
        <view class="product-image-wrapper">
          <image class="product-image" src="{{item.coverImage}}" mode="aspectFill"></image>
        </view>
        
        <!-- 商品信息 -->
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-meta">
            <view class="product-price">¥{{item.price}}</view>
            <view class="product-delivery delivery-{{item.deliveryDays <= 1 ? 'fast' : (item.deliveryDays <= 3 ? 'quick' : (item.deliveryDays <= 7 ? 'normal' : 'slow'))}}">
              <text wx:if="{{item.deliveryDays === 1}}">极速出稿</text>
              <text wx:else>{{item.deliveryDays}}天出稿</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 🧪 临时测试按钮 - 快速创建测试商品 -->
  <view class="temp-test-btn" bindtap="showTestMenu">
    <text class="test-btn-text">测试</text>
  </view>

  <!-- 测试商品选择弹窗 -->
  <view wx:if="{{showTestModal}}" class="test-modal-mask" bindtap="hideTestMenu">
    <view class="test-modal" catchtap="stopPropagation">
      <view class="test-modal-title">创建测试商品</view>
      <view class="test-options">
        <view class="test-option" bindtap="createTestProduct" data-type="single">
          <text class="option-icon">📦</text>
          <text class="option-text">单一价格商品</text>
        </view>
        <view class="test-option" bindtap="createTestProduct" data-type="spec">
          <text class="option-icon">📋</text>
          <text class="option-text">多规格商品</text>
        </view>
      </view>
      <view class="test-modal-close" bindtap="hideTestMenu">取消</view>
    </view>
  </view>
</view>
