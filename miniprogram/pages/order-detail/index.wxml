<view class="order-detail-container">
  <view wx:if="{{loading}}" class="loading">加载中...</view>
  
  <view wx:else class="detail-content">
    <!-- 订单状态卡片 -->
    <view class="status-card">
      <view class="status-header">
        <view class="status-icon status-{{order.status}}"></view>
        <view class="status-info">
          <text class="status-text">{{order.statusText}}</text>
          <view class="order-id-row">
            <text class="order-id-label">订单号：{{order.id}}</text>
            <view class="copy-actions">
              <view class="copy-btn" bindtap="copyOrderNo" catchtap="copyOrderNo">
                <view class="copy-icon"></view>
              </view>
              <view class="copy-btn copy-group" bindtap="copyGroupName" catchtap="copyGroupName">
                <view class="group-icon"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 进度条 -->
      <view class="progress-bar">
        <view class="progress-step {{order.step >= 1 ? 'active' : ''}}">
          <view class="step-dot"></view>
          <text class="step-label">已下单</text>
        </view>
        <view class="progress-line {{order.step >= 2 ? 'active' : ''}}"></view>
        <view class="progress-step {{order.step >= 2 ? 'active' : ''}}">
          <view class="step-dot"></view>
          <text class="step-label">制作中</text>
        </view>
        <view class="progress-line {{order.step >= 3 ? 'active' : ''}}"></view>
        <view class="progress-step {{order.step >= 3 ? 'active' : ''}}">
          <view class="step-dot"></view>
          <text class="step-label">已完成</text>
        </view>
      </view>
    </view>

    <!-- 商品信息 -->
    <view class="section-card">
      <view class="section-title">商品信息</view>
      <view class="product-detail">
        <image class="product-image" src="{{order.productImage}}" mode="aspectFill"/>
        <view class="product-info">
          <text class="product-name">{{order.productName}}</text>
          <text class="product-spec">规格：{{order.spec}}</text>
          <view class="product-price-row">
            <text class="price-label">金额：</text>
            <text class="price-symbol">¥</text>
            <text class="price-value">{{order.price}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 时间信息 -->
    <view class="section-card">
      <view class="section-title">时间信息</view>
      <view class="info-row">
        <text class="info-label">下单时间</text>
        <text class="info-value">{{order.createTime}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">截稿时间</text>
        <text class="info-value {{order.urgent ? 'urgent' : ''}}">{{order.deadline}}</text>
      </view>
      <view wx:if="{{order.completedTime}}" class="info-row">
        <text class="info-label">完成时间</text>
        <text class="info-value">{{order.completedTime}}</text>
      </view>
    </view>

    <!-- 客户信息（画师视角） -->
    <view wx:if="{{userRole === 'artist'}}" class="section-card people-card">
      <view class="section-title">客户信息</view>
      <view class="people-info">
        <image class="people-avatar" src="{{order.buyerAvatar || '/assets/default-avatar.png'}}" mode="aspectFill"/>
        <view class="people-detail">
          <text class="people-name">{{order.buyerName || '匿名用户'}}</text>
          <text class="people-label">客户</text>
        </view>
      </view>
    </view>

    <!-- 客服信息（画师视角） -->
    <view wx:if="{{userRole === 'artist'}}" class="section-card people-card">
      <view class="section-title">对接客服</view>
      <view class="people-info">
        <image class="people-avatar" src="{{order.serviceAvatar || '/assets/default-avatar.png'}}" mode="aspectFill"/>
        <view class="people-detail">
          <text class="people-name">{{order.serviceName || '待分配'}}</text>
          <text class="people-label">客服</text>
        </view>
      </view>
    </view>

    <!-- 画师信息（买家可见） -->
    <view wx:if="{{userRole === 'customer'}}" class="section-card people-card">
      <view class="section-title">画师信息</view>
      <view class="people-info">
        <image class="people-avatar" src="{{order.artistAvatar || '/assets/default-avatar.png'}}" mode="aspectFill"/>
        <view class="people-detail">
          <text class="people-name">{{order.artistName}}</text>
          <text class="people-label">画师</text>
        </view>
      </view>
    </view>

    <!-- 客服二维码（买家可见） -->
    <view wx:if="{{userRole === 'customer'}}" class="section-card qr-section">
      <view class="section-title">联系客服</view>
      <view class="qr-container">
        <image class="qr-image" src="https://via.placeholder.com/400x400.png?text=客服二维码" mode="aspectFit"/>
        <text class="qr-hint">长按识别二维码添加客服微信</text>
        <text class="qr-desc">客服会与您进一步沟通绘画要求</text>
      </view>
    </view>

    <!-- 打赏区域 -->
    <view wx:if="{{userRole === 'customer' && order.status === 'completed'}}" class="reward-card">
      <view class="reward-header">
        <view class="reward-icon"></view>
        <text class="reward-title">对作品满意？给画师打赏吧~</text>
      </view>
      <view class="reward-amounts">
        <view wx:for="{{rewardOptions}}" wx:key="*this" 
              class="reward-option {{selectedReward === item ? 'selected' : ''}}"
              bindtap="selectReward"
              data-amount="{{item}}">
          ¥{{item}}
        </view>
        <view class="reward-option custom" bindtap="showCustomReward">
          自定义
        </view>
      </view>
      <button class="reward-btn" bindtap="confirmReward" disabled="{{!selectedReward}}">
        确认打赏
      </button>
    </view>

    <!-- 操作按钮区 -->
    <view class="action-buttons">
      <!-- 画师操作 -->
      <view wx:if="{{userRole === 'artist'}}" class="button-group">
        <button wx:if="{{order.status !== 'completed' && order.status !== 'waitingConfirm'}}" class="btn-primary btn-full" bindtap="markComplete">
          标记已完成
        </button>
        <view wx:elif="{{order.status === 'waitingConfirm'}}" class="completion-tip">
          <text class="tip-icon">✓</text>
          <text class="tip-text">已标记完成，等待客户确认</text>
        </view>
      </view>
      
      <!-- 买家操作 -->
      <view wx:if="{{userRole === 'customer'}}" class="button-group">
        <button wx:if="{{order.status === 'inProgress'}}" class="btn-primary btn-full" bindtap="confirmComplete">
          确认完成
        </button>
      </view>
    </view>
  </view>
</view>
