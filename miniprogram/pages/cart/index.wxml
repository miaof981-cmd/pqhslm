<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:elif="{{cartItems.length > 0}}" class="cart-content">
    <!-- è´­ç‰©è½¦åˆ—è¡¨ -->
    <view class="cart-list">
      <view wx:for="{{cartItems}}" wx:key="_id" class="cart-item {{item.selected ? 'selected' : ''}}">
        <!-- é€‰æ‹©æ¡† -->
        <view class="checkbox" data-id="{{item._id}}" bindtap="toggleSelect">
          <view wx:if="{{item.selected}}" class="checkbox-checked"></view>
        </view>

        <!-- å•†å“ä¿¡æ¯ -->
        <view class="item-content" bindtap="viewProduct" data-id="{{item.productId}}">
          <image class="product-image" src="{{item.productImage}}" mode="aspectFill"></image>
          <view class="product-info">
            <text class="product-name">{{item.productName}}</text>
            <!-- è§„æ ¼ä¿¡æ¯ -->
            <view wx:if="{{item.specText}}" class="product-spec">
              <text class="spec-label">è§„æ ¼ï¼š</text>
              <text class="spec-value">{{item.specText}}</text>
            </view>
            <view class="product-footer">
              <text class="product-price">Â¥{{item.price}}</text>
              <!-- ğŸ¯ ä¿®å¤ï¼šé˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…ç‚¹å‡»+/-æ—¶è·³è½¬å•†å“è¯¦æƒ… -->
              <view class="quantity-control" catchtap="stopPropagation">
                <button class="quantity-btn minus" data-id="{{item._id}}" catchtap="decreaseQuantity">-</button>
                <text class="quantity-text">{{item.quantity}}</text>
                <button class="quantity-btn plus" data-id="{{item._id}}" catchtap="increaseQuantity">+</button>
              </view>
            </view>
          </view>
        </view>

        <!-- åˆ é™¤æŒ‰é’® -->
        <view class="delete-btn" data-id="{{item._id}}" bindtap="deleteItem">
          <text class="delete-icon">Ã—</text>
        </view>
      </view>
    </view>

    <!-- æ¨èå•†å“ -->
    <view wx:if="{{recommendProducts.length > 0}}" class="recommend-section">
      <view class="recommend-header">
        <text class="recommend-title">ä¸ºä½ æ¨è</text>
      </view>
      <view class="recommend-list">
        <view wx:for="{{recommendProducts}}" wx:key="_id" class="recommend-item" bindtap="viewProduct" data-id="{{item._id}}">
          <view class="recommend-image-wrapper">
            <image class="recommend-image" src="{{item.image}}" mode="aspectFill"></image>
          </view>
          <text class="recommend-name">{{item.name}}</text>
          <view class="recommend-footer">
            <text class="recommend-price">Â¥{{item.price}}</text>
            <view class="recommend-delivery delivery-{{item.deliveryDays <= 1 ? 'fast' : (item.deliveryDays <= 3 ? 'quick' : (item.deliveryDays <= 7 ? 'normal' : 'slow'))}}">
              <text wx:if="{{item.deliveryDays === 1}}">æé€Ÿå‡ºç¨¿</text>
              <text wx:else>{{item.deliveryDays}}å¤©å‡ºç¨¿</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-cart-content">
    <view class="empty-state">
      <view class="empty-icon"></view>
      <text class="empty-text">è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ</text>
      <button class="go-shopping-btn" bindtap="goShopping">å»é€›é€›</button>
    </view>

    <!-- ç©ºè´­ç‰©è½¦æ—¶çš„æ¨èå•†å“ -->
    <view wx:if="{{recommendProducts.length > 0}}" class="recommend-section">
      <view class="recommend-header">
        <text class="recommend-title">ä¸ºä½ æ¨è</text>
      </view>
      <view class="recommend-list">
        <view wx:for="{{recommendProducts}}" wx:key="_id" class="recommend-item" bindtap="viewProduct" data-id="{{item._id}}">
          <view class="recommend-image-wrapper">
            <image class="recommend-image" src="{{item.image}}" mode="aspectFill"></image>
          </view>
          <text class="recommend-name">{{item.name}}</text>
          <view class="recommend-footer">
            <text class="recommend-price">Â¥{{item.price}}</text>
            <view class="recommend-delivery delivery-{{item.deliveryDays <= 1 ? 'fast' : (item.deliveryDays <= 3 ? 'quick' : (item.deliveryDays <= 7 ? 'normal' : 'slow'))}}">
              <text wx:if="{{item.deliveryDays === 1}}">æé€Ÿå‡ºç¨¿</text>
              <text wx:else>{{item.deliveryDays}}å¤©å‡ºç¨¿</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view wx:if="{{cartItems.length > 0}}" class="bottom-bar">
    <view class="select-all" bindtap="toggleSelectAll">
      <view class="checkbox {{allSelected ? 'checked' : ''}}">
        <view wx:if="{{allSelected}}" class="checkbox-checked"></view>
      </view>
      <text class="select-all-text">å…¨é€‰</text>
    </view>

    <view class="total-info">
      <text class="total-label">åˆè®¡ï¼š</text>
      <text class="total-price">Â¥{{totalPrice}}</text>
    </view>

    <button class="checkout-btn {{selectedCount > 0 ? 'active' : ''}}" bindtap="checkout">
      ç»“ç®—({{selectedCount}})
    </button>
  </view>
</view>
