<view class="diagnosis-page">
  <view class="page-header">
    <text class="page-title">è®¢å•è¯Šæ–­å·¥å…·</text>
    <text class="page-desc">æ£€æŸ¥è®¢å•ç»Ÿè®¡å·®å¼‚åŸå› </text>
  </view>

  <view wx:if="{{loading}}" class="loading-box">
    <text>è¯Šæ–­ä¸­...</text>
  </view>

  <view wx:else class="diagnosis-result">
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="result-card">
      <view class="card-title">ğŸ“Š ç»Ÿè®¡å¯¹æ¯”</view>
      <view class="stat-row">
        <text class="stat-label">ç®¡ç†åå°å¾…å¤„ç†:</text>
        <text class="stat-value highlight">{{summary.adminPending}}ä¸ª</text>
      </view>
      <view class="stat-row">
        <text class="stat-label">ç”¨æˆ·/ç”»å¸ˆåˆ¶ä½œä¸­:</text>
        <text class="stat-value">{{summary.userProcessing}}ä¸ª</text>
      </view>
      <view class="stat-row">
        <text class="stat-label">å·®å¼‚:</text>
        <text class="stat-value {{summary.difference > 0 ? 'warning' : ''}}">{{summary.difference}}ä¸ª</text>
      </view>
    </view>

    <!-- è¯¦ç»†åˆ†å¸ƒ -->
    <view class="result-card">
      <view class="card-title">ğŸ“‹ è¯¦ç»†åˆ†å¸ƒ</view>
      <view class="status-list">
        <view class="status-item">
          <text class="status-label">å¾…æ”¯ä»˜:</text>
          <text class="status-count">{{statusBreakdown.unpaid}}ä¸ª</text>
        </view>
        <view class="status-item">
          <text class="status-label">å·²æ”¯ä»˜:</text>
          <text class="status-count">{{statusBreakdown.paid}}ä¸ª</text>
        </view>
        <view class="status-item">
          <text class="status-label">åˆ¶ä½œä¸­:</text>
          <text class="status-count">{{statusBreakdown.processing}}ä¸ª</text>
        </view>
        <view class="status-item">
          <text class="status-label">å¾…ç¡®è®¤:</text>
          <text class="status-count">{{statusBreakdown.waiting}}ä¸ª</text>
        </view>
        <view class="status-item">
          <text class="status-label">ä¸´è¿‘æˆªç¨¿:</text>
          <text class="status-count">{{statusBreakdown.nearDeadline}}ä¸ª</text>
        </view>
      </view>
    </view>

    <!-- æ•°æ®æºæ£€æŸ¥ -->
    <view class="result-card">
      <view class="card-title">ğŸ’¾ æ•°æ®æºæ£€æŸ¥</view>
      <view class="source-list">
        <view class="source-item">
          <text class="source-name">orders:</text>
          <text class="source-count">{{dataSources.orders}}ä¸ª</text>
        </view>
        <view class="source-item">
          <text class="source-name">pending_orders:</text>
          <text class="source-count">{{dataSources.pending}}ä¸ª</text>
        </view>
        <view class="source-item">
          <text class="source-name">mock_orders:</text>
          <text class="source-count">{{dataSources.mock}}ä¸ª</text>
        </view>
        <view class="source-item">
          <text class="source-name">å»é‡åæ€»æ•°:</text>
          <text class="source-count highlight">{{dataSources.total}}ä¸ª</text>
        </view>
      </view>
      
      <view wx:if="{{duplicates.length > 0}}" class="warning-box">
        <text class="warning-icon">âš ï¸</text>
        <text class="warning-text">å‘ç°{{duplicates.length}}ä¸ªé‡å¤è®¢å•</text>
      </view>
    </view>

    <!-- å·®å¼‚è®¢å•è¯¦æƒ… -->
    <view wx:if="{{extraOrders.length > 0}}" class="result-card">
      <view class="card-title">ğŸš¨ å·®å¼‚è®¢å•ï¼ˆä»…åœ¨ç®¡ç†åå°ç»Ÿè®¡ï¼‰</view>
      <view wx:for="{{extraOrders}}" wx:key="id" class="order-item">
        <view class="order-header">
          <text class="order-id">è®¢å• {{item.id}}</text>
          <view class="order-status status-{{item.status}}">{{item.status}}</view>
        </view>
        <view class="order-info">
          <text class="info-text">å•†å“: {{item.product}}</text>
          <text class="info-text">ä¹°å®¶: {{item.buyer}}</text>
          <text class="info-text">ç”»å¸ˆID: {{item.artistId || 'æ— '}}</text>
        </view>
      </view>
    </view>

    <!-- é—®é¢˜åˆ†æ -->
    <view class="result-card">
      <view class="card-title">ğŸ’¡ å¯èƒ½åŸå› </view>
      <view class="reason-list">
        <view wx:if="{{duplicates.length > 0}}" class="reason-item">
          <text class="reason-icon">1ï¸âƒ£</text>
          <text class="reason-text">æ•°æ®æºé‡å¤ï¼šåŒä¸€è®¢å•å­˜å‚¨åœ¨å¤šä¸ªåœ°æ–¹</text>
        </view>
        <view wx:if="{{statusBreakdown.unpaid > 0}}" class="reason-item">
          <text class="reason-icon">2ï¸âƒ£</text>
          <text class="reason-text">æœ‰{{statusBreakdown.unpaid}}ä¸ªå¾…æ”¯ä»˜è®¢å•ï¼ˆå¼‚å¸¸ï¼Œåº”è¯¥ä¸å­˜åœ¨ï¼‰</text>
        </view>
        <view wx:if="{{extraOrders.length > 0 && statusBreakdown.unpaid === 0}}" class="reason-item">
          <text class="reason-icon">3ï¸âƒ£</text>
          <text class="reason-text">è®¢å•ç”»å¸ˆIDä¸åŒ¹é…ï¼šå·®å¼‚è®¢å•å¯èƒ½ç”»å¸ˆIDä¸ºç©º</text>
        </view>
        <view wx:if="{{summary.difference === 0}}" class="reason-item success">
          <text class="reason-icon">âœ…</text>
          <text class="reason-text">è®¢å•ç»Ÿè®¡ä¸€è‡´ï¼Œæ²¡æœ‰é—®é¢˜</text>
        </view>
      </view>
    </view>

    <!-- å»ºè®®æ“ä½œ -->
    <view wx:if="{{summary.difference > 0}}" class="result-card">
      <view class="card-title">ğŸ”§ å»ºè®®æ“ä½œ</view>
      <view class="action-list">
        <text class="action-text">1. æˆªå›¾ä¿å­˜æ­¤é¡µé¢</text>
        <text class="action-text">2. åœ¨ç®¡ç†åå°è®¢å•åˆ—è¡¨ä¸­æŸ¥æ‰¾ä¸Šè¿°å·®å¼‚è®¢å•</text>
        <text class="action-text">3. æ£€æŸ¥å·®å¼‚è®¢å•çš„çŠ¶æ€å’Œç”»å¸ˆåˆ†é…æƒ…å†µ</text>
        <text class="action-text">4. å¦‚æœæ˜¯æµ‹è¯•è®¢å•ï¼Œå¯ä»¥åˆ é™¤æˆ–å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="button-group">
    <button class="btn-secondary" bindtap="reloadDiagnosis">é‡æ–°è¯Šæ–­</button>
    <button class="btn-primary" bindtap="goBack">è¿”å›</button>
  </view>
</view>

