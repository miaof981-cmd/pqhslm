<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <view wx:else>
    <!-- é¡¶éƒ¨æ—¶é—´ç­›é€‰ -->
    <view class="time-filter">
      <view class="filter-item {{timeFilter === 'today' ? 'active' : ''}}" data-filter="today" bindtap="switchTimeFilter">ä»Šæ—¥</view>
      <view class="filter-item {{timeFilter === 'yesterday' ? 'active' : ''}}" data-filter="yesterday" bindtap="switchTimeFilter">æ˜¨æ—¥</view>
      <view class="filter-item {{timeFilter === 'week' ? 'active' : ''}}" data-filter="week" bindtap="switchTimeFilter">æœ¬å‘¨</view>
      <view class="filter-item {{timeFilter === 'month' ? 'active' : ''}}" data-filter="month" bindtap="switchTimeFilter">æœ¬æœˆ</view>
      <view class="filter-item" bindtap="customDateRange">è‡ªå®šä¹‰</view>
    </view>

    <!-- ä¸»æ ‡ç­¾æ  -->
    <view class="main-tabs">
      <view class="main-tab {{currentTab === 'dashboard' ? 'active' : ''}}" data-tab="dashboard" bindtap="switchMainTab">
        <view class="tab-icon icon-dashboard"></view>
        <text>ä»ªè¡¨ç›˜</text>
      </view>
      <view class="main-tab {{currentTab === 'product' ? 'active' : ''}}" data-tab="product" bindtap="switchMainTab">
        <view class="tab-icon icon-product"></view>
        <text>å•†å“</text>
      </view>
      <view class="main-tab {{currentTab === 'order' ? 'active' : ''}}" data-tab="order" bindtap="switchMainTab">
        <view class="tab-icon icon-order"></view>
        <text>è®¢å•</text>
        <view wx:if="{{pendingOrders > 0}}" class="tab-badge">{{pendingOrders}}</view>
      </view>
      <view class="main-tab {{currentTab === 'artist' ? 'active' : ''}}" data-tab="artist" bindtap="switchMainTab">
        <view class="tab-icon icon-artist"></view>
        <text>ç”»å¸ˆ</text>
      </view>
      <view class="main-tab {{currentTab === 'more' ? 'active' : ''}}" data-tab="more" bindtap="switchMainTab">
        <view class="tab-icon icon-more"></view>
        <text>æ›´å¤š</text>
      </view>
    </view>

    <!-- 1. ä»ªè¡¨ç›˜ -->
    <view wx:if="{{currentTab === 'dashboard'}}" class="tab-content">
      <!-- æ ¸å¿ƒæ•°æ®å¡ç‰‡ -->
      <view class="stats-grid">
        <view class="stat-card" bindtap="goToOrders">
          <view class="stat-header">
            <text class="stat-label">è®¢å•æ•°</text>
            <view class="stat-icon icon-order-stat"></view>
          </view>
          <view class="stat-value">{{dashboard.orderCount}}</view>
          <view class="stat-compare">
            <text class="compare-label">æ˜¨æ—¥: {{dashboard.yesterdayOrders}}</text>
            <text class="compare-label">æœ¬å‘¨: {{dashboard.weekOrders}}</text>
          </view>
        </view>

        <view class="stat-card" bindtap="goToOrders">
          <view class="stat-header">
            <text class="stat-label">æˆäº¤é‡‘é¢</text>
            <view class="stat-icon icon-money"></view>
          </view>
          <view class="stat-value">Â¥{{dashboard.revenue}}</view>
          <view class="stat-compare">
            <text class="compare-label">æ˜¨æ—¥: Â¥{{dashboard.yesterdayRevenue}}</text>
            <text class="compare-label">æœ¬å‘¨: Â¥{{dashboard.weekRevenue}}</text>
          </view>
        </view>

        <view class="stat-card">
          <view class="stat-header">
            <text class="stat-label">æ”¯ä»˜æˆåŠŸç‡</text>
            <view class="stat-icon icon-success"></view>
          </view>
          <view class="stat-value">{{dashboard.paymentRate}}%</view>
          <view class="stat-compare">
            <text class="compare-label">æˆåŠŸ: {{dashboard.successCount}}</text>
            <text class="compare-label">æ€»æ•°: {{dashboard.totalCount}}</text>
          </view>
        </view>

        <view class="stat-card" bindtap="goToRefunds">
          <view class="stat-header">
            <text class="stat-label">é€€æ¬¾</text>
            <view class="stat-icon icon-refund"></view>
          </view>
          <view class="stat-value">{{dashboard.refundCount}}ç¬”</view>
          <view class="stat-compare">
            <text class="compare-label">é‡‘é¢: Â¥{{dashboard.refundAmount}}</text>
          </view>
        </view>

        <view class="stat-card" bindtap="goToUsers">
          <view class="stat-header">
            <text class="stat-label">æ´»è·ƒç”¨æˆ·</text>
            <view class="stat-icon icon-user"></view>
          </view>
          <view class="stat-value">{{dashboard.activeUsers}}</view>
          <view class="stat-compare">
            <text class="compare-label">æ–°å¢: {{dashboard.newUsers}}</text>
          </view>
        </view>

        <view class="stat-card" bindtap="goToArtists">
          <view class="stat-header">
            <text class="stat-label">ç”»å¸ˆæ•°</text>
            <view class="stat-icon icon-artist-stat"></view>
          </view>
          <view class="stat-value">{{dashboard.artistCount}}</view>
          <view class="stat-compare">
            <text class="compare-label">æ´»è·ƒ: {{dashboard.activeArtists}}</text>
          </view>
        </view>
      </view>

      <!-- è¶‹åŠ¿å›¾è¡¨ -->
      <view class="chart-section">
        <view class="section-header">
          <text class="section-title">æ•°æ®è¶‹åŠ¿</text>
          <view class="chart-tabs">
            <text class="chart-tab {{chartType === '7days' ? 'active' : ''}}" data-type="7days" bindtap="switchChartType">7å¤©</text>
            <text class="chart-tab {{chartType === '30days' ? 'active' : ''}}" data-type="30days" bindtap="switchChartType">30å¤©</text>
          </view>
        </view>
        <view class="chart-placeholder">
          <text>ğŸ“Š å›¾è¡¨åŒºåŸŸï¼ˆéœ€é›†æˆå›¾è¡¨ç»„ä»¶ï¼‰</text>
        </view>
      </view>

      <!-- å¾…å¤„ç†äº‹é¡¹ -->
      <view class="pending-section">
        <view class="section-title">å¾…å¤„ç†äº‹é¡¹</view>
        <view class="pending-list">
          <view class="pending-item" bindtap="goToPendingOrders">
            <view class="pending-icon icon-pending-order"></view>
            <view class="pending-info">
              <text class="pending-title">å¾…å¤„ç†è®¢å•</text>
              <text class="pending-desc">éœ€è¦ç¡®è®¤çš„è®¢å•</text>
            </view>
            <view class="pending-count">{{pendingOrders}}</view>
          </view>
          <view class="pending-item" bindtap="goToOverdueOrders">
            <view class="pending-icon icon-overdue"></view>
            <view class="pending-info">
              <text class="pending-title">æ‹–ç¨¿è®¢å•</text>
              <text class="pending-desc">è¶…æ—¶æœªäº¤ä»˜</text>
            </view>
            <view class="pending-count warning">{{overdueOrders}}</view>
          </view>
          <view class="pending-item" bindtap="goToArtistApplications">
            <view class="pending-icon icon-pending-artist"></view>
            <view class="pending-info">
              <text class="pending-title">ç”»å¸ˆç”³è¯·</text>
              <text class="pending-desc">å¾…å®¡æ ¸</text>
            </view>
            <view class="pending-count">{{pendingApplications}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 2. å•†å“ç®¡ç† -->
    <view wx:if="{{currentTab === 'product'}}" class="tab-content">
      <view class="section-header">
        <text class="section-title">å•†å“ç®¡ç†</text>
        <button class="add-btn" bindtap="addProduct">+ æ·»åŠ å•†å“</button>
      </view>

      <!-- å•†å“ç­›é€‰ -->
      <view class="filter-bar">
        <view class="filter-item {{productFilter === 'all' ? 'active' : ''}}" data-filter="all" bindtap="filterProducts">å…¨éƒ¨</view>
        <view class="filter-item {{productFilter === 'online' ? 'active' : ''}}" data-filter="online" bindtap="filterProducts">å·²ä¸Šæ¶</view>
        <view class="filter-item {{productFilter === 'offline' ? 'active' : ''}}" data-filter="offline" bindtap="filterProducts">å·²ä¸‹æ¶</view>
        <view class="filter-item {{productFilter === 'hot' ? 'active' : ''}}" data-filter="hot" bindtap="filterProducts">çƒ­é”€</view>
      </view>

      <!-- æœç´¢æ  -->
      <view class="search-bar">
        <input class="search-input" placeholder="æœç´¢å•†å“åç§°" bindinput="searchProducts" />
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="product-list">
        <view wx:for="{{products}}" wx:key="_id" class="product-item">
          <image class="product-image" src="{{item.image}}" mode="aspectFill" />
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <view class="product-meta">
              <text class="product-category">{{item.category}}</text>
              <text class="product-price">Â¥{{item.price}}</text>
            </view>
            <view class="product-tags">
              <text wx:if="{{item.isHot}}" class="tag hot">çƒ­é”€</text>
              <text wx:if="{{item.isRecommend}}" class="tag recommend">æ¨è</text>
              <text wx:if="{{item.isSpecial}}" class="tag special">ç‰¹ä»·</text>
            </view>
          </view>
          <view class="product-actions">
            <view class="product-status status-{{item.status}}">{{item.status === 'online' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}</view>
            <button class="action-btn" data-id="{{item._id}}" bindtap="editProduct">ç¼–è¾‘</button>
            <button class="action-btn" data-id="{{item._id}}" data-status="{{item.status}}" bindtap="toggleProductStatus">
              {{item.status === 'online' ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}}
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- 3. è®¢å•ç®¡ç† -->
    <view wx:if="{{currentTab === 'order'}}" class="tab-content">
      <view class="section-header">
        <text class="section-title">è®¢å•ç®¡ç†</text>
        <button class="export-btn" bindtap="exportOrders">å¯¼å‡ºExcel</button>
      </view>

      <!-- è®¢å•ç­›é€‰ -->
      <view class="filter-bar">
        <view class="filter-item {{orderFilter === 'all' ? 'active' : ''}}" data-filter="all" bindtap="filterOrders">
          å…¨éƒ¨({{orderStats.all}})
        </view>
        <view class="filter-item {{orderFilter === 'unpaid' ? 'active' : ''}}" data-filter="unpaid" bindtap="filterOrders">
          å¾…æ”¯ä»˜({{orderStats.unpaid}})
        </view>
        <view class="filter-item {{orderFilter === 'paid' ? 'active' : ''}}" data-filter="paid" bindtap="filterOrders">
          å·²æ”¯ä»˜({{orderStats.paid}})
        </view>
        <view class="filter-item {{orderFilter === 'processing' ? 'active' : ''}}" data-filter="processing" bindtap="filterOrders">
          åˆ¶ä½œä¸­({{orderStats.processing}})
        </view>
        <view class="filter-item {{orderFilter === 'completed' ? 'active' : ''}}" data-filter="completed" bindtap="filterOrders">
          å·²å®Œæˆ({{orderStats.completed}})
        </view>
        <view class="filter-item {{orderFilter === 'refunding' ? 'active' : ''}}" data-filter="refunding" bindtap="filterOrders">
          é€€æ¬¾ä¸­({{orderStats.refunding}})
        </view>
        <view class="filter-item {{orderFilter === 'refunded' ? 'active' : ''}}" data-filter="refunded" bindtap="filterOrders">
          å·²é€€æ¬¾({{orderStats.refunded}})
        </view>
      </view>

      <!-- æœç´¢æ  -->
      <view class="search-bar">
        <input class="search-input" placeholder="æœç´¢è®¢å•å·/ç”¨æˆ·/å•†å“" bindinput="searchOrders" />
      </view>

      <!-- è®¢å•åˆ—è¡¨ -->
      <view class="order-list">
        <view wx:for="{{orders}}" wx:key="_id" class="order-item" bindtap="viewOrderDetail" data-id="{{item._id}}">
          <view class="order-header">
            <text class="order-no">{{item.orderNo}}</text>
            <view class="order-status status-{{item.status}}">{{item.statusText}}</view>
          </view>
          <view class="order-content">
            <image class="order-image" src="{{item.productImage}}" mode="aspectFill" />
            <view class="order-info">
              <text class="order-product">{{item.productName}}</text>
              <text class="order-user">ä¹°å®¶ï¼š{{item.userName}} {{item.userPhone}}</text>
              <text class="order-artist">ç”»å¸ˆï¼š{{item.artistName}}</text>
              <text class="order-time">ä¸‹å•ï¼š{{item.createTime}}</text>
              <text wx:if="{{item.deadline}}" class="order-deadline {{item.isOverdue ? 'overdue' : ''}}">
                æˆªç¨¿ï¼š{{item.deadline}} {{item.isOverdue ? '(å·²è¶…æ—¶)' : ''}}
              </text>
            </view>
          </view>
          <view class="order-footer">
            <text class="order-amount">Â¥{{item.amount}}</text>
            <view class="order-actions">
              <button wx:if="{{item.status === 'paid'}}" class="action-btn primary" data-id="{{item._id}}" catchtap="confirmOrder">ç¡®è®¤</button>
              <button wx:if="{{item.status === 'processing'}}" class="action-btn success" data-id="{{item._id}}" catchtap="completeOrder">å®Œæˆ</button>
              <button wx:if="{{item.status === 'refunding'}}" class="action-btn warning" data-id="{{item._id}}" catchtap="processRefund">å¤„ç†é€€æ¬¾</button>
              <button class="action-btn default" data-id="{{item._id}}" catchtap="viewOrderDetail">è¯¦æƒ…</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 4. ç”»å¸ˆç®¡ç† -->
    <view wx:if="{{currentTab === 'artist'}}" class="tab-content">
      <view class="sub-tabs">
        <view class="sub-tab {{artistTab === 'list' ? 'active' : ''}}" data-tab="list" bindtap="switchArtistTab">ç”»å¸ˆåˆ—è¡¨</view>
        <view class="sub-tab {{artistTab === 'applications' ? 'active' : ''}}" data-tab="applications" bindtap="switchArtistTab">
          å¾…å®¡æ ¸({{pendingApplications}})
        </view>
        <view class="sub-tab {{artistTab === 'performance' ? 'active' : ''}}" data-tab="performance" bindtap="switchArtistTab">ä¸šç»©æ’è¡Œ</view>
      </view>

      <!-- ç”»å¸ˆåˆ—è¡¨ -->
      <view wx:if="{{artistTab === 'list'}}">
        <view class="artist-list">
          <view wx:for="{{artists}}" wx:key="_id" class="artist-item" bindtap="viewArtistDetail" data-id="{{item._id}}">
            <image class="artist-avatar" src="{{item.avatar}}" mode="aspectFill" />
            <view class="artist-info">
              <view class="artist-name-row">
                <text class="artist-name">{{item.name}}</text>
                <view class="artist-level level-{{item.level}}">{{item.level}}çº§</view>
              </view>
              <text class="artist-meta">å…¥é©»ï¼š{{item.joinTime}}</text>
              <text class="artist-meta">ä½œå“ï¼š{{item.productCount}}ä¸ª | è®¢å•ï¼š{{item.orderCount}}å•</text>
              <text class="artist-meta">æ”¶å…¥ï¼šÂ¥{{item.totalRevenue}}</text>
            </view>
            <view class="artist-actions">
              <view class="artist-status status-{{item.status}}">{{item.statusText}}</view>
              <button class="action-btn" data-id="{{item._id}}" catchtap="editArtist">ç®¡ç†</button>
            </view>
          </view>
        </view>
      </view>

      <!-- ç”»å¸ˆç”³è¯· -->
      <view wx:if="{{artistTab === 'applications'}}">
        <view class="application-list">
          <view wx:for="{{applications}}" wx:key="_id" class="application-item">
            <view class="application-header">
              <text class="applicant-name">{{item.name}}</text>
              <text class="applicant-phone">{{item.phone}}</text>
            </view>
            <text class="applicant-specialty">æ“…é•¿ï¼š{{item.specialty}}</text>
            <view class="portfolio-preview">
              <text class="portfolio-label">ä½œå“å±•ç¤ºï¼š</text>
              <view class="portfolio-images">
                <image wx:for="{{item.portfolio}}" wx:key="*this" wx:for-item="img" src="{{img}}" mode="aspectFill" class="portfolio-image" />
              </view>
            </view>
            <text class="application-time">ç”³è¯·æ—¶é—´ï¼š{{item.createTime}}</text>
            <view class="action-buttons">
              <button class="approve-btn" data-id="{{item._id}}" bindtap="approveArtist">é€šè¿‡</button>
              <button class="reject-btn" data-id="{{item._id}}" bindtap="rejectArtist">é©³å›</button>
            </view>
          </view>
        </view>
      </view>

      <!-- ä¸šç»©æ’è¡Œ -->
      <view wx:if="{{artistTab === 'performance'}}">
        <view class="performance-list">
          <view wx:for="{{artistPerformance}}" wx:key="_id" class="performance-item">
            <view class="rank-badge rank-{{index + 1}}">{{index + 1}}</view>
            <image class="artist-avatar-small" src="{{item.avatar}}" mode="aspectFill" />
            <view class="performance-info">
              <text class="artist-name">{{item.name}}</text>
              <text class="performance-data">è®¢å•ï¼š{{item.orderCount}}å• | æ”¶å…¥ï¼šÂ¥{{item.revenue}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 5. æ›´å¤šåŠŸèƒ½ -->
    <view wx:if="{{currentTab === 'more'}}" class="tab-content">
      <view class="more-grid">
        <view class="more-item" bindtap="goToCategories">
          <view class="more-icon icon-category"></view>
          <text class="more-label">åˆ†ç±»ç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToUsers">
          <view class="more-icon icon-users"></view>
          <text class="more-label">ç”¨æˆ·ç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToCustomerService">
          <view class="more-icon icon-service"></view>
          <text class="more-label">å®¢æœç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToStaff">
          <view class="more-icon icon-staff"></view>
          <text class="more-label">äººå‘˜ç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToReports">
          <view class="more-icon icon-report"></view>
          <text class="more-label">ä¸šç»©ç»Ÿè®¡</text>
        </view>
        <view class="more-item" bindtap="goToMedia">
          <view class="more-icon icon-media"></view>
          <text class="more-label">èµ„æºç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToBanners">
          <view class="more-icon icon-banner"></view>
          <text class="more-label">è½®æ’­å›¾</text>
        </view>
        <view class="more-item" bindtap="goToNotices">
          <view class="more-icon icon-notice"></view>
          <text class="more-label">å…¬å‘Šç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToSettings">
          <view class="more-icon icon-settings"></view>
          <text class="more-label">ç³»ç»Ÿè®¾ç½®</text>
        </view>
      </view>
    </view>
  </view>
</view>
