<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <view wx:else>
    <!-- ä¸»æ ‡ç­¾æ  -->
    <view class="main-tabs">
      <view class="main-tab {{currentTab === 'dashboard' ? 'active' : ''}}" data-tab="dashboard" bindtap="switchMainTab">
        <view class="tab-icon icon-dashboard"></view>
        <text>ä»ªè¡¨ç›˜</text>
      </view>
      <view class="main-tab {{currentTab === 'product' ? 'active' : ''}}" data-tab="product" bindtap="switchMainTab">
        <view class="tab-icon icon-product"></view>
        <text>å•†å“</text>
      </view>
      <view class="main-tab {{currentTab === 'order' ? 'active' : ''}}" data-tab="order" bindtap="switchMainTab">
        <view class="tab-icon icon-order"></view>
        <text>è®¢å•</text>
        <view wx:if="{{pendingOrders > 0}}" class="tab-badge">{{pendingOrders}}</view>
      </view>
      <view class="main-tab {{currentTab === 'artist' ? 'active' : ''}}" data-tab="artist" bindtap="switchMainTab">
        <view class="tab-icon icon-artist"></view>
        <text>ç”»å¸ˆ</text>
      </view>
      <view class="main-tab {{currentTab === 'more' ? 'active' : ''}}" data-tab="more" bindtap="switchMainTab">
        <view class="tab-icon icon-more"></view>
        <text>æ›´å¤š</text>
      </view>
    </view>

    <!-- 1. ä»ªè¡¨ç›˜ -->
    <view wx:if="{{currentTab === 'dashboard'}}" class="tab-content">
      <!-- æ—¶é—´ç­›é€‰ï¼ˆä»…åœ¨ä»ªè¡¨ç›˜æ˜¾ç¤ºï¼‰ -->
      <view class="time-filter">
        <view class="filter-item {{timeFilter === 'today' ? 'active' : ''}}" data-filter="today" bindtap="switchTimeFilter">ä»Šæ—¥</view>
        <view class="filter-item {{timeFilter === 'yesterday' ? 'active' : ''}}" data-filter="yesterday" bindtap="switchTimeFilter">æ˜¨æ—¥</view>
        <view class="filter-item {{timeFilter === 'week' ? 'active' : ''}}" data-filter="week" bindtap="switchTimeFilter">æœ¬å‘¨</view>
        <view class="filter-item {{timeFilter === 'month' ? 'active' : ''}}" data-filter="month" bindtap="switchTimeFilter">æœ¬æœˆ</view>
      </view>

      <!-- æ ¸å¿ƒæ•°æ®å¡ç‰‡ -->
      <view class="stats-grid">
        <view class="stat-card" bindtap="goToOrders">
          <view class="stat-label">è®¢å•æ•°</view>
          <view class="stat-value">{{dashboard.orderCount}}<text class="stat-unit">ç¬”</text></view>
          <view class="stat-trend">è¾ƒæ˜¨æ—¥ {{dashboard.orderTrend}}</view>
        </view>

        <view class="stat-card" bindtap="goToUsers">
          <view class="stat-label">ä¸‹å•äººæ•°</view>
          <view class="stat-value">{{dashboard.buyerCount}}<text class="stat-unit">äºº</text></view>
          <view class="stat-trend">è¾ƒæ˜¨æ—¥ {{dashboard.buyerTrend}}</view>
        </view>

        <view class="stat-card" bindtap="goToOrders">
          <view class="stat-label">æˆäº¤é‡‘é¢</view>
          <view class="stat-value">{{dashboard.revenue}}<text class="stat-unit">å…ƒ</text></view>
          <view class="stat-trend">è¾ƒæ˜¨æ—¥ {{dashboard.revenueTrend}}</view>
        </view>

        <view class="stat-card" bindtap="goToRefunds">
          <view class="stat-label">é€€æ¬¾é‡‘é¢</view>
          <view class="stat-value">{{dashboard.refundAmount}}<text class="stat-unit">å…ƒ</text></view>
          <view class="stat-trend">{{dashboard.refundCount}}ç¬”é€€æ¬¾</view>
        </view>

        <view class="stat-card" bindtap="goToArtists">
          <view class="stat-label">ç”»å¸ˆæ•°</view>
          <view class="stat-value">{{dashboard.artistCount}}<text class="stat-unit">äºº</text></view>
          <view class="stat-trend">æ´»è·ƒ {{dashboard.activeArtists}}äºº</view>
        </view>

        <view class="stat-card" bindtap="goToUsers">
          <view class="stat-label">ç”¨æˆ·æ•°</view>
          <view class="stat-value">{{dashboard.userCount}}<text class="stat-unit">äºº</text></view>
          <view class="stat-trend">æ–°å¢ {{dashboard.newUsers}}äºº</view>
        </view>
      </view>

      <!-- å¾…å¤„ç†äº‹é¡¹ -->
      <view class="pending-section">
        <view class="section-title">å¾…å¤„ç†äº‹é¡¹</view>
        <view class="pending-list">
          <view class="pending-item" bindtap="goToPendingOrders">
            <view class="pending-info">
              <text class="pending-title">å¾…å¤„ç†è®¢å•</text>
              <text class="pending-desc">éœ€è¦ç¡®è®¤çš„è®¢å•</text>
            </view>
            <view class="pending-count">{{pendingOrders}}</view>
          </view>
          <view class="pending-item" bindtap="goToOverdueOrders">
            <view class="pending-info">
              <text class="pending-title">æ‹–ç¨¿è®¢å•</text>
              <text class="pending-desc">è¶…æ—¶æœªäº¤ä»˜</text>
            </view>
            <view class="pending-count warning">{{overdueOrders}}</view>
          </view>
          <view class="pending-item" bindtap="goToReviewManage">
            <view class="pending-info">
              <text class="pending-title">ç”»å¸ˆå®¡æ ¸</text>
              <text class="pending-desc">å¾…å®¡æ ¸</text>
            </view>
            <view class="pending-count">{{pendingApplications}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 2. å•†å“ç®¡ç† -->
    <view wx:if="{{currentTab === 'product'}}" class="tab-content">
      <view class="section-header">
        <text class="section-title">å•†å“ç®¡ç†</text>
        <button class="add-btn" bindtap="addProduct">+ æ·»åŠ å•†å“</button>
      </view>

      <!-- å•†å“ç­›é€‰ -->
      <view class="filter-bar">
        <view class="filter-item {{productFilter === 'all' ? 'active' : ''}}" data-filter="all" bindtap="filterProducts">å…¨éƒ¨</view>
        <view class="filter-item {{productFilter === 'online' ? 'active' : ''}}" data-filter="online" bindtap="filterProducts">å·²ä¸Šæ¶</view>
        <view class="filter-item {{productFilter === 'offline' ? 'active' : ''}}" data-filter="offline" bindtap="filterProducts">å·²ä¸‹æ¶</view>
        <view class="filter-item {{productFilter === 'hot' ? 'active' : ''}}" data-filter="hot" bindtap="filterProducts">çƒ­é”€</view>
      </view>

      <!-- æœç´¢æ  -->
      <view class="search-bar">
        <input class="search-input" placeholder="æœç´¢å•†å“åç§°" bindinput="searchProducts" />
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="product-list">
        <view wx:for="{{products}}" wx:key="_id" class="product-item">
          <image class="product-image" src="{{item.image}}" mode="aspectFill" />
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <view class="product-meta">
              <text class="product-category">{{item.category}}</text>
              <text class="product-price">Â¥{{item.price}}</text>
            </view>
            <view class="product-tags">
              <text wx:if="{{item.isHot}}" class="tag hot">çƒ­é”€</text>
              <text wx:if="{{item.isRecommend}}" class="tag recommend">æ¨è</text>
              <text wx:if="{{item.isSpecial}}" class="tag special">ç‰¹ä»·</text>
            </view>
          </view>
          <view class="product-actions">
            <view class="product-status status-{{item.status}}">{{item.status === 'online' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}</view>
            <button class="action-btn" data-id="{{item._id}}" bindtap="editProduct">ç¼–è¾‘</button>
            <button class="action-btn" data-id="{{item._id}}" data-status="{{item.status}}" bindtap="toggleProductStatus">
              {{item.status === 'online' ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}}
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- 3. è®¢å•ç®¡ç† -->
    <view wx:if="{{currentTab === 'order'}}" class="tab-content">
      <!-- é¡¶éƒ¨æ“ä½œæ  -->
      <view class="order-header-bar">
        <text class="section-title">è®¢å•ç®¡ç†</text>
        <view class="header-actions">
          <input class="search-input-inline" placeholder="æœç´¢è®¢å•" bindinput="searchOrders" />
          <button class="export-btn-small" bindtap="exportOrders">å¯¼å‡º</button>
        </view>
      </view>

      <!-- è®¢å•ç­›é€‰ -->
      <scroll-view class="filter-scroll" scroll-x>
        <view class="filter-bar-compact">
          <view class="filter-item {{orderFilter === 'all' ? 'active' : ''}}" data-filter="all" bindtap="filterOrders">
            å…¨éƒ¨<text class="filter-count">{{orderStats.all}}</text>
          </view>
          <view class="filter-item {{orderFilter === 'unpaid' ? 'active' : ''}}" data-filter="unpaid" bindtap="filterOrders">
            å¾…æ”¯ä»˜<text class="filter-count">{{orderStats.unpaid}}</text>
          </view>
          <view class="filter-item {{orderFilter === 'processing' ? 'active' : ''}}" data-filter="processing" bindtap="filterOrders">
            åˆ¶ä½œä¸­<text class="filter-count">{{orderStats.processing}}</text>
          </view>
          <view class="filter-item {{orderFilter === 'completed' ? 'active' : ''}}" data-filter="completed" bindtap="filterOrders">
            å·²å®Œæˆ<text class="filter-count">{{orderStats.completed}}</text>
          </view>
          <view class="filter-item {{orderFilter === 'refunding' ? 'active' : ''}}" data-filter="refunding" bindtap="filterOrders">
            é€€æ¬¾ä¸­<text class="filter-count">{{orderStats.refunding}}</text>
          </view>
        </view>
      </scroll-view>

      <!-- è®¢å•åˆ—è¡¨ -->
      <view class="order-list">
        <view wx:for="{{orders}}" wx:key="_id" class="order-item" bindtap="viewOrderDetail" data-id="{{item._id}}">
          <view class="order-header">
            <text class="order-no">{{item.orderNo}}</text>
            <view class="order-status status-{{item.status}}">{{item.statusText}}</view>
          </view>
          <view class="order-content">
            <image class="order-image" src="{{item.productImage}}" mode="aspectFill" />
            <view class="order-info">
              <text class="order-product">{{item.productName}}</text>
              <text class="order-user">ä¹°å®¶ï¼š{{item.userName}}</text>
              <text class="order-artist">ç”»å¸ˆï¼š{{item.artistName}}</text>
              <text class="order-time">ä¸‹å•ï¼š{{item.createTime}}</text>
              <text wx:if="{{item.deadline}}" class="order-deadline {{item.isOverdue ? 'overdue' : ''}}">
                æˆªç¨¿ï¼š{{item.deadline}} {{item.isOverdue ? '(å·²è¶…æ—¶)' : ''}}
              </text>
            </view>
          </view>
          <view class="order-footer">
            <text class="order-amount">Â¥{{item.amount}}</text>
            <view class="order-actions">
              <button wx:if="{{item.status === 'refunding'}}" class="action-btn warning" data-id="{{item._id}}" catchtap="processRefund">å¤„ç†é€€æ¬¾</button>
              <button class="action-btn default" data-id="{{item._id}}" catchtap="viewOrderDetail">è¯¦æƒ…</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 4. ç”»å¸ˆç®¡ç† -->
    <view wx:if="{{currentTab === 'artist'}}" class="tab-content">
      <view class="sub-tabs">
        <view class="sub-tab {{artistTab === 'list' ? 'active' : ''}}" data-tab="list" bindtap="switchArtistTab">ç”»å¸ˆåˆ—è¡¨</view>
        <view class="sub-tab {{artistTab === 'performance' ? 'active' : ''}}" data-tab="performance" bindtap="switchArtistTab">ä¸šç»©æ’è¡Œ</view>
      </view>

      <!-- ç”»å¸ˆåˆ—è¡¨ -->
      <view wx:if="{{artistTab === 'list'}}">
        <view class="artist-list">
          <view wx:for="{{artists}}" wx:key="_id" class="artist-item" bindtap="viewArtistDetail" data-id="{{item._id}}">
            <image class="artist-avatar" src="{{item.avatar}}" mode="aspectFill" />
            <view class="artist-info">
              <view class="artist-name-row">
                <text class="artist-name">{{item.name}}</text>
              </view>
              <text class="artist-meta">å…¥é©»ï¼š{{item.joinTime}}</text>
              <text class="artist-meta">ä½œå“ï¼š{{item.productCount}}ä¸ª | è®¢å•ï¼š{{item.orderCount}}å•</text>
              <text class="artist-meta">æ”¶å…¥ï¼šÂ¥{{item.totalRevenue}}</text>
            </view>
            <view class="artist-actions">
              <view class="artist-status status-{{item.status}}">{{item.statusText}}</view>
              <button class="action-btn" data-id="{{item._id}}" catchtap="editArtist">ç®¡ç†</button>
            </view>
          </view>
        </view>
      </view>

      <!-- ä¸šç»©æ’è¡Œ -->
      <view wx:if="{{artistTab === 'performance'}}">
        <view class="performance-list">
          <view wx:for="{{artistPerformance}}" wx:key="_id" class="performance-item">
            <view class="rank-badge rank-{{index + 1}}">{{index + 1}}</view>
            <image class="artist-avatar-small" src="{{item.avatar}}" mode="aspectFill" />
            <view class="performance-info">
              <text class="artist-name">{{item.name}}</text>
              <text class="performance-data">è®¢å•ï¼š{{item.orderCount}}å• | æ”¶å…¥ï¼šÂ¥{{item.revenue}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 5. æ›´å¤šåŠŸèƒ½ -->
    <view wx:if="{{currentTab === 'more'}}" class="tab-content">
      <view class="more-grid">
        <view class="more-item" bindtap="goToCategories">
          <view class="more-icon icon-category"></view>
          <text class="more-label">åˆ†ç±»ç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToUsers">
          <view class="more-icon icon-users"></view>
          <text class="more-label">ç”¨æˆ·ç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToCustomerService">
          <view class="more-icon icon-service"></view>
          <text class="more-label">å®¢æœç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToStaffQRCode">
          <view class="more-icon icon-qrcode"></view>
          <text class="more-label">å·¥ä½œäººå‘˜äºŒç»´ç </text>
        </view>
        <view class="more-item" bindtap="goToStaff">
          <view class="more-icon icon-staff"></view>
          <text class="more-label">äººå‘˜ç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToReports">
          <view class="more-icon icon-report"></view>
          <text class="more-label">ä¸šç»©ç»Ÿè®¡</text>
        </view>
        <view class="more-item" bindtap="goToMedia">
          <view class="more-icon icon-media"></view>
          <text class="more-label">èµ„æºç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToBanners">
          <view class="more-icon icon-banner"></view>
          <text class="more-label">è½®æ’­å›¾</text>
        </view>
        <view class="more-item" bindtap="goToNotices">
          <view class="more-icon icon-notice"></view>
          <text class="more-label">å…¬å‘Šç®¡ç†</text>
        </view>
        <view class="more-item" bindtap="goToSettings">
          <view class="more-icon icon-settings"></view>
          <text class="more-label">ç³»ç»Ÿè®¾ç½®</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘ç”»å¸ˆå¼¹çª— -->
  <view wx:if="{{showEditArtistModal}}" class="modal-overlay" bindtap="closeEditArtistModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç”»å¸ˆä¿¡æ¯</text>
        <view class="modal-close" bindtap="closeEditArtistModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <!-- æƒé™å¼€é€šï¼ˆç½®é¡¶ï¼‰ -->
        <view wx:if="{{!editingArtist.hasPermission}}" class="permission-section">
          <view class="section-title">å¼€é€šå·¥ä½œå°æƒé™</view>
          <view class="permission-hint">å¼€é€šåå°†è‡ªåŠ¨åˆ†é…ç”»å¸ˆç¼–å·</view>
          <button class="btn-grant-permission" bindtap="grantArtistPermission">å¼€é€šæƒé™</button>
        </view>
        
        <!-- æƒé™ç®¡ç†ï¼ˆå·²å¼€é€šï¼‰ -->
        <view wx:else class="permission-granted-section">
          <view class="section-title">æƒé™çŠ¶æ€</view>
          
          <!-- æƒé™çŠ¶æ€å¡ç‰‡ -->
          <view class="permission-status-card">
            <view class="status-icon-large">âœ“</view>
            <view class="status-info">
              <text class="status-title">å·¥ä½œå°æƒé™å·²å¼€é€š</text>
              <text class="status-subtitle">ç”»å¸ˆç¼–å·ï¼š{{editingArtist.artistNumber || 'æœªåˆ†é…'}}</text>
            </view>
          </view>
          
          <!-- ä¼ä¸šå¾®ä¿¡ID -->
          <view class="wechat-id-section">
            <view class="id-label">ä¼ä¸šæ˜µç§°ï¼š</view>
            <view class="id-display">
              <text class="id-value">è”ç›Ÿid{{editingArtist.artistNumber}}{{editingArtist.realName || editingArtist.name}}</text>
              <button class="btn-copy-id" bindtap="copyWechatId" data-id="è”ç›Ÿid{{editingArtist.artistNumber}}{{editingArtist.realName || editingArtist.name}}">å¤åˆ¶</button>
            </view>
            <view class="id-hint">ç”¨äºä¼ä¸šå¾®ä¿¡æ˜µç§°è®¾ç½®ï¼Œæ–¹ä¾¿è®¢å•åˆ†é…</view>
          </view>
          
        </view>
        
        <!-- åŸºç¡€ä¿¡æ¯ -->
        <view class="info-section">
          <view class="section-title">åŸºç¡€ä¿¡æ¯</view>
          
          <view class="info-row">
            <text class="info-label">ç”¨æˆ·ID</text>
            <text class="info-value">{{editingArtist.userId}}</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">ç”»å¸ˆç¼–å·</text>
            <text class="info-value">{{editingArtist.artistNumber || 'æœªåˆ†é…'}}</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">ç”»å¸ˆæ˜µç§°</text>
            <text class="info-value">{{editingArtist.name}}</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">å…¥é©»æ—¶é—´</text>
            <text class="info-value">{{editingArtist.joinTime}}</text>
          </view>
        </view>
        
        <!-- è”ç³»æ–¹å¼ -->
        <view class="info-section">
          <view class="section-title">è”ç³»æ–¹å¼</view>
          
          <view class="info-row">
            <text class="info-label">è”ç³»ç”µè¯</text>
            <text class="info-value">{{editingArtist.contactPhone || 'æœªå¡«å†™'}}</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">è”ç³»å¾®ä¿¡</text>
            <text class="info-value">{{editingArtist.wechat || 'æœªå¡«å†™'}}</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">ç´§æ€¥è”ç³»äºº</text>
            <text class="info-value">{{editingArtist.emergencyName || 'æœªå¡«å†™'}} ({{editingArtist.emergencyRelation || '-'}})</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">ç´§æ€¥è”ç³»ç”µè¯</text>
            <text class="info-value">{{editingArtist.emergencyPhone || 'æœªå¡«å†™'}}</text>
          </view>
        </view>
        
        <!-- å•†å“ç®¡ç† -->
        <view class="info-section">
          <view class="section-title">å•†å“ç®¡ç†</view>
          
          <!-- æŸ¥çœ‹å•†å“ -->
          <button class="action-btn-view-products" bindtap="manageArtistProducts">
            <text class="btn-icon">ğŸ“¦</text>
            <text class="btn-text">æŸ¥çœ‹è¯¥ç”»å¸ˆçš„æ‰€æœ‰å•†å“</text>
            <text class="btn-arrow">â€º</text>
          </button>
          
          <!-- å•†å“çŠ¶æ€å¼€å…³ -->
          <view class="info-row" style="align-items: center; margin-top: 24rpx;">
            <text class="info-label">å•†å“é”€å”®çŠ¶æ€</text>
            <view class="status-switch-group">
              <switch checked="{{!editingArtist.allProductsOffline}}" bindchange="toggleProductsStatus" color="#66BB6A"/>
              <text class="status-text {{editingArtist.allProductsOffline ? 'status-offline' : 'status-online'}}">
                {{editingArtist.allProductsOffline ? 'å…¨éƒ¨å·²ä¸‹æ¶' : 'æ­£å¸¸é”€å”®ä¸­'}}
              </text>
            </view>
          </view>
          
          <view class="offline-hint">
            <text class="hint-icon">âš ï¸</text>
            <text class="hint-text">å…³é—­åï¼Œå•†å“å°†ä¸æ˜¾ç¤ºåœ¨å•†åŸï¼Œå·²åŠ å…¥è´­ç‰©è½¦çš„ä¹Ÿæ— æ³•è´­ä¹°ï¼Œä½†ç”»å¸ˆä»å¯å¤„ç†ç°æœ‰è®¢å•</text>
          </view>
        </view>
        
        <!-- ä¸šç»©æ•°æ® -->
        <view class="info-section">
          <view class="section-title">ä¸šç»©æ•°æ®</view>
          
          <view class="info-row">
            <text class="info-label">ä½œå“æ•°é‡</text>
            <text class="info-value">{{editingArtist.productCount}}ä¸ª</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">è®¢å•æ•°é‡</text>
            <text class="info-value">{{editingArtist.orderCount}}å•</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">æ€»æ”¶å…¥</text>
            <text class="info-value">Â¥{{editingArtist.totalRevenue}}</text>
          </view>
        </view>
        
        <!-- å±é™©æ“ä½œåŒº -->
        <view class="danger-section">
          <view class="section-title" style="color: #FF6B6B;">å±é™©æ“ä½œ</view>
          <button class="btn-revoke-permission" bindtap="revokeArtistPermission">æ’¤é”€å·¥ä½œå°æƒé™</button>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="closeEditArtistModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm-btn" bindtap="saveArtistEdit">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>
