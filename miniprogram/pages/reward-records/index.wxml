<view class="page">
  <view class="page-header">
    <text class="page-title">打赏</text>
    <text class="page-subtitle">最近30天内完成的订单可以直接打赏画师</text>
  </view>

  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <view wx:else>
    <view wx:if="{{recentOrders.length === 0 && historyOrders.length === 0}}" class="empty">
      <text>暂无可打赏的订单</text>
    </view>

    <block wx:if="{{recentOrders.length > 0}}">
      <view class="section-title">可打赏订单</view>

      <block wx:for="{{recentOrders}}" wx:key="id">
        <view class="order-card">
          <image class="artist-avatar" src="{{item.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
          <view class="card-body">
            <view class="artist-name">{{item.artistName}}</view>
            <view class="product-name">{{item.productName}}</view>
            <view class="meta">
              <text class="meta-text">完成于 {{item.completedText}}</text>
            </view>
          </view>
          <button
            class="reward-btn"
            data-order-id="{{item.id}}"
            bindtap="onRewardTap"
            disabled="{{item.rewarded}}"
          >
            {{item.rewarded ? ('已打赏 ¥' + item.rewardAmount) : '打赏'}}
          </button>
        </view>
      </block>
    </block>

    <block wx:if="{{historyOrders.length > 0}}">
      <view class="history-separator">
        <view class="line"></view>
        <text class="history-text">历史订单</text>
        <view class="line"></view>
      </view>

      <block wx:for="{{historyOrders}}" wx:key="id">
        <view class="order-card history">
          <image class="artist-avatar" src="{{item.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
          <view class="card-body">
            <view class="artist-name">{{item.artistName}}</view>
            <view class="product-name">{{item.productName}}</view>
            <view class="meta">
              <text class="meta-text">完成于 {{item.completedText}}</text>
            </view>
          </view>
          <view class="expired-flag">超出30天，无法打赏</view>
        </view>
      </block>
    </block>
  </view>
</view>
