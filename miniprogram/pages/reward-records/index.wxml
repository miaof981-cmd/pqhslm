<view class="page">
  <view class="page-header">
    <text class="page-title">æ‰“èµ</text>
    <text class="page-subtitle">æœ€è¿‘30å¤©å†…å®Œæˆçš„è®¢å•å¯ä»¥ç›´æ¥æ‰“èµç”»å¸ˆ</text>
  </view>

  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <view wx:if="{{pendingOrders.length === 0 && rewardedOrders.length === 0}}" class="empty">
      <text>æš‚æ— å¯æ‰“èµçš„è®¢å•</text>
    </view>

    <!-- å¯æ‰“èµè®¢å• -->
    <block wx:if="{{pendingOrders.length > 0}}">
      <view class="section-title">å¯æ‰“èµè®¢å•</view>

      <block wx:for="{{pendingOrders}}" wx:key="id">
        <view class="order-card">
          <image class="artist-avatar" src="{{item.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
          <view class="card-body">
            <view class="artist-name">{{item.artistName}}</view>
            <view class="product-name">{{item.productName}}</view>
            <view class="meta">
              <text class="meta-text">å®Œæˆäº {{item.completedText}}</text>
            </view>
          </view>
          <button class="reward-btn" data-order-id="{{item.id}}" bindtap="onRewardTap">
            æ‰“èµ
          </button>
        </view>
      </block>
    </block>

    <!-- å·²æ‰“èµè®¢å• -->
    <block wx:if="{{rewardedOrders.length > 0}}">
      <view class="rewarded-separator">
        <view class="line"></view>
        <text class="rewarded-text">å·²æ‰“èµè®°å½•</text>
        <view class="line"></view>
      </view>

      <block wx:for="{{rewardedOrders}}" wx:key="id">
        <view class="order-card rewarded">
          <image class="artist-avatar-rewarded" src="{{item.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
          <view class="card-body">
            <view class="artist-name">{{item.artistName}}</view>
            <view class="product-name">{{item.productName}}</view>
            <view class="meta">
              <text class="meta-text">å®Œæˆäº {{item.completedText}}</text>
            </view>
          </view>
          <view class="rewarded-badge-new">
            <view class="badge-medal">ğŸ–ï¸</view>
            <view class="badge-label">å·²é¼“åŠ±ç”»å¸ˆ</view>
            <view class="badge-amount">Â¥{{item.rewardAmount}}</view>
          </view>
        </view>
      </block>
    </block>
  </view>

  <!-- ç¾è§‚çš„æ‰“èµå¼¹çª— -->
  <view wx:if="{{showRewardModal}}" class="reward-modal-mask" bindtap="hideRewardModal">
    <view class="reward-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <image class="modal-avatar" src="{{currentOrder.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
        <view class="modal-title">æ‰“èµ {{currentOrder.artistName}}</view>
        <view class="modal-subtitle">é¼“åŠ±ç”»å¸ˆç»§ç»­åˆ›ä½œ</view>
      </view>

      <view class="amount-grid">
        <block wx:for="{{rewardOptions}}" wx:key="*this">
          <view 
            class="amount-item {{selectedAmount === item ? 'selected' : ''}}" 
            data-amount="{{item}}"
            bindtap="selectAmount"
          >
            <text class="amount-value">Â¥{{item}}</text>
          </view>
        </block>
        <view 
          class="amount-item custom {{selectedAmount === -1 ? 'selected' : ''}}"
          bindtap="selectCustomAmount"
        >
          <text class="amount-value">è‡ªå®šä¹‰</text>
        </view>
      </view>

      <view class="modal-actions">
        <button class="modal-btn cancel" bindtap="hideRewardModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="confirmRewardFromModal">ç¡®è®¤æ‰“èµ</button>
      </view>
    </view>
  </view>
</view>
