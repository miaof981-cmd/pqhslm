<view class="page">
  <view class="page-header">
    <text class="page-title">打赏</text>
    <text class="page-subtitle">最近30天内完成的订单可以直接打赏画师</text>
  </view>

  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <view wx:else>
    <view wx:if="{{pendingOrders.length === 0 && rewardedOrders.length === 0}}" class="empty">
      <text>暂无可打赏的订单</text>
    </view>

    <!-- 可打赏订单 -->
    <block wx:if="{{pendingOrders.length > 0}}">
      <view class="section-title">可打赏订单</view>

      <block wx:for="{{pendingOrders}}" wx:key="id">
        <view class="order-card">
          <image class="artist-avatar" src="{{item.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
          <view class="card-body">
            <view class="artist-name">{{item.artistName}}</view>
            <view class="product-name">{{item.productName}}</view>
            <view class="meta">
              <text class="meta-text">完成于 {{item.completedText}}</text>
            </view>
          </view>
          <button class="reward-btn" data-order-id="{{item.id}}" bindtap="onRewardTap">
            打赏
          </button>
        </view>
      </block>
    </block>

    <!-- 已打赏订单 -->
    <block wx:if="{{rewardedOrders.length > 0}}">
      <view class="rewarded-separator">
        <view class="line"></view>
        <text class="rewarded-text">已打赏记录</text>
        <view class="line"></view>
      </view>

      <block wx:for="{{rewardedOrders}}" wx:key="id">
        <view class="order-card rewarded">
          <image class="artist-avatar" src="{{item.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
          <view class="card-body">
            <view class="artist-name">{{item.artistName}}</view>
            <view class="product-name">{{item.productName}}</view>
            <view class="meta">
              <text class="meta-text">完成于 {{item.completedText}}</text>
            </view>
          </view>
          <view class="rewarded-badge">
            <text class="badge-icon">✓</text>
            <text class="badge-text">¥{{item.rewardAmount}}</text>
          </view>
        </view>
      </block>
    </block>
  </view>

  <!-- 美观的打赏弹窗 -->
  <view wx:if="{{showRewardModal}}" class="reward-modal-mask" bindtap="hideRewardModal">
    <view class="reward-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <image class="modal-avatar" src="{{currentOrder.artistAvatar || defaultAvatar}}" mode="aspectFill"></image>
        <view class="modal-title">打赏 {{currentOrder.artistName}}</view>
        <view class="modal-subtitle">感谢画师的精彩创作</view>
      </view>

      <view class="amount-grid">
        <block wx:for="{{rewardOptions}}" wx:key="*this">
          <view 
            class="amount-item {{selectedAmount === item ? 'selected' : ''}}" 
            data-amount="{{item}}"
            bindtap="selectAmount"
          >
            <text class="amount-value">¥{{item}}</text>
          </view>
        </block>
        <view 
          class="amount-item custom {{selectedAmount === -1 ? 'selected' : ''}}"
          bindtap="selectCustomAmount"
        >
          <text class="amount-value">自定义</text>
        </view>
      </view>

      <view class="modal-actions">
        <button class="modal-btn cancel" bindtap="hideRewardModal">取消</button>
        <button class="modal-btn confirm" bindtap="confirmRewardFromModal">确认打赏</button>
      </view>
    </view>
  </view>
</view>
