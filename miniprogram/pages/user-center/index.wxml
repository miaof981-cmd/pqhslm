<view class="container">
  <!-- ✅ 调试信息：显示当前角色 -->
  <view style="font-size:24rpx; color:#666; padding:10rpx; text-align:center; background:#f0f0f0;">
    当前角色：{{roles}}
  </view>
  
  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>
  
  <view wx:else>
    <!-- 用户信息卡片 -->
    <view class="user-card">
      <view class="user-main-info">
        <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill" bindtap="promptRelogin" />
        <view class="user-details">
          <view class="user-name">{{userInfo.name}}</view>
          <view class="user-id">ID: {{userId}}</view>
          <view class="user-roles">
            <text wx:for="{{roleTexts}}" wx:key="*this" class="role-tag">{{item}}</text>
          </view>
          <text class="auth-hint" bindtap="promptRelogin">点击头像重新登录</text>
        </view>
      </view>
      <view class="role-manage-btn" bindtap="goToRoleManage">权限</view>
    </view>

    <!-- 我的订单 -->
    <view class="order-section">
      <view class="section-header">
        <text class="section-title">我的约稿</text>
        <text class="view-all" bindtap="viewAllOrders">查看全部 ></text>
      </view>
      
      <view class="order-stats">
        <view class="stat-item" data-status="processing" bindtap="viewAllOrders">
          <view class="stat-icon-wrapper">
            <view class="stat-icon processing"></view>
            <view wx:if="{{orderStats.processing > 0}}" class="stat-badge">{{orderStats.processing}}</view>
          </view>
          <text class="stat-label">制作中</text>
        </view>
        <view class="stat-item" data-status="completed" bindtap="viewAllOrders">
          <view class="stat-icon completed"></view>
          <text class="stat-label">已完成</text>
        </view>
        <view class="stat-item" data-status="refunded" bindtap="viewAllOrders">
          <view class="stat-icon refunded"></view>
          <text class="stat-label">已退款</text>
        </view>
        <view class="stat-item" bindtap="viewAllOrders">
          <view class="stat-icon all"></view>
          <text class="stat-label">全部订单</text>
        </view>
      </view>
    </view>

    <!-- 画师认证/工作台 -->
    <view wx:if="{{shouldShowCert}}" class="artist-certification">
      <!-- ✅ 统一入口：始终显示相同样式，点击进入查看详情 -->
      <view class="cert-banner" bindtap="goToArtistCertification">
        <view class="cert-content">
          <text class="cert-title">画师认证</text>
          <text class="cert-subtitle">点此进入画师认证开始工作吧！</text>
        </view>
        <view class="cert-illustration">
          <view class="cert-icon-circle"></view>
          <text class="cert-action-hint">点击认证 ></text>
        </view>
      </view>
    </view>

    <!-- 工作台区域（并列展示） -->
    <view wx:if="{{hasArtistRole || hasServiceRole || isAdmin}}" class="workspace-section">
      <view class="section-title">工作台</view>
      
      <view class="workspace-grid">
        <!-- 画师工作台 -->
        <view wx:if="{{hasArtistRole}}" class="workspace-card artist" bindtap="goToArtistWorkspace">
          <text class="workspace-name">画师工作台</text>
          <view wx:if="{{memberInfo && memberInfo.isValid}}" class="card-badge active">会员有效</view>
          <view wx:elif="{{memberInfo}}" class="card-badge expired">已过期</view>
        </view>

        <!-- 客服工作台 -->
        <view wx:if="{{hasServiceRole}}" class="workspace-card service" bindtap="goToServiceWorkspace">
          <text class="workspace-name">客服工作台</text>
        </view>

        <!-- 管理后台 -->
        <view wx:if="{{isAdmin}}" class="workspace-card admin" bindtap="goToAdmin">
          <text class="workspace-name">管理后台</text>
        </view>
      </view>

      <!-- 续费会员按钮（如果需要） -->
      <button wx:if="{{hasArtistRole && memberInfo && !memberInfo.isValid}}" 
              class="renew-member-btn" 
              bindtap="renewMember">
        续费会员
      </button>
    </view>

    <!-- 其他功能 -->
    <view class="other-section">
      <text class="section-title">其他</text>
      
      <view class="function-grid">
        <view class="function-item">
          <view class="function-icon icon-favorite"></view>
          <text class="function-label">收藏和关注</text>
        </view>
        <view class="function-item">
          <view class="function-icon icon-history"></view>
          <text class="function-label">历史足迹</text>
        </view>
        <view class="function-item">
          <view class="function-icon icon-service"></view>
          <text class="function-label">平台售后</text>
        </view>
        <view class="function-item">
          <view class="function-icon icon-show"></view>
          <text class="function-label">我的买家秀</text>
        </view>
        <view class="function-item">
          <view class="function-icon icon-reward"></view>
          <text class="function-label">打赏记录</text>
        </view>
      </view>
    </view>

    <!-- 退出登录 -->
    <view class="logout-section">
      <button class="logout-btn" bindtap="handleLogout">
        <text class="logout-icon">🚪</text>
        <text class="logout-text">退出登录</text>
      </button>
    </view>

    <!-- 版权信息 -->
    <view class="copyright">
      <text class="copyright-text">画师商城版权所有©2024</text>
      <text class="copyright-text">让创意更有价值</text>
    </view>
  </view>
</view>