<view class="container">
  <view class="header-section">
    <view class="header-icon">📋</view>
    <view class="header-title">建立画师档案</view>
    <view class="header-subtitle">完善个人信息，开启接单之旅</view>
  </view>

  <view class="content-section">
    <!-- ========== 未提交状态：显示表单 ========== -->
    <view wx:if="{{!isSubmitted}}" class="step-content">
      <!-- 第一步：添加工作人员 -->
      <view class="staff-contact-section {{hasArtistPermission ? 'completed' : ''}}">
        <view class="section-header">
          <view class="step-badge {{hasArtistPermission ? 'completed' : ''}}">
            {{hasArtistPermission ? '✓' : '第一步'}}
          </view>
          <text class="section-title">添加工作人员微信</text>
          <text wx:if="{{hasArtistPermission}}" class="completed-tag">已完成</text>
        </view>
        
        <!-- 仅在无权限时显示二维码 -->
        <view wx:if="{{!hasArtistPermission}}" class="staff-qrcode-box">
          <image class="staff-qrcode" src="{{staffQRCode}}" mode="aspectFit" />
          <text class="qrcode-label">长按识别二维码</text>
          <text class="qrcode-hint">添加后请说明您是新通过的画师</text>
        </view>
        
        <!-- 已完成时显示简化信息 -->
        <view wx:if="{{hasArtistPermission}}" class="completed-info">
          <text class="completed-text">工作人员已确认并开启权限</text>
        </view>
      </view>

      <!-- 第二步：填写个人信息 -->
      <view class="form-section {{hasArtistPermission ? 'active' : ''}}">
        <view class="section-header">
          <view class="step-badge">第二步</view>
          <text class="section-title">完善个人信息</text>
          <text wx:if="{{hasArtistPermission}}" class="current-tag">进行中</text>
        </view>
        <text class="section-hint">用于内部联系，不会公开在主页</text>

        <!-- 真实姓名 -->
        <view class="form-item">
          <text class="form-label required">真实姓名</text>
          <input 
            class="form-input" 
            placeholder="请输入真实姓名" 
            value="{{realName}}"
            bindinput="onRealNameInput"
          />
        </view>

        <!-- 联系手机号 + 验证码组 -->
        <view class="form-group">
          <view class="form-item">
            <text class="form-label required">联系手机号</text>
            <input 
              class="form-input" 
              type="number" 
              maxlength="11"
              placeholder="请输入手机号" 
              value="{{contactPhone}}"
              bindinput="onPhoneInput"
            />
          </view>

          <view class="form-item">
            <text class="form-label required">验证码</text>
            <view class="verify-input-group">
              <input 
                class="form-input verify-input" 
                type="number" 
                maxlength="6"
                placeholder="请输入验证码" 
                value="{{verifyCode}}"
                bindinput="onCodeInput"
              />
              <button 
                class="verify-btn {{canSendCode ? '' : 'disabled'}}" 
                bindtap="sendVerifyCode"
                disabled="{{!canSendCode}}"
              >
                {{codeButtonText}}
              </button>
            </view>
          </view>
        </view>

        <!-- 联系微信 -->
        <view class="form-item">
          <text class="form-label required">联系微信</text>
          <input 
            class="form-input" 
            placeholder="请输入微信号" 
            value="{{contactWechat}}"
            bindinput="onWechatInput"
          />
        </view>

        <!-- 紧急联系人组 -->
        <view class="form-group">
          <view class="form-item">
            <text class="form-label required">紧急联系人</text>
            <input 
              class="form-input" 
              placeholder="请输入紧急联系人姓名" 
              value="{{emergencyName}}"
              bindinput="onEmergencyNameInput"
            />
          </view>

          <view class="form-item">
            <text class="form-label required">与紧急联系人关系</text>
            <picker 
              mode="selector" 
              range="{{relationOptions}}" 
              value="{{relationIndex}}"
              bindchange="onRelationChange"
            >
              <view class="picker-input">
                {{relationIndex >= 0 ? relationOptions[relationIndex] : '请选择关系'}}
              </view>
            </picker>
          </view>

          <view class="form-item">
            <text class="form-label required">紧急联系电话</text>
            <input 
              class="form-input" 
              type="number" 
              maxlength="11"
              placeholder="请输入紧急联系人电话" 
              value="{{emergencyPhone}}"
              bindinput="onEmergencyPhoneInput"
            />
          </view>
        </view>
      </view>


      <!-- 提交按钮 -->
      <view class="submit-section">
        <button class="action-btn primary full" bindtap="submitProfile">
          提交档案
        </button>
      </view>

      <!-- 重要说明 -->
      <view class="notice-box">
        <view class="notice-title">重要说明</view>
        <view class="notice-item">
          <text class="notice-dot">•</text>
          <text class="notice-text">联系方式仅用于内部联系，不会公开在主页</text>
        </view>
        <view class="notice-item">
          <text class="notice-dot">•</text>
          <text class="notice-text">档案建立后，您可以新增最新联系方式</text>
        </view>
        <view class="notice-item">
          <text class="notice-dot">•</text>
          <text class="notice-text">请确保信息真实有效，便于平台联系</text>
        </view>
      </view>
    </view>

    <!-- ========== 已提交状态 ========== -->
    <view wx:if="{{isSubmitted}}" class="success-content">
      <view class="success-icon">✓</view>
      <text class="success-title">个人档案已建立</text>
      <text class="success-desc">您现在可以开始接单了</text>
      
      <view class="success-info">
        <view class="info-item">
          <text class="info-label">联系手机</text>
          <text class="info-value">{{contactPhone}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">联系微信</text>
          <text class="info-value">{{contactWechat}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">档案建立时间</text>
          <text class="info-value">{{createTime}}</text>
        </view>
      </view>

      <button class="action-btn primary full" bindtap="goToWorkspace">
        进入工作台
      </button>
    </view>
  </view>
</view>
