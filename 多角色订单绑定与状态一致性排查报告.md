# ğŸŒ¿ å¤šè§’è‰²è®¢å•ç»‘å®šä¸çŠ¶æ€ä¸€è‡´æ€§æ’æŸ¥æŠ¥å‘Š

**æ’æŸ¥æ—¥æœŸ**: 2025å¹´10æœˆ28æ—¥  
**æ’æŸ¥æ¨¡å¼**: ä»…æ£€æŸ¥åˆ†æï¼Œä¸ä¿®æ”¹ä»£ç   
**é—®é¢˜æè¿°**: å®¢æœå¤´åƒæœªç»‘å®šã€è®¢å•æ˜¾ç¤ºçŠ¶æ€ä¸ä¸€è‡´ã€æ ·å¼ä¸¢å¤±

---

## ä¸€ã€ğŸ‘¥ å¤šè§’è‰²å…³ç³»ç»‘å®šæ£€æŸ¥

### 1.1 è®¢å•æ•°æ®ç»“æ„å¯¹æ¯”

| é¡µé¢ | è¯»å–å­—æ®µ | ç¼ºå¤±å­—æ®µ | ç»‘å®šå‡½æ•° | æ˜¯å¦å…±ç”¨æ•°æ®æº |
|------|---------|---------|----------|---------------|
| **ç”¨æˆ·ç«¯** (order-list) | serviceId, serviceName, serviceAvatar, artistName, artistAvatar | âŒ assignedService | loadOrders() | âœ… YES |
| **ç”»å¸ˆç«¯** (workspace) | serviceId | âŒ serviceName, serviceAvatar | loadOrders() | âœ… YES |
| **å®¢æœç«¯** (service-workspace) | serviceId, buyerName, buyerAvatar, artistName, artistAvatar | âŒ serviceName (è‡ªå·±) | loadOrders() | âœ… YES |
| **ç®¡ç†ç«¯** (admin) | serviceId, serviceName, artistName | âŒ serviceAvatar | loadOrders() | âœ… YES |

### 1.2 è®¢å•åˆ›å»ºæ—¶çš„æ•°æ®ç»“æ„ âœ…

**æ–‡ä»¶**: `pages/order-success/index.js` (è¡Œ 140-163)

è®¢å•åˆ›å»ºæ—¶ä¿å­˜çš„å®Œæ•´ç»“æ„ï¼š
```javascript
{
  // ä¹°å®¶ä¿¡æ¯ âœ…
  buyerId: userId,
  buyerName: userInfo.nickName || 'å®¢æˆ·',
  buyerAvatar: userInfo.avatarUrl || '/assets/default-avatar.png',
  buyerOpenId: userInfo.openid || '',
  
  // ç”»å¸ˆä¿¡æ¯ âœ…
  artistId: orderInfo.artistId || '',
  artistName: orderInfo.artistName,
  artistAvatar: orderInfo.artistAvatar || '/assets/default-avatar.png',
  
  // å®¢æœä¿¡æ¯ âœ…
  serviceId: serviceInfo.serviceId,
  serviceName: serviceInfo.serviceName,
  serviceAvatar: serviceInfo.serviceAvatar,  // â­ å·²ä¿å­˜
  serviceQrcodeUrl: serviceInfo.serviceQrcodeUrl,
  serviceQrcodeNumber: serviceInfo.serviceQrcodeNumber
}
```

**ç»“è®º**: âœ… è®¢å•åˆ›å»ºæ—¶å·²å®Œæ•´ä¿å­˜æ‰€æœ‰è§’è‰²ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®¢æœå¤´åƒ `serviceAvatar`

---

### 1.3 å„é¡µé¢æ•°æ®è¯»å–è·¯å¾„åˆ†æ

#### ğŸ“± **ç”¨æˆ·ç«¯** (pages/order-list/index.js)

**è¯»å–é€»è¾‘** (è¡Œ 145-167):
```javascript
// 1ï¸âƒ£ ä¼˜å…ˆä½¿ç”¨è®¢å•ä¸­å·²ä¿å­˜çš„å®¢æœä¿¡æ¯
if (order.serviceName && order.serviceName !== 'å¾…åˆ†é…') {
  serviceName = order.serviceName
  serviceAvatar = order.serviceAvatar || '/assets/default-avatar.png'  // âœ…
  console.log(`âœ… ä½¿ç”¨è®¢å•ä¸­ä¿å­˜çš„å®¢æœä¿¡æ¯: ${serviceName}`)
} 
// 2ï¸âƒ£ å¦‚æœè®¢å•ä¸­æ²¡æœ‰ï¼Œå°è¯•ä»å®¢æœåˆ—è¡¨æŸ¥æ‰¾
else if (order.serviceId) {
  const service = serviceList.find(s => s.userId === order.serviceId)
  if (service) {
    serviceName = service.name || service.nickName || 'å®¢æœ'
    serviceAvatar = service.avatar || service.avatarUrl || '/assets/default-avatar.png'  // âœ…
  }
}
```

**ç»“è®º**: âœ… é€»è¾‘æ­£ç¡®ï¼Œä¼˜å…ˆä½¿ç”¨è®¢å•æ•°æ®ï¼Œå…œåº•æŸ¥æ‰¾å®¢æœåˆ—è¡¨

**â— é—®é¢˜**: 
- `customer_service_list` **ä¸ºç©º**å¯¼è‡´å…œåº•é€»è¾‘å¤±æ•ˆ
- å¦‚æœè®¢å•ä¸­ `serviceAvatar` æ˜¯é»˜è®¤è·¯å¾„ `/assets/default-avatar.png`ï¼Œè¯¥æ–‡ä»¶**ä¸å­˜åœ¨**

---

#### ğŸ¨ **ç”»å¸ˆç«¯** (pages/workspace/index.js)

**è¯»å–é€»è¾‘** (è¡Œ 372-376):
```javascript
// ç­›é€‰è®¢å•
myOrders = allOrders.filter(o => o.serviceId === currentUserId || !o.serviceId)
```

**WXML æ˜¾ç¤º** (pages/workspace/index.wxml è¡Œ 181-184):
```xml
<view class="people-item-compact">
  <text class="people-label-small">å®¢æœ</text>
  <image class="people-avatar-small" 
         src="{{item.serviceAvatar || '/assets/default-avatar.png'}}" 
         mode="aspectFill"/>
  <text class="people-name-compact">{{item.serviceName || 'å¾…åˆ†é…'}}</text>
</view>
```

**â— é—®é¢˜**: 
- JS ä»£ç ä¸­**æœªå¤„ç†** `serviceName` å’Œ `serviceAvatar`
- ç›´æ¥ä¾èµ–è®¢å•åŸå§‹æ•°æ®ä¸­çš„å­—æ®µ
- å¦‚æœè®¢å•æ•°æ®ä¸­è¿™ä¸¤ä¸ªå­—æ®µä¸ºç©ºæˆ–æ˜¯é»˜è®¤å€¼ï¼Œå°±ä¼šæ˜¾ç¤ºä¸æ­£ç¡®

---

#### ğŸ”§ **å®¢æœç«¯** (pages/service-workspace/index.js)

**è¯»å–é€»è¾‘** (è¡Œ 105-133):
```javascript
const finalOrders = processedOrders.map(order => {
  // è·å–ä¹°å®¶å¤´åƒ
  let buyerAvatar = order.buyerAvatar || '/assets/default-avatar.png'
  if (!order.buyerAvatar && order.userId) {
    const userInfo = wx.getStorageSync('userInfo')
    if (userInfo && userInfo.userId === order.userId) {
      buyerAvatar = userInfo.avatarUrl || '/assets/default-avatar.png'
    }
  }
  
  // è·å–ç”»å¸ˆå¤´åƒ
  const artistAvatar = order.artistAvatar || '/assets/default-avatar.png'
  
  return {
    ...order,
    buyerAvatar,
    artistAvatar,
    buyerName: order.buyerName || order.userName || 'å®¢æˆ·',
    artistName: order.artistName || 'å¾…åˆ†é…'
    // âŒ ç¼ºå°‘ serviceName å’Œ serviceAvatar çš„å¤„ç†
  }
})
```

**ç»“è®º**: âŒ å®¢æœç«¯**æœªå¤„ç†å®¢æœè‡ªå·±çš„ä¿¡æ¯**ï¼ˆè™½ç„¶ä¸éœ€è¦æ˜¾ç¤ºè‡ªå·±ï¼‰

---

#### ğŸ” **ç®¡ç†ç«¯** (pages/admin/index.js)

**è¯»å–é€»è¾‘** (è¡Œ 350-355):
```javascript
userName: order.buyerName || order.buyer || 'æœªçŸ¥ç”¨æˆ·',
userPhone: order.buyerPhone || '',
artistName: order.artistName || 'æœªåˆ†é…',
serviceName: order.serviceName || 'æœªåˆ†é…',  // âœ… ç›´æ¥ä½¿ç”¨è®¢å•æ•°æ®
```

**ç»“è®º**: âœ… ç›´æ¥ä½¿ç”¨è®¢å•ä¸­çš„ `serviceName`ï¼Œé€»è¾‘æ­£ç¡®

**WXML æ˜¾ç¤º**: åªæ˜¾ç¤ºæ–‡æœ¬ï¼Œä¸æ˜¾ç¤ºå¤´åƒï¼ˆæ­£å¸¸ï¼‰

---

## äºŒã€ğŸ§  çŠ¶æ€æ˜ å°„ä¸€è‡´æ€§æ£€æŸ¥

### 2.1 çŠ¶æ€æ˜ å°„å¯¹ç…§è¡¨

| çŠ¶æ€ä»£ç  | ç”¨æˆ·ç«¯ (order-list) | ç”»å¸ˆç«¯ (workspace) | å®¢æœç«¯ (service-workspace) | ç®¡ç†ç«¯ (admin) | æ˜¯å¦ä¸€è‡´ |
|----------|-------------------|-------------------|--------------------------|---------------|---------|
| `inProgress` | **åˆ¶ä½œä¸­** âŒ | æœªå®šä¹‰ | **è¿›è¡Œä¸­** âœ… | **è¿›è¡Œä¸­** âœ… | âŒ NO |
| `processing` | **åˆ¶ä½œä¸­** âœ… | æœªå®šä¹‰ | **è¿›è¡Œä¸­** âœ… | **åˆ¶ä½œä¸­** âœ… | âš ï¸ æ··ç”¨ |
| `waitingConfirm` | **å¾…ç¡®è®¤** âœ… | æœªå®šä¹‰ | **å¾…ç¡®è®¤** âœ… | **å¾…å®¢æˆ·ç¡®è®¤** âœ… | âœ… YES |
| `completed` | **å·²å®Œæˆ** âœ… | æœªå®šä¹‰ | **å·²å®Œæˆ** âœ… | **å·²å®Œæˆ** âœ… | âœ… YES |
| `overdue` | æœªæ˜ å°„ | æœªå®šä¹‰ | **å·²æ‹–ç¨¿** âœ… | **å·²æ‹–ç¨¿** âœ… | âœ… YES |
| `nearDeadline` | æœªæ˜ å°„ | æœªå®šä¹‰ | **ä¸´è¿‘æˆªç¨¿** âœ… | **ä¸´è¿‘æˆªç¨¿** âœ… | âœ… YES |

### 2.2 çŠ¶æ€æ˜ å°„å®šä¹‰ä½ç½®

| é¡µé¢ | çŠ¶æ€æ˜ å°„å®šä¹‰ | ä½ç½® | ç±»å‹ |
|------|-------------|------|------|
| **ç”¨æˆ·ç«¯** | ç¡¬ç¼–ç  | index.js è¡Œ 93-106 | âŒ æœ¬åœ°å®šä¹‰ |
| **ç”»å¸ˆç«¯** | æ—  | - | âŒ æœªå®šä¹‰ |
| **å®¢æœç«¯** | `getStatusText()` | index.js è¡Œ 193-207 | âš ï¸ å‡½æ•°å†…å®šä¹‰ |
| **ç®¡ç†ç«¯** | `statusTextMap` | index.js è¡Œ 294-307 | âš ï¸ å‡½æ•°å†…å®šä¹‰ |
| **å…¨å±€** | `orderStatusUtil` | utils/order-status.js | âœ… å·¥å…·å‡½æ•° |

### 2.3 çŠ¶æ€æ˜ å°„ä¸ä¸€è‡´é—®é¢˜

#### âŒ **é—®é¢˜1**: `inProgress` vs `processing` æ··ç”¨

- **ç”¨æˆ·ç«¯**æ˜ å°„ `inProgress` â†’ "åˆ¶ä½œä¸­"
- **å®¢æœç«¯**æ˜ å°„ `inProgress` â†’ "è¿›è¡Œä¸­"
- **ç®¡ç†ç«¯**æ˜ å°„ `inProgress` â†’ "è¿›è¡Œä¸­"ï¼Œ`processing` â†’ "åˆ¶ä½œä¸­"

**å»ºè®®**: ç»Ÿä¸€ä½¿ç”¨ `inProgress` è¡¨ç¤º"è¿›è¡Œä¸­"ï¼ŒåºŸå¼ƒ `processing`

#### âŒ **é—®é¢˜2**: ç”¨æˆ·ç«¯ç¡¬ç¼–ç çŠ¶æ€

**æ–‡ä»¶**: pages/order-list/index.js è¡Œ 93-106
```javascript
let status = 'processing'
let statusText = 'åˆ¶ä½œä¸­'  // âŒ ç¡¬ç¼–ç 

if (order.status === 'completed') {
  status = 'completed'
  statusText = 'å·²å®Œæˆ'  // âŒ ç¡¬ç¼–ç 
}
```

**å»ºè®®**: ä½¿ç”¨å…¨å±€ `statusTextMap` æˆ–è°ƒç”¨ `orderStatusUtil.getStatusText()`

#### âœ… **å…¨å±€çŠ¶æ€å·¥å…·**: utils/order-status.js

å­˜åœ¨å…¨å±€å·¥å…·å‡½æ•°ï¼Œä½†**æœªè¢«æ‰€æœ‰é¡µé¢ä½¿ç”¨**ï¼š
- âœ… å®¢æœç«¯ä½¿ç”¨äº† `orderStatusUtil.calculateOrdersStatus()`
- âŒ ç”¨æˆ·ç«¯æœªä½¿ç”¨
- âŒ ç”»å¸ˆç«¯æœªä½¿ç”¨

---

## ä¸‰ã€ğŸ¨ æ ·å¼ä¸çŠ¶æ€é¢œè‰²ç»‘å®šæ£€æŸ¥

### 3.1 æ ·å¼æ–‡ä»¶å¼•ç”¨å¯¹ç…§

| é¡µé¢ | å¼•ç”¨æ ·å¼æ–‡ä»¶ | ä½ç½® | ç±»åç»Ÿä¸€ | é¢œè‰²ä¸€è‡´ |
|------|-------------|------|---------|---------|
| **ç”¨æˆ·ç«¯** | `@import "../../styles/order-progress.wxss"` | index.wxss è¡Œ 2 | âœ… YES | âœ… YES |
| **ç”»å¸ˆç«¯** | `@import "../../styles/order-progress.wxss"` | index.wxss | âœ… YES | âœ… YES |
| **å®¢æœç«¯** | `@import "../../styles/order-progress.wxss"` | index.wxss | âœ… YES | âœ… YES |
| **ç®¡ç†ç«¯** | `@import "../../styles/order-progress.wxss"` | index.wxss | âœ… YES | âœ… YES |

**ç»“è®º**: âœ… æ‰€æœ‰é¡µé¢éƒ½å¼•ç”¨äº†ç»Ÿä¸€çš„æ ·å¼æ–‡ä»¶ `styles/order-progress.wxss`

### 3.2 çŠ¶æ€ç±»åæ£€æŸ¥

**WXML ä¸­çš„çŠ¶æ€ç±»å**:
```xml
<!-- ç”¨æˆ·ç«¯ -->
<view class="order-status status-{{item.status}}">{{item.statusText}}</view>

<!-- ç”»å¸ˆç«¯ -->
<view class="order-status status-{{item.status}}">{{item.statusText}}</view>

<!-- å®¢æœç«¯ -->
<view class="order-status status-{{item.status}}">{{item.businessStatus || item.statusText}}</view>

<!-- ç®¡ç†ç«¯ -->
<view class="order-status status-{{item.status}}">{{item.statusText}}</view>
```

**ç»“è®º**: âœ… ç±»åç»‘å®šé€»è¾‘ä¸€è‡´ï¼Œä½¿ç”¨ `status-{{item.status}}` åŠ¨æ€ç»‘å®š

### 3.3 æ ·å¼æ–‡ä»¶å†…å®¹ (styles/order-progress.wxss)

å·²å®šä¹‰çš„çŠ¶æ€æ ·å¼ç±»ï¼š
- `.status-inProgress` - ç»¿è‰²æ¸å˜
- `.status-nearDeadline` - æ©™è‰²æ¸å˜
- `.status-overdue` - çº¢è‰²æ¸å˜
- `.status-completed` - ç°è‰²
- `.status-waitingConfirm` - é»„è‰²

**â— é—®é¢˜**: 
- ç¼ºå°‘ `.status-processing` çš„å®šä¹‰
- å¦‚æœ `status` æ˜¯ `processing`ï¼Œæ ·å¼ä¸ä¼šç”Ÿæ•ˆ

---

## å››ã€ğŸ–¼ï¸ å®¢æœå¤´åƒæ˜¾ç¤ºç»‘å®šæ£€æŸ¥

### 4.1 å¤´åƒå­—æ®µè·¯å¾„æ£€æŸ¥

| é¡µé¢ | å¤´åƒå­—æ®µ | æ•°æ®æ¥æº | æ˜¾ç¤ºçŠ¶æ€ | ç¼ºå¤±åŸå›  |
|------|---------|---------|---------|---------|
| **ç”¨æˆ·ç«¯** | `serviceAvatar` | order.serviceAvatar â†’ customer_service_list | âŒ ä¸æ˜¾ç¤º | customer_service_list ä¸ºç©º + é»˜è®¤å¤´åƒè·¯å¾„ä¸å­˜åœ¨ |
| **ç”»å¸ˆç«¯** | `serviceAvatar` | order.serviceAvatar (ç›´æ¥ä½¿ç”¨) | âŒ ä¸æ˜¾ç¤º | è®¢å•æ•°æ®ä¸­æ˜¯é»˜è®¤è·¯å¾„ + æ–‡ä»¶ä¸å­˜åœ¨ |
| **å®¢æœç«¯** | (ä¸æ˜¾ç¤ºå®¢æœè‡ªå·±) | - | - | - |
| **ç®¡ç†ç«¯** | (åªæ˜¾ç¤ºæ–‡æœ¬) | order.serviceName | âœ… æ˜¾ç¤ºæ–‡æœ¬ | ä¸æ˜¾ç¤ºå¤´åƒ |

### 4.2 å¤´åƒåŠ è½½å¤±è´¥åŸå› åˆ†æ

#### ğŸ”´ **æ ¹æœ¬åŸå›  1**: `customer_service_list` ä¸ºç©º

**éªŒè¯è„šæœ¬è¾“å‡º**:
```
ğŸ“‹ å®¢æœåˆ—è¡¨: 0 ä¸ª
avatar å­—æ®µ: âŒ æœªä½¿ç”¨
avatarUrl å­—æ®µ: âœ… æœªä½¿ç”¨
âŒ æœªæ‰¾åˆ°å¤´åƒå­—æ®µ
å®¢æœæ€»æ•°: 0
```

**ç»“è®º**: æœ¬åœ°å­˜å‚¨ä¸­ `customer_service_list` æ˜¯ç©ºæ•°ç»„ï¼Œå¯¼è‡´ï¼š
1. ç”¨æˆ·ç«¯å…œåº•é€»è¾‘å¤±æ•ˆï¼ˆä»å®¢æœåˆ—è¡¨æŸ¥æ‰¾å¤±è´¥ï¼‰
2. åªèƒ½ä½¿ç”¨è®¢å•ä¸­å·²ä¿å­˜çš„ `serviceAvatar`

#### ğŸ”´ **æ ¹æœ¬åŸå›  2**: é»˜è®¤å¤´åƒè·¯å¾„ä¸å­˜åœ¨

**é”™è¯¯æ—¥å¿—**:
```
[æ¸²æŸ“å±‚ç½‘ç»œå±‚é”™è¯¯] Failed to load local image resource /assets/default-avatar.png 
the server responded with a status of 500 (HTTP/1.1 500 Internal Server Error)
```

**ç»“è®º**: 
- è®¢å•æ•°æ®ä¸­ `serviceAvatar` å€¼ä¸º `/assets/default-avatar.png`
- è¯¥æ–‡ä»¶åœ¨é¡¹ç›®ä¸­**ä¸å­˜åœ¨**
- å¯¼è‡´å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºç©ºç™½

#### ğŸ”´ **æ ¹æœ¬åŸå›  3**: è®¢å•æ•°æ®ä¸­ `serviceAvatar` æ˜¯é»˜è®¤å€¼

**ä»æ—¥å¿—æ¨æ–­**:
```
âœ… ä½¿ç”¨è®¢å•ä¸­ä¿å­˜çš„å®¢æœä¿¡æ¯: å¦™å¦™
```

- è®¢å•ä¸­ `serviceName` = "å¦™å¦™" âœ…
- è®¢å•ä¸­ `serviceAvatar` = "/assets/default-avatar.png" âŒ

**ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ**

æ£€æŸ¥è®¢å•åˆ›å»ºé€»è¾‘ (pages/order-success/index.js è¡Œ 77-101):

```javascript
// éšæœºåˆ†é…å®¢æœ
assignRandomService() {
  const serviceList = wx.getStorageSync('customer_service_list') || []
  const activeServices = serviceList.filter(s => s.isActive)
  
  if (activeServices.length === 0) {
    return {
      serviceId: '',
      serviceName: 'å¾…åˆ†é…',
      serviceAvatar: '/assets/default-avatar.png',  // âŒ é—®é¢˜åœ¨è¿™
      // ...
    }
  }
  
  const assignedService = activeServices[randomIndex]
  return {
    serviceId: assignedService.userId,
    serviceName: assignedService.name,
    serviceAvatar: assignedService.avatar || '/assets/default-avatar.png',  // âœ… æ­£ç¡®
    // ...
  }
}
```

**ç»“è®º**: 
- å¦‚æœ `customer_service_list` ä¸ºç©ºæˆ–æ²¡æœ‰åœ¨çº¿å®¢æœ
- è®¢å•åˆ›å»ºæ—¶ä¼šåˆ†é… `serviceName = "å¾…åˆ†é…"`ï¼Œ`serviceAvatar = "/assets/default-avatar.png"`
- **ä½†æ˜¯**ï¼Œä»æ—¥å¿—çœ‹ `serviceName = "å¦™å¦™"`ï¼Œè¯´æ˜å½“æ—¶æœ‰åˆ†é…å®¢æœ
- **é—®é¢˜**: å½“æ—¶ `customer_service_list` ä¸­çš„å®¢æœæ•°æ®å¯èƒ½æ²¡æœ‰ `avatar` å­—æ®µï¼Œæˆ–è€…æ˜¯ç©ºçš„

### 4.3 å¤´åƒæ˜¾ç¤ºé€»è¾‘æµç¨‹å›¾

```
ä¸‹å•æ—¶:
â””â”€ assignRandomService()
   â”œâ”€ customer_service_list æœ‰å®¢æœ? 
   â”‚  â”œâ”€ YES â†’ serviceAvatar = service.avatar âœ…
   â”‚  â””â”€ NO  â†’ serviceAvatar = '/assets/default-avatar.png' âŒ
   â””â”€ ä¿å­˜åˆ°è®¢å•

æŸ¥çœ‹è®¢å•æ—¶:
â””â”€ loadOrders()
   â”œâ”€ order.serviceName å­˜åœ¨?
   â”‚  â”œâ”€ YES â†’ ä½¿ç”¨ order.serviceAvatar âœ…
   â”‚  â””â”€ NO  â†’ ä» customer_service_list æŸ¥æ‰¾
   â”‚             â”œâ”€ æ‰¾åˆ° â†’ ä½¿ç”¨ service.avatar âœ…
   â”‚             â””â”€ æœªæ‰¾åˆ° â†’ é»˜è®¤å¤´åƒ âŒ
   â””â”€ æ¸²æŸ“ <image src="{{serviceAvatar}}" />
      â””â”€ å¦‚æœæ˜¯ /assets/default-avatar.png
         â””â”€ æ–‡ä»¶ä¸å­˜åœ¨ â†’ åŠ è½½å¤±è´¥ âŒ
```

---

## äº”ã€ğŸ“Š é—®é¢˜æ ¹å› æ€»ç»“

### ğŸ”´ æ ¸å¿ƒé—®é¢˜ 1: å®¢æœæ•°æ®åˆå§‹åŒ–ç¼ºå¤±

| é—®é¢˜ | å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|------|------|---------|
| `customer_service_list` ä¸ºç©º | ä¸‹å•æ—¶æ— æ³•åˆ†é…çœŸå®å®¢æœå¤´åƒ | ğŸ”´ HIGH |
| å…œåº•é€»è¾‘å¤±æ•ˆ | ç”¨æˆ·ç«¯æ— æ³•ä»å®¢æœåˆ—è¡¨æŸ¥æ‰¾å¤´åƒ | ğŸ”´ HIGH |
| å¿…é¡»é€šè¿‡ç®¡ç†åå°æ·»åŠ å®¢æœ | ç”¨æˆ·æ— æ³•è‡ªåŠ©æµ‹è¯• | âš ï¸ MEDIUM |

**è§£å†³æ–¹æ¡ˆ**:
1. é€šè¿‡ç®¡ç†åå°æ·»åŠ å®¢æœï¼ˆæ­£å¼æ–¹æ³•ï¼‰
2. è¿è¡Œæµ‹è¯•è„šæœ¬æ·»åŠ å®¢æœæ•°æ®ï¼ˆä¸´æ—¶æ–¹æ³•ï¼‰

---

### ğŸŸ¡ æ ¸å¿ƒé—®é¢˜ 2: é»˜è®¤å¤´åƒè·¯å¾„ä¸å­˜åœ¨

| é—®é¢˜ | å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|------|------|---------|
| `/assets/default-avatar.png` ä¸å­˜åœ¨ | å›¾ç‰‡åŠ è½½å¤±è´¥ | ğŸŸ¡ MEDIUM |
| æ§åˆ¶å°æŠ¥ 500 é”™è¯¯ | å½±å“ç”¨æˆ·ä½“éªŒ | ğŸŸ¡ MEDIUM |
| æ²¡æœ‰å…œåº•æ˜¾ç¤ºæ–¹æ¡ˆ | æ˜¾ç¤ºç©ºç™½ | ğŸŸ¡ MEDIUM |

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ›å»º `/miniprogram/assets/default-avatar.png` æ–‡ä»¶
2. æˆ–ä½¿ç”¨ base64 ç¼–ç çš„ SVG é»˜è®¤å¤´åƒ
3. æˆ–ä¿®æ”¹é»˜è®¤å¤´åƒè·¯å¾„ä¸ºäº‘å­˜å‚¨åœ°å€

---

### ğŸŸ  æ ¸å¿ƒé—®é¢˜ 3: çŠ¶æ€æ˜ å°„ä¸ç»Ÿä¸€

| é—®é¢˜ | å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|------|------|---------|
| `inProgress` vs `processing` æ··ç”¨ | ç”¨æˆ·ç«¯æ˜¾ç¤º"åˆ¶ä½œä¸­"ï¼Œå…¶ä»–ç«¯æ˜¾ç¤º"è¿›è¡Œä¸­" | ğŸŸ  MEDIUM |
| ç¡¬ç¼–ç çŠ¶æ€æ–‡å­— | éš¾ä»¥ç»´æŠ¤ï¼Œå®¹æ˜“å‡ºç°ä¸ä¸€è‡´ | ğŸŸ  MEDIUM |
| æœªä½¿ç”¨å…¨å±€çŠ¶æ€å·¥å…· | å„é¡µé¢è‡ªè¡Œå®šä¹‰ï¼Œåˆ†æ•£ç®¡ç† | ğŸŸ  MEDIUM |

**è§£å†³æ–¹æ¡ˆ**:
1. ç»Ÿä¸€ä½¿ç”¨ `orderStatusUtil.getStatusText()`
2. åºŸå¼ƒ `processing`ï¼Œç»Ÿä¸€ä½¿ç”¨ `inProgress`
3. åˆ é™¤å„é¡µé¢çš„æœ¬åœ°çŠ¶æ€æ˜ å°„å®šä¹‰

---

### ğŸŸ¢ æ ¸å¿ƒé—®é¢˜ 4: ç”»å¸ˆç«¯ç¼ºå°‘å®¢æœä¿¡æ¯å¤„ç†

| é—®é¢˜ | å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|------|------|---------|
| ç”»å¸ˆå·¥ä½œå°æœªå¤„ç† `serviceName` å’Œ `serviceAvatar` | ç›´æ¥ä¾èµ–è®¢å•åŸå§‹æ•°æ® | ğŸŸ¢ LOW |
| å¦‚æœè®¢å•æ•°æ®ç¼ºå¤±ï¼Œæ— å…œåº•é€»è¾‘ | å¯èƒ½æ˜¾ç¤ºç©ºç™½æˆ–"å¾…åˆ†é…" | ğŸŸ¢ LOW |

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ç”»å¸ˆå·¥ä½œå°çš„ `loadOrders()` ä¸­æ·»åŠ å®¢æœä¿¡æ¯å¤„ç†
2. ä¸ç”¨æˆ·ç«¯ä¿æŒä¸€è‡´çš„å…œåº•é€»è¾‘

---

## å…­ã€ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ P0 - ç«‹å³ä¿®å¤ï¼ˆé˜»å¡æ€§é—®é¢˜ï¼‰

1. **åˆ›å»ºé»˜è®¤å¤´åƒæ–‡ä»¶**
   - åˆ›å»º `/miniprogram/assets/default-avatar.png`
   - æˆ–ä½¿ç”¨ base64 SVG å¤´åƒ
   
2. **åˆå§‹åŒ–å®¢æœæ•°æ®**
   - é€šè¿‡ç®¡ç†åå°æ·»åŠ è‡³å°‘ä¸€ä¸ªå®¢æœ
   - æˆ–è¿è¡Œæµ‹è¯•è„šæœ¬æ·»åŠ æµ‹è¯•å®¢æœ

### ğŸŸ¡ P1 - é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“ä½“éªŒï¼‰

3. **ç»Ÿä¸€çŠ¶æ€æ˜ å°„**
   - åˆ›å»ºå…¨å±€ `statusTextMap` å¸¸é‡
   - æ‰€æœ‰é¡µé¢å¼•ç”¨å…¨å±€æ˜ å°„
   - åºŸå¼ƒ `processing`ï¼Œç»Ÿä¸€ä½¿ç”¨ `inProgress`

4. **ä¼˜åŒ–å¤´åƒåŠ è½½é€»è¾‘**
   - æ‰€æœ‰é¡µé¢ç»Ÿä¸€ä½¿ç”¨è®¢å•æ•°æ®ä¼˜å…ˆ + å®¢æœåˆ—è¡¨å…œåº•çš„é€»è¾‘
   - æ·»åŠ å¤´åƒåŠ è½½å¤±è´¥çš„å ä½ç¬¦

### ğŸŸ¢ P2 - ä¸­ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–ä½“éªŒï¼‰

5. **ç”»å¸ˆç«¯æ·»åŠ å®¢æœä¿¡æ¯å¤„ç†**
   - è¡¥å…… `serviceName` å’Œ `serviceAvatar` çš„å¤„ç†é€»è¾‘

6. **æ·»åŠ æ•°æ®éªŒè¯**
   - è®¢å•åˆ›å»ºæ—¶éªŒè¯å®¢æœæ•°æ®å®Œæ•´æ€§
   - æ·»åŠ  console æ—¥å¿—ä¾¿äºè°ƒè¯•

---

## ä¸ƒã€ğŸ“‹ æµ‹è¯•éªŒè¯æ¸…å•

### âœ… éªŒè¯æ­¥éª¤

1. **åˆå§‹åŒ–å®¢æœæ•°æ®**
   - [ ] è¿è¡Œæµ‹è¯•è„šæœ¬æˆ–é€šè¿‡ç®¡ç†åå°æ·»åŠ å®¢æœ
   - [ ] éªŒè¯ `customer_service_list` ä¸ä¸ºç©º
   - [ ] éªŒè¯å®¢æœæ•°æ®åŒ…å« `avatar` å­—æ®µ

2. **åˆ›å»ºæµ‹è¯•è®¢å•**
   - [ ] ä¸‹å•å¹¶æ£€æŸ¥è®¢å•æ•°æ®ä¸­çš„ `serviceAvatar`
   - [ ] åº”è¯¥æ˜¯çœŸå®å¤´åƒåœ°å€ï¼Œè€Œä¸æ˜¯é»˜è®¤è·¯å¾„

3. **æŸ¥çœ‹è®¢å•**
   - [ ] ç”¨æˆ·ç«¯ï¼šå®¢æœå¤´åƒæ­£å¸¸æ˜¾ç¤º
   - [ ] ç”»å¸ˆç«¯ï¼šå®¢æœå¤´åƒæ­£å¸¸æ˜¾ç¤º
   - [ ] å®¢æœç«¯ï¼šä¹°å®¶å’Œç”»å¸ˆå¤´åƒæ­£å¸¸æ˜¾ç¤º
   - [ ] ç®¡ç†ç«¯ï¼šå®¢æœåç§°æ­£å¸¸æ˜¾ç¤º

4. **æ£€æŸ¥æ§åˆ¶å°**
   - [ ] æ—  500 é”™è¯¯ï¼ˆå›¾ç‰‡åŠ è½½å¤±è´¥ï¼‰
   - [ ] æ—  "åœ¨å®¢æœåˆ—è¡¨ä¸­æœªæ‰¾åˆ°" è­¦å‘Š

---

## å…«ã€ğŸ”§ æ¨èä¿®å¤æ–¹æ¡ˆï¼ˆä»£ç ç¤ºä¾‹ï¼‰

### 1. åˆ›å»ºé»˜è®¤å¤´åƒå¸¸é‡

**æ–‡ä»¶**: `miniprogram/utils/constants.js` (æ–°å»º)
```javascript
// é»˜è®¤å¤´åƒ (SVG base64)
export const DEFAULT_AVATAR = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI0E4RTZDRiIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1zaXplPSI0MCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7lrqI8L3RleHQ+PC9zdmc+'

// å…¨å±€çŠ¶æ€æ˜ å°„
export const STATUS_TEXT_MAP = {
  'unpaid': 'å¾…æ”¯ä»˜',
  'paid': 'å·²æ”¯ä»˜',
  'created': 'å¾…å¤„ç†',
  'inProgress': 'è¿›è¡Œä¸­',
  'waitingConfirm': 'å¾…ç¡®è®¤',
  'nearDeadline': 'ä¸´è¿‘æˆªç¨¿',
  'overdue': 'å·²æ‹–ç¨¿',
  'completed': 'å·²å®Œæˆ',
  'refunding': 'é€€æ¬¾ä¸­',
  'refunded': 'å·²é€€æ¬¾',
  'cancelled': 'å·²å–æ¶ˆ'
}
```

### 2. ç»Ÿä¸€å¤´åƒè·å–å‡½æ•°

**æ–‡ä»¶**: `miniprogram/utils/avatar-helper.js` (æ–°å»º)
```javascript
import { DEFAULT_AVATAR } from './constants.js'

/**
 * è·å–å®¢æœå¤´åƒ
 * @param {Object} order - è®¢å•å¯¹è±¡
 * @returns {String} å¤´åƒ URL
 */
export function getServiceAvatar(order) {
  // 1. ä¼˜å…ˆä½¿ç”¨è®¢å•ä¸­ä¿å­˜çš„å¤´åƒ
  if (order.serviceAvatar && order.serviceAvatar !== '/assets/default-avatar.png') {
    return order.serviceAvatar
  }
  
  // 2. ä»å®¢æœåˆ—è¡¨æŸ¥æ‰¾
  if (order.serviceId) {
    const serviceList = wx.getStorageSync('customer_service_list') || []
    const service = serviceList.find(s => s.userId === order.serviceId)
    if (service && service.avatar) {
      return service.avatar
    }
  }
  
  // 3. è¿”å›é»˜è®¤å¤´åƒ
  return DEFAULT_AVATAR
}

/**
 * è·å–å®¢æœåç§°
 * @param {Object} order - è®¢å•å¯¹è±¡
 * @returns {String} å®¢æœåç§°
 */
export function getServiceName(order) {
  if (order.serviceName && order.serviceName !== 'å¾…åˆ†é…') {
    return order.serviceName
  }
  
  if (order.serviceId) {
    const serviceList = wx.getStorageSync('customer_service_list') || []
    const service = serviceList.find(s => s.userId === order.serviceId)
    if (service) {
      return service.name || service.nickName || 'å®¢æœ'
    }
  }
  
  return 'å¾…åˆ†é…'
}
```

### 3. å„é¡µé¢ä½¿ç”¨ç»Ÿä¸€å‡½æ•°

```javascript
import { getServiceAvatar, getServiceName } from '../../utils/avatar-helper.js'
import { STATUS_TEXT_MAP } from '../../utils/constants.js'

// åœ¨ loadOrders ä¸­ä½¿ç”¨
const finalOrders = processedOrders.map(order => {
  return {
    ...order,
    serviceName: getServiceName(order),
    serviceAvatar: getServiceAvatar(order),
    statusText: STATUS_TEXT_MAP[order.status] || order.status
  }
})
```

---

## ä¹ã€ğŸ“Œ å…³é”®å‘ç°æ±‡æ€»

| # | å‘ç° | ç±»å‹ | å½±å“ |
|---|------|------|------|
| 1 | `customer_service_list` ä¸ºç©º | ğŸ”´ æ•°æ®ç¼ºå¤± | å®¢æœå¤´åƒæ— æ³•æ˜¾ç¤º |
| 2 | é»˜è®¤å¤´åƒæ–‡ä»¶ä¸å­˜åœ¨ | ğŸ”´ èµ„æºç¼ºå¤± | å›¾ç‰‡åŠ è½½ 500 é”™è¯¯ |
| 3 | `inProgress` vs `processing` æ··ç”¨ | ğŸŸ  çŠ¶æ€ä¸ä¸€è‡´ | ä¸åŒé¡µé¢æ˜¾ç¤ºä¸åŒæ–‡å­— |
| 4 | çŠ¶æ€æ˜ å°„åˆ†æ•£å®šä¹‰ | ğŸŸ  ç»´æŠ¤å›°éš¾ | å®¹æ˜“å‡ºç°ä¸ä¸€è‡´ |
| 5 | ç”»å¸ˆç«¯æœªå¤„ç†å®¢æœä¿¡æ¯ | ğŸŸ¢ é€»è¾‘ç¼ºå¤± | ä¾èµ–åŸå§‹æ•°æ® |
| 6 | æ‰€æœ‰é¡µé¢å…±ç”¨è®¢å•æ•°æ®æº | âœ… æ•°æ®ä¸€è‡´ | æ— é—®é¢˜ |
| 7 | æ‰€æœ‰é¡µé¢å¼•ç”¨ç»Ÿä¸€æ ·å¼ | âœ… æ ·å¼ä¸€è‡´ | æ— é—®é¢˜ |

---

## åã€âœ… æŠ¥å‘Šç»“è®º

### æ•°æ®ç»“æ„å±‚é¢
- âœ… **è®¢å•æ•°æ®ç»“æ„ç»Ÿä¸€**: æ‰€æœ‰é¡µé¢è¯»å–ç›¸åŒçš„ `orders` å’Œ `pending_orders`
- âœ… **è®¢å•åˆ›å»ºå®Œæ•´**: ä¸‹å•æ—¶å·²ä¿å­˜æ‰€æœ‰è§’è‰²ä¿¡æ¯ï¼ˆä¹°å®¶ã€ç”»å¸ˆã€å®¢æœï¼‰
- âŒ **å®¢æœåˆ—è¡¨ç¼ºå¤±**: `customer_service_list` ä¸ºç©ºå¯¼è‡´å…œåº•é€»è¾‘å¤±æ•ˆ

### çŠ¶æ€æ˜ å°„å±‚é¢
- âš ï¸ **çŠ¶æ€æ˜ å°„åˆ†æ•£**: å„é¡µé¢è‡ªè¡Œå®šä¹‰çŠ¶æ€æ˜ å°„ï¼Œæœªç»Ÿä¸€
- âŒ **çŠ¶æ€ä»£ç ä¸ä¸€è‡´**: `inProgress` å’Œ `processing` æ··ç”¨
- âœ… **å…¨å±€å·¥å…·å­˜åœ¨**: `orderStatusUtil` å·²å®ç°ï¼Œä½†æœªè¢«æ‰€æœ‰é¡µé¢ä½¿ç”¨

### æ ·å¼å±‚é¢
- âœ… **æ ·å¼æ–‡ä»¶ç»Ÿä¸€**: æ‰€æœ‰é¡µé¢å¼•ç”¨ `styles/order-progress.wxss`
- âœ… **ç±»åç»‘å®šä¸€è‡´**: ä½¿ç”¨ `status-{{item.status}}` åŠ¨æ€ç»‘å®š
- âš ï¸ **ç¼ºå°‘éƒ¨åˆ†çŠ¶æ€æ ·å¼**: æœªå®šä¹‰ `.status-processing`

### å¤´åƒæ˜¾ç¤ºå±‚é¢
- âŒ **å®¢æœåˆ—è¡¨ä¸ºç©º**: å¯¼è‡´æ— æ³•è·å–çœŸå®å¤´åƒ
- âŒ **é»˜è®¤å¤´åƒä¸å­˜åœ¨**: `/assets/default-avatar.png` æ–‡ä»¶ç¼ºå¤±
- âš ï¸ **å…œåº•é€»è¾‘ä¸å®Œå–„**: éƒ¨åˆ†é¡µé¢æœªå®ç°å¤´åƒå…œåº•é€»è¾‘

---

## ğŸ“¢ æœ€ç»ˆå»ºè®®

**ç«‹å³æ‰§è¡Œ**:
1. è¿è¡Œ `æ·»åŠ æµ‹è¯•å®¢æœ.js` è„šæœ¬åˆå§‹åŒ–å®¢æœæ•°æ®
2. åˆ›å»ºé»˜è®¤å¤´åƒæ–‡ä»¶æˆ–ä½¿ç”¨ base64 SVG

**åç»­ä¼˜åŒ–**:
3. åˆ›å»ºå…¨å±€å¸¸é‡æ–‡ä»¶ç»Ÿä¸€çŠ¶æ€æ˜ å°„å’Œé»˜è®¤å€¼
4. åˆ›å»ºå¤´åƒå·¥å…·å‡½æ•°ç»Ÿä¸€å¤´åƒè·å–é€»è¾‘
5. æ‰€æœ‰é¡µé¢æ”¹ç”¨å…¨å±€å‡½æ•°ï¼Œåˆ é™¤æœ¬åœ°å®šä¹‰

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2025å¹´10æœˆ28æ—¥  
**æ’æŸ¥æ¨¡å¼**: ä»…æ£€æŸ¥åˆ†æâœ… | æœªä¿®æ”¹ä»£ç âœ…

