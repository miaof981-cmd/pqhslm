# 前端迁移执行计划

> **目标**：将所有 `wx.getStorageSync/wx.setStorageSync` 替换为云函数调用  
> **预估工作量**：50+文件需要修改  
> **策略**：按模块逐步迁移，确保每个模块可独立测试

---

## 📋 迁移优先级

### 第一优先级（核心基础）
1. ✅ **轮播图** - 已完成
2. ⏳ **用户登录/注册** - 最基础，影响所有功能
3. ⏳ **公告列表** - 简单，测试云函数

### 第二优先级（展示类）
4. ⏳ **商品列表/详情** - 首页核心功能
5. ⏳ **分类管理** - 商品依赖
6. ⏳ **买家秀** - 独立模块

### 第三优先级（业务核心）
7. ⏳ **订单创建** - 核心业务
8. ⏳ **订单列表/详情** - 多角色权限
9. ⏳ **订单状态更新** - 工作流

### 第四优先级（画师相关）
10. ⏳ **画师申请** - 申请流程
11. ⏳ **画师档案** - 档案管理
12. ⏳ **画师商品管理** - 画师后台

### 第五优先级（财务相关）
13. ⏳ **收入查询** - 财务模块
14. ⏳ **提现申请** - 财务流程
15. ⏳ **打赏记录** - 独立功能

### 第六优先级（管理功能）
16. ⏳ **客服二维码** - 系统配置
17. ⏳ **统计数据** - 管理后台

---

## 🎯 当前任务：迁移用户模块

### 涉及文件：
- `miniprogram/app.js` - 全局登录逻辑
- `miniprogram/pages/login/index.js` - 登录页面
- `miniprogram/utils/user-helper.js` - 用户工具类

### 迁移步骤：
1. 修改 app.js 的 initUserInfo 使用云函数登录
2. 修改 login 页面调用云API
3. 测试登录流程
4. 确认用户信息同步

---

## ⚠️ 注意事项

### 数据格式兼容
- 云数据库字段名可能与本地存储不同
- 需要做字段映射和转换

### 权限问题
- 某些数据需要管理员权限
- 确保权限检查逻辑正确

### 错误处理
- 网络错误降级处理
- 云函数调用失败时的兜底方案

### 测试策略
- 每迁移一个模块立即测试
- 保留本地存储作为备份（可选）

---

## 📝 迁移模板

### 替换前：
```javascript
const products = wx.getStorageSync('mock_products') || []
```

### 替换后：
```javascript
const cloudAPI = require('../../utils/cloud-api.js')
const res = await cloudAPI.getProductList()
const products = res.success ? res.data.list : []
```

---

## ✅ 完成检查

每完成一个模块后检查：
- [ ] 功能正常运行
- [ ] 数据正确显示
- [ ] 错误处理到位
- [ ] 无明显性能问题
- [ ] 提交代码到git

---

准备开始迁移用户模块。

