# æ•°æ®ä¸€è‡´æ€§é˜²é”™æŒ‡å—

## ğŸ“‹ é—®é¢˜å†å²

### é—®é¢˜1ï¼šå•†å“çŠ¶æ€å­—æ®µä¸ä¸€è‡´ï¼ˆ2025-10-27ï¼‰
**é¡µé¢**: `pages/artist-products-manage/index`
**é—®é¢˜**: ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µå `status`ï¼Œå®é™…åº”ä¸º `isOnSale`
**å½±å“**: æ‰€æœ‰å•†å“æ˜¾ç¤ºä¸º"å·²ä¸‹æ¶"ï¼Œç­›é€‰åŠŸèƒ½å¤±æ•ˆ
**ä¿®å¤**: ç»Ÿä¸€ä½¿ç”¨ `isOnSale` å­—æ®µï¼ˆå¸ƒå°”å€¼ï¼‰

### é—®é¢˜2ï¼šå•†å“ä»·æ ¼æ˜¾ç¤ºä¸ä¸€è‡´ï¼ˆ2025-10-27ï¼‰
**é¡µé¢**: `pages/artist-products-manage/index`
**é—®é¢˜**: ç¼ºå°‘ä»·æ ¼å¤„ç†é€»è¾‘ï¼Œä¸é¦–é¡µæ˜¾ç¤ºä¸ä¸€è‡´
**å½±å“**: ä»·æ ¼æ˜¾ç¤ºä¸º Â¥10 è€Œéæ­£ç¡®ä»·æ ¼
**ä¿®å¤**: æ·»åŠ ä¸é¦–é¡µä¸€è‡´çš„ä»·æ ¼å›é€€å¤„ç†é€»è¾‘

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### æ ¸å¿ƒé—®é¢˜
**ä¸åŒé¡µé¢å¯¹åŒä¸€æ•°æ®ç»“æ„çš„å¤„ç†é€»è¾‘ä¸ä¸€è‡´**

### å…¸å‹åœºæ™¯
1. âŒ é¡µé¢Aä½¿ç”¨ `status` å­—æ®µ
2. âŒ é¡µé¢Bä½¿ç”¨ `isOnSale` å­—æ®µ
3. âŒ é¡µé¢Cç›´æ¥ä½¿ç”¨ `price`
4. âŒ é¡µé¢Dæœ‰ `price` å›é€€å¤„ç†

### ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿ
1. å¤åˆ¶ç²˜è´´ä»£ç æ—¶ä¿®æ”¹ä¸å®Œæ•´
2. æ–°å¢é¡µé¢æ—¶å‚è€ƒäº†é”™è¯¯çš„ç¤ºä¾‹
3. æ•°æ®ç»“æ„å˜æ›´åæœªåŒæ­¥æ‰€æœ‰é¡µé¢
4. ç¼ºå°‘ç»Ÿä¸€çš„å·¥å…·å‡½æ•°

---

## âœ… æ•°æ®å­—æ®µæ ‡å‡†

### 1. å•†å“çŠ¶æ€ï¼ˆä¸Šæ¶/ä¸‹æ¶ï¼‰

**æ ‡å‡†å­—æ®µ**: `isOnSale`

| å€¼ | å«ä¹‰ | æ˜¾ç¤º |
|---|------|------|
| `true` | å·²ä¸Šæ¶ | "å·²ä¸Šæ¶" |
| `undefined` | é»˜è®¤ä¸Šæ¶ | "å·²ä¸Šæ¶" |
| `false` | å·²ä¸‹æ¶ | "å·²ä¸‹æ¶" |

**æ­£ç¡®ç”¨æ³•**:
```javascript
// âœ… åˆ¤æ–­æ˜¯å¦ä¸Šæ¶
if (product.isOnSale !== false) {
  // å•†å“å·²ä¸Šæ¶
}

// âœ… ç­›é€‰ä¸Šæ¶å•†å“
const onlineProducts = products.filter(p => p.isOnSale !== false)

// âœ… ç­›é€‰ä¸‹æ¶å•†å“
const offlineProducts = products.filter(p => p.isOnSale === false)
```

**é”™è¯¯ç”¨æ³•**:
```javascript
// âŒ ä½¿ç”¨ä¸å­˜åœ¨çš„ status å­—æ®µ
if (product.status === 'online') { ... }

// âŒ ä½¿ç”¨ === true (ä¼šæ¼æ‰ undefined)
if (product.isOnSale === true) { ... }
```

---

### 2. å•†å“ä»·æ ¼

**æ ‡å‡†å­—æ®µ**: `price`, `basePrice`, `specs`

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `price` | Number | ç¼–è¾‘æ—¶è®¡ç®—çš„æœ€ç»ˆæ˜¾ç¤ºä»·æ ¼ |
| `basePrice` | Number | åŸºç¡€ä»·æ ¼ï¼ˆæ— è§„æ ¼æ—¶ï¼‰ |
| `specs` | Array | è§„æ ¼æ•°ç»„ï¼ˆæœ‰è§„æ ¼æ—¶ï¼‰ |

**ä¼˜å…ˆçº§**:
1. `price` (å¦‚æœå­˜åœ¨ä¸”æœ‰æ•ˆ)
2. `basePrice` (å¦‚æœ price æ— æ•ˆ)
3. ä» `specs` è®¡ç®—æœ€ä½ä»·
4. `0` (é»˜è®¤å€¼)

**æ­£ç¡®ç”¨æ³•**:
```javascript
// âœ… ä½¿ç”¨ç»Ÿä¸€å·¥å…·å‡½æ•°ï¼ˆæ¨èï¼‰
const priceHelper = require('../../utils/price-helper')
const displayPrice = priceHelper.getProductDisplayPrice(product)

// âœ… æ‰‹åŠ¨å®ç°ï¼ˆä¸æ¨èï¼Œä½†éœ€è¦æ—¶å¯å‚è€ƒï¼‰
let displayPrice = parseFloat(product.price) || parseFloat(product.basePrice) || 0
```

**é”™è¯¯ç”¨æ³•**:
```javascript
// âŒ ç›´æ¥ä½¿ç”¨ priceï¼ˆå¯èƒ½ä¸º undefinedï¼‰
<text>Â¥{{item.price}}</text>

// âŒ ä¸å¤„ç†å­—ç¬¦ä¸²è½¬æ•°å­—
const price = product.price // å¯èƒ½æ˜¯ "0" å­—ç¬¦ä¸²

// âŒ ä¸æä¾›é»˜è®¤å€¼
const price = parseFloat(product.price) // å¯èƒ½æ˜¯ NaN
```

---

### 3. ç”»å¸ˆä¿¡æ¯

**æ ‡å‡†å­—æ®µ**: `artistId`, `artistName`, `artistAvatar`

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `artistId` | String/Number | ç”»å¸ˆç”¨æˆ·ID |
| `artistName` | String | ç”»å¸ˆæ˜µç§° |
| `artistAvatar` | String | ç”»å¸ˆå¤´åƒURL/base64 |

**æ­£ç¡®ç”¨æ³•**:
```javascript
// âœ… ä¿å­˜å•†å“æ—¶è®°å½•ç”»å¸ˆä¿¡æ¯
const product = {
  artistId: wx.getStorageSync('userId'),
  artistName: userInfo.nickName || 'ç”»å¸ˆ',
  artistAvatar: userInfo.avatarUrl || '/assets/default-avatar.png',
  // ... å…¶ä»–å­—æ®µ
}

// âœ… ç­›é€‰ç”»å¸ˆå•†å“æ—¶ä½¿ç”¨ == (å…¼å®¹å­—ç¬¦ä¸²å’Œæ•°å­—)
const myProducts = products.filter(p => p.artistId == currentUserId)
```

**é”™è¯¯ç”¨æ³•**:
```javascript
// âŒ åªä¿å­˜ artistNameï¼Œä¸ä¿å­˜ ID å’Œå¤´åƒ
const product = {
  artistName: 'ç”»å¸ˆ',
  // ç¼ºå°‘ artistId å’Œ artistAvatar
}

// âŒ ä½¿ç”¨ === ä¸¥æ ¼ç›¸ç­‰ï¼ˆå¯èƒ½å› ç±»å‹ä¸åŒå¯¼è‡´åŒ¹é…å¤±è´¥ï¼‰
products.filter(p => p.artistId === currentUserId) // å¦‚æœä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ä¸€ä¸ªæ˜¯æ•°å­—å°±ä¼šå¤±è´¥
```

---

## ğŸ› ï¸ ç»Ÿä¸€å·¥å…·å‡½æ•°

### ä»·æ ¼å¤„ç†å·¥å…·

**ä½ç½®**: `miniprogram/utils/price-helper.js`

**ä½¿ç”¨æ–¹æ³•**:
```javascript
const priceHelper = require('../../utils/price-helper')

// è·å–å•ä¸ªå•†å“æ˜¾ç¤ºä»·æ ¼
const price = priceHelper.getProductDisplayPrice(product)

// æ‰¹é‡å¤„ç†å•†å“æ•°ç»„
const processedProducts = priceHelper.processProductsPrices(products)

// æ ¼å¼åŒ–ä»·æ ¼æ˜¾ç¤º
const formatted = priceHelper.formatPrice(99.5) // "Â¥99.50"
const noSymbol = priceHelper.formatPrice(99.5, false) // "99.50"
```

---

## ğŸ“ é¡µé¢å¼€å‘æ£€æŸ¥æ¸…å•

### æ–°å¢å•†å“ç›¸å…³é¡µé¢æ—¶

#### 1. æ•°æ®è¯»å–æ£€æŸ¥
- [ ] ä½¿ç”¨ `isOnSale` åˆ¤æ–­ä¸Šæ¶çŠ¶æ€ï¼ˆä¸æ˜¯ `status`ï¼‰
- [ ] ä½¿ç”¨ä»·æ ¼å·¥å…·å‡½æ•°æˆ–æ­£ç¡®çš„å›é€€é€»è¾‘
- [ ] ä½¿ç”¨ `artistId` ç­›é€‰æ—¶ç”¨ `==`ï¼ˆä¸æ˜¯ `===`ï¼‰
- [ ] è¯»å–ç”»å¸ˆå¤´åƒä½¿ç”¨ `artistAvatar` å­—æ®µ

#### 2. æ•°æ®å±•ç¤ºæ£€æŸ¥
- [ ] ä»·æ ¼æ˜¾ç¤ºä½¿ç”¨ `getProductDisplayPrice()` æˆ– `price || basePrice`
- [ ] çŠ¶æ€æ˜¾ç¤ºä½¿ç”¨ `isOnSale !== false ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'`
- [ ] ç”»å¸ˆå¤´åƒæ˜¾ç¤ºä½¿ç”¨ `artistAvatar || '/assets/default-avatar.png'`

#### 3. æ•°æ®æ“ä½œæ£€æŸ¥
- [ ] ä¸Šæ¶/ä¸‹æ¶æ“ä½œä¿®æ”¹ `isOnSale` å­—æ®µï¼ˆå¸ƒå°”å€¼ï¼‰
- [ ] å•†å“ä¿å­˜æ—¶è®°å½•å®Œæ•´çš„ç”»å¸ˆä¿¡æ¯ï¼ˆIDã€æ˜µç§°ã€å¤´åƒï¼‰
- [ ] ä»·æ ¼ä¿å­˜æ—¶åŒæ—¶ä¿å­˜ `price` å’Œ `basePrice`

#### 4. æ§åˆ¶å°è°ƒè¯•
- [ ] æ·»åŠ  `console.log` è¾“å‡ºå…³é”®æ•°æ®
- [ ] æ˜¾ç¤ºå­—æ®µåã€ç±»å‹ã€å€¼
- [ ] æ˜¾ç¤ºç­›é€‰/å¤„ç†ç»“æœ

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨å·¥å…·å‡½æ•°
```javascript
// âœ… å¥½ï¼šç»Ÿä¸€é€»è¾‘ï¼Œæ˜“ç»´æŠ¤
const price = priceHelper.getProductDisplayPrice(product)

// âŒ å·®ï¼šé‡å¤ä»£ç ï¼Œæ˜“å‡ºé”™
const price = parseFloat(product.price) || parseFloat(product.basePrice) || 0
```

### 2. å­—æ®µåä¿æŒä¸€è‡´
```javascript
// âœ… å¥½ï¼šå…¨é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨ isOnSale
const onlineProducts = products.filter(p => p.isOnSale !== false)

// âŒ å·®ï¼šæœ‰çš„é¡µé¢ç”¨ statusï¼Œæœ‰çš„ç”¨ isOnSale
const onlineProducts = products.filter(p => p.status === 'online')
```

### 3. ç±»å‹è½¬æ¢è¦æ˜ç¡®
```javascript
// âœ… å¥½ï¼šæ˜ç¡®è½¬æ¢ä¸ºæ•°å­—å¹¶æä¾›é»˜è®¤å€¼
const price = parseFloat(product.price) || 0

// âŒ å·®ï¼šç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½æ˜¯å­—ç¬¦ä¸²æˆ– undefined
const price = product.price
```

### 4. æ·»åŠ è°ƒè¯•æ—¥å¿—
```javascript
// âœ… å¥½ï¼šè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
console.log('å•†å“ä»·æ ¼å¤„ç†:', {
  åŸå§‹price: product.price,
  basePrice: product.basePrice,
  æœ€ç»ˆæ˜¾ç¤º: displayPrice
})

// âŒ å·®ï¼šæ²¡æœ‰è°ƒè¯•ä¿¡æ¯ï¼Œå‡ºé—®é¢˜éš¾æ’æŸ¥
const price = parseFloat(product.price) || 0
```

---

## ğŸ”„ å·²çŸ¥å—å½±å“é¡µé¢

### éœ€è¦ä½¿ç”¨ç»Ÿä¸€é€»è¾‘çš„é¡µé¢

| é¡µé¢è·¯å¾„ | æ¶‰åŠæ•°æ® | çŠ¶æ€ |
|---------|---------|------|
| `pages/home/index` | å•†å“ä»·æ ¼ã€ä¸Šæ¶çŠ¶æ€ | âœ… å·²ä¿®å¤ |
| `pages/product-detail/index` | å•†å“ä»·æ ¼ã€ç”»å¸ˆä¿¡æ¯ | âœ… å·²ä¿®å¤ |
| `pages/artist-products-manage/index` | å•†å“ä»·æ ¼ã€ä¸Šæ¶çŠ¶æ€ | âœ… å·²ä¿®å¤ |
| `pages/product-edit/index` | ä»·æ ¼ä¿å­˜ã€ç”»å¸ˆä¿¡æ¯ | âœ… å·²éªŒè¯ |
| `pages/order-list/index` | å•†å“ä»·æ ¼ | âš ï¸ å¾…éªŒè¯ |
| `pages/order-detail/index` | å•†å“ä»·æ ¼ã€ç”»å¸ˆä¿¡æ¯ | âš ï¸ å¾…éªŒè¯ |
| `pages/cart/index` | å•†å“ä»·æ ¼ | âœ… å·²éªŒè¯ |
| `pages/admin/product-manage/index` | å•†å“ä»·æ ¼ã€ä¸Šæ¶çŠ¶æ€ | âš ï¸ å¾…éªŒè¯ |

---

## ğŸš¨ å‡ºç°ä¸ä¸€è‡´æ—¶çš„æ’æŸ¥æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æ•°æ®ç»“æ„
```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œ
const products = wx.getStorageSync('mock_products') || []
const product = products[0]
console.log('å•†å“æ•°æ®ç»“æ„:', {
  id: product.id,
  name: product.name,
  price: product.price,
  basePrice: product.basePrice,
  isOnSale: product.isOnSale,
  artistId: product.artistId,
  artistName: product.artistName,
  artistAvatar: product.artistAvatar
})
```

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥å­—æ®µä½¿ç”¨
1. æœç´¢é¡µé¢ JS æ–‡ä»¶ä¸­çš„å­—æ®µå
2. ç¡®è®¤æ˜¯å¦ä½¿ç”¨æ ‡å‡†å­—æ®µ
3. ç¡®è®¤æ˜¯å¦æœ‰å›é€€å¤„ç†

### ç¬¬ä¸‰æ­¥ï¼šå¯¹æ¯”æ­£ç¡®é¡µé¢
1. æ‰“å¼€ `pages/home/index.js`ï¼ˆå·²ç¡®è®¤æ­£ç¡®ï¼‰
2. å¯¹æ¯”æ•°æ®å¤„ç†é€»è¾‘
3. å¤åˆ¶æ­£ç¡®çš„é€»è¾‘

### ç¬¬å››æ­¥ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—
```javascript
console.log('=== æ•°æ®è¯»å–è°ƒè¯• ===')
console.log('åŸå§‹æ•°æ®:', product)
console.log('å¤„ç†åæ•°æ®:', processedProduct)
console.log('æ˜¾ç¤ºä»·æ ¼:', displayPrice)
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å•†å“æ•°æ®ç»“æ„](./éœ€æ±‚æ–‡æ¡£.md#å•†å“æ•°æ®ç»“æ„)
- [ä»·æ ¼è®¡ç®—é€»è¾‘](./utils/price-helper.js)
- [è®¢å•æ˜¾ç¤ºé—®é¢˜æ’æŸ¥æŠ¥å‘Š](./è®¢å•æ˜¾ç¤ºé—®é¢˜å®Œæ•´æ’æŸ¥æŠ¥å‘Š.md)

---

## âš ï¸ é‡è¦æé†’

1. **æ–°å¢é¡µé¢æ—¶ï¼Œä¼˜å…ˆå‚è€ƒ `pages/home/index.js` çš„æ•°æ®å¤„ç†é€»è¾‘**
2. **ä¿®æ”¹æ•°æ®ç»“æ„åï¼Œå¿…é¡»åŒæ­¥æ‰€æœ‰ç›¸å…³é¡µé¢**
3. **é‡åˆ°æ˜¾ç¤ºé—®é¢˜ï¼Œå…ˆæ£€æŸ¥å­—æ®µåæ˜¯å¦æ­£ç¡®**
4. **ä»·æ ¼å¤„ç†åŠ¡å¿…ä½¿ç”¨å·¥å…·å‡½æ•°æˆ–å›é€€é€»è¾‘**
5. **æ·»åŠ æ–°åŠŸèƒ½åï¼Œåœ¨ä¸åŒé¡µé¢éƒ½æµ‹è¯•ä¸€é**

---

*æœ€åæ›´æ–°: 2025-10-27*
*ç»´æŠ¤äºº: AI Assistant*

