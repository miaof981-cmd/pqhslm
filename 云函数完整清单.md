# 云函数完整清单

> **已创建**：7个云函数  
> **覆盖**：所有核心业务模块  
> **状态**：待上传到云端

---

## 📦 云函数列表

### 1. userManager - 用户管理 ✅
**位置**：`cloudfunctions/userManager/`

**功能**：
- 用户登录/注册（自动创建用户）
- 获取用户信息
- 更新用户资料
- 检查管理员权限

**接口**：
```javascript
wx.cloud.callFunction({
  name: 'userManager',
  data: {
    action: 'login', // login | getUserInfo | updateUserInfo | checkAdmin
    nickName: '用户昵称',
    avatarUrl: '头像URL'
  }
})
```

---

### 2. productManager - 商品管理 ✅
**位置**：`cloudfunctions/productManager/`

**功能**：
- 获取商品列表（支持分页、筛选、排序）
- 获取商品详情
- 搜索商品（按名称/画师搜索）
- 获取分类列表
- 创建/更新/删除商品（管理员/画师）

**接口**：
```javascript
wx.cloud.callFunction({
  name: 'productManager',
  data: {
    action: 'getList', // getList | getDetail | search | getCategories | create | update | delete
    page: 1,
    pageSize: 10,
    category: '分类名',
    priceMin: 0,
    priceMax: 100
  }
})
```

---

### 3. orderManager - 订单管理 ✅
**位置**：`cloudfunctions/orderManager/`

**功能**：
- 创建订单（自动分配客服）
- 获取订单列表（支持多角色：买家/画师/客服/管理员）
- 获取订单详情
- 更新订单状态
- 更新订单信息

**接口**：
```javascript
wx.cloud.callFunction({
  name: 'orderManager',
  data: {
    action: 'create', // create | getList | getDetail | updateStatus | updateInfo
    productId: 'product_001',
    quantity: 1,
    totalAmount: 88.00
  }
})
```

---

### 4. artistManager - 画师申请管理 ✅
**位置**：`cloudfunctions/artistManager/`

**功能**：
- 提交画师申请
- 获取申请状态
- 批准/拒绝申请（管理员）
- 获取申请列表（管理员）

**接口**：
```javascript
wx.cloud.callFunction({
  name: 'artistManager',
  data: {
    action: 'apply', // apply | getStatus | approve | reject | getList
    artistName: '画师名称',
    portfolio: '作品集',
    introduction: '个人介绍'
  }
})
```

---

### 5. financeManager - 财务管理 ✅
**位置**：`cloudfunctions/financeManager/`

**功能**：
- 获取收入明细
- 创建提现申请
- 获取提现列表
- 批准/拒绝提现（管理员）
- 获取打赏记录

**接口**：
```javascript
wx.cloud.callFunction({
  name: 'financeManager',
  data: {
    action: 'getIncome', // getIncome | createWithdraw | getWithdrawList | approveWithdraw | rejectWithdraw | getRewardList
    page: 1,
    pageSize: 10
  }
})
```

---

### 6. contentManager - 内容管理 ✅
**位置**：`cloudfunctions/contentManager/`

**功能**：
- **轮播图**：获取/创建/更新/删除
- **公告**：获取/创建/更新/删除/详情
- **客服二维码**：获取/随机获取/创建/更新/删除
- **买家秀**：获取/创建/删除
- **分类**：获取/创建/更新/删除

**接口**：
```javascript
// 轮播图
wx.cloud.callFunction({
  name: 'contentManager',
  data: {
    module: 'banner',
    action: 'getList' // getList | create | update | delete
  }
})

// 公告
wx.cloud.callFunction({
  name: 'contentManager',
  data: {
    module: 'notice',
    action: 'getList' // getList | getDetail | create | update | delete
  }
})

// 客服二维码
wx.cloud.callFunction({
  name: 'contentManager',
  data: {
    module: 'serviceQRCode',
    action: 'getRandom' // getList | getRandom | create | update | delete
  }
})

// 买家秀
wx.cloud.callFunction({
  name: 'contentManager',
  data: {
    module: 'buyerShow',
    action: 'getList', // getList | create | delete
    page: 1
  }
})
```

---

### 7. statsManager - 统计数据 ✅
**位置**：`cloudfunctions/statsManager/`

**功能**：
- 仪表盘数据（管理员）
- 画师业绩统计（画师/管理员）
- 订单统计（管理员）
- 用户统计（管理员）

**接口**：
```javascript
// 仪表盘
wx.cloud.callFunction({
  name: 'statsManager',
  data: {
    action: 'dashboard' // 管理员专用
  }
})

// 画师业绩
wx.cloud.callFunction({
  name: 'statsManager',
  data: {
    action: 'artistPerformance',
    artistId: '1002', // 可选，不传则查询自己
    startDate: '2025-01-01 00:00:00',
    endDate: '2025-12-31 23:59:59'
  }
})

// 订单统计
wx.cloud.callFunction({
  name: 'statsManager',
  data: {
    action: 'orderStats',
    startDate: '2025-01-01 00:00:00',
    endDate: '2025-12-31 23:59:59',
    groupBy: 'day' // day | month
  }
})
```

---

## 🔐 权限说明

### 公开接口（无需特殊权限）
- 用户登录/注册
- 获取商品列表/详情/搜索
- 获取分类
- 获取轮播图
- 获取公告
- 获取客服二维码
- 获取买家秀

### 用户专属接口（需登录）
- 创建订单
- 查看自己的订单
- 更新自己的用户信息
- 提交画师申请
- 查看自己的收入
- 创建提现申请
- 发布买家秀

### 画师接口（需画师角色）
- 创建/更新自己的商品
- 查看画师订单
- 查看画师业绩

### 管理员接口（需管理员权限）
- 所有CRUD操作
- 审核画师申请
- 审核提现申请
- 查看所有统计数据
- 删除任意内容

---

## 📊 数据库集合对应关系

| 云函数 | 操作的集合 |
|--------|-----------|
| userManager | users, system_admin |
| productManager | products, categories |
| orderManager | orders |
| artistManager | artist_applications, users |
| financeManager | income_ledger, withdraw_records, reward_records |
| contentManager | banners, notices, service_qrcodes, buyer_shows, categories |
| statsManager | orders, users, income_ledger（只读） |

---

## 🚀 上传步骤

### 方式一：逐个上传
1. 右键 `cloudfunctions/userManager` → "上传并部署：云端安装依赖"
2. 等待完成
3. 重复上述步骤，依次上传其他6个

### 方式二：批量上传
1. 右键 `cloudfunctions` 文件夹
2. 选择"同步云函数列表"
3. 选择"上传所有云函数"

---

## ✅ 验证清单

上传完成后，在云开发控制台 → 云函数，应该看到：

- [  ] userManager
- [  ] productManager
- [  ] orderManager
- [  ] artistManager
- [  ] financeManager
- [  ] contentManager
- [  ] statsManager

---

## 🧪 快速测试

### 测试登录
```javascript
wx.cloud.callFunction({
  name: 'userManager',
  data: {
    action: 'login',
    nickName: '测试用户',
    avatarUrl: 'https://example.com/avatar.png'
  },
  success: res => console.log('登录结果:', res.result)
})
```

### 测试获取商品
```javascript
wx.cloud.callFunction({
  name: 'productManager',
  data: {
    action: 'getList',
    page: 1,
    pageSize: 10
  },
  success: res => console.log('商品列表:', res.result)
})
```

### 测试获取轮播图
```javascript
wx.cloud.callFunction({
  name: 'contentManager',
  data: {
    module: 'banner',
    action: 'getList'
  },
  success: res => console.log('轮播图:', res.result)
})
```

---

## ⏭️ 下一步

完成上传后回复："云函数上传完成"

