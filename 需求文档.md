# 画师商城小程序需求文档

## 项目概述

**项目名称**：画师商城小程序（MVP版本）  
**技术架构**：微信小程序 + 云开发  
**设计理念**：极简商城结构，满足画师上传商品、用户下单、会员续费、客服对接、后台管理五大核心功能  
**主色调**：清新绿色系（#A8E6CF、#D0F0C0、#E6FFEB）

---

## 一、角色与权限设计

### 1.1 角色定义
| 角色 | 权限说明 | 唯一标识 |
|------|----------|----------|
| **普通用户** | 浏览商品、联系客服、下单、查看订单 | openid |
| **画师** | 上传商品、编辑商品信息、查看自己订单、设置会员费、续缴会员周期、管理作品上传审核 | openid |
| **管理员** | 管理所有商品、画师、公告、客服二维码、会员状态、后台审核 | openid |

### 1.2 权限控制
- 所有用户身份通过 openid 唯一识别
- 角色权限通过数据库字段 `role` 控制
- 权限检查：customer < artist < admin

---

## 二、核心功能模块

### 2.1 首页模块 (/pages/home)

#### 功能描述
- 顶部轮播图展示区域
- 中部商品展示列表
- 底部公告滚动条
- 底部导航栏

#### 详细需求
**轮播图区域**：
- 后台可添加多张宣传图片
- 图片自动轮播，支持手动滑动
- 图片尺寸建议：750x300px

**商品展示**：
- 网格布局，每行2个商品
- 商品卡片包含：商品图 + 名称 + 价格 + 出稿时间
- 点击商品进入详情页
- 自动过滤会员已过期的画师商品

**公告滚动**：
- 横向滚动显示公告标题
- 点击公告标题查看详情
- 最多显示10条最新公告

**底部导航**：
- 【首页】｜【画师申请】｜【我的】

### 2.2 商品详情页 (/pages/product-detail)

#### 功能描述
- 商品详细信息展示
- 智能客服二维码显示
- 购买功能

#### 详细需求
**商品信息**：
- 商品图片轮播（支持多图）
- 商品名称、价格、出稿时间
- 画师名称（点击可查看画师主页）

**客服二维码逻辑**：
- **未下单状态**：右下角悬浮按钮，点击显示随机客服二维码
- **已下单状态**：显示该订单绑定的专属客服二维码
- 二维码来源：后台设置的客服二维码池

**购买流程**：
- 点击"立即购买"创建订单
- 自动计算截稿日期：下单时间 + 出稿时间
- 随机分配客服二维码并绑定到订单

### 2.3 画师申请页 (/pages/apply)

#### 功能描述
- 画师资格申请表单
- 作品上传功能
- 申请状态跟踪

#### 详细需求
**申请表单**：
- 姓名（必填）
- 联系方式（必填）
- 擅长类型（选填）
- 作品图片上传（必填，最多9张）

**作品上传**：
- 支持相册选择和拍照
- 图片压缩上传到云存储
- 支持删除已上传图片

**申请流程**：
- 提交后状态为"待审核"
- 管理员后台审核通过后自动获得画师权限
- 防止重复申请

### 2.4 画师工作台 (/pages/artist-dashboard)

#### 功能描述
- 商品管理
- 订单管理
- 会员管理

#### 详细需求
**商品管理**：
- 我的商品列表
- 添加新商品（图片 + 名称 + 出稿时间 + 价格）
- 编辑商品信息
- 商品状态：上架/下架（会员到期自动下架）

**订单管理**：
- 查看自己商品的订单列表
- 订单信息：下单时间、截稿日期、客户信息、订单状态
- 截稿日期自动计算：下单时间 + 出稿时间

**会员管理**：
- 会员状态显示（有效/过期/未开通）
- 会员费缴纳：输入金额 + 备注 + 选择周期（1/3/6个月）
- 自动计算到期日期：当前日期 + 周期
- 到期提醒和自动下架逻辑

### 2.5 管理后台 (/pages/admin)

#### 功能描述
- 画师管理
- 公告管理
- 客服管理
- 轮播图管理

#### 详细需求
**画师管理**：
- 查看全部画师资料
- 审核画师申请（通过/驳回）
- 修改画师会员状态和到期时间
- 画师作品审核

**公告管理**：
- 添加公告（标题 + 正文）
- 公告列表管理
- 公告状态控制（发布/下架）

**客服管理**：
- 添加多个客服二维码
- 二维码状态管理（启用/禁用）
- 二维码使用统计

**轮播图管理**：
- 上传/删除首页轮播图
- 轮播图排序
- 轮播图状态控制

### 2.6 公告详情页 (/pages/notice-detail)

#### 功能描述
- 公告全文内容展示
- 发布时间显示

### 2.7 我的页面 (/pages/user-center)

#### 功能描述
- 用户信息展示
- 订单管理
- 角色切换入口

#### 详细需求
**用户信息**：
- 显示当前用户角色
- 会员状态（如果是画师）

**订单管理**：
- 我的订单列表
- 订单详情查看
- 专属客服二维码显示

**角色切换**：
- 画师：进入工作台
- 管理员：进入后台管理
- 普通用户：申请成为画师

---

## 三、数据库设计

### 3.1 集合结构

#### users（用户表）
```javascript
{
  _id: "用户ID",
  openid: "微信openid",
  role: "customer|artist|admin",
  name: "用户姓名",
  phone: "联系方式",
  avatar: "头像URL",
  createTime: "创建时间",
  updateTime: "更新时间"
}
```

#### products（商品表）
```javascript
{
  _id: "商品ID",
  artistId: "画师openid",
  name: "商品名称",
  price: "价格",
  images: ["图片URL数组"],
  deliveryDays: "出稿天数",
  status: "active|inactive",
  createTime: "创建时间",
  updateTime: "更新时间"
}
```

#### orders（订单表）
```javascript
{
  _id: "订单ID",
  buyerId: "买家openid",
  productId: "商品ID",
  artistId: "画师openid",
  price: "订单金额",
  status: "created|processing|completed|cancelled",
  createTime: "下单时间",
  deadline: "截稿日期",
  serviceQR: "分配的客服二维码URL",
  remark: "备注"
}
```

#### members（会员表）
```javascript
{
  _id: "会员记录ID",
  artistId: "画师openid",
  amount: "会员费金额",
  remark: "备注",
  startDate: "开始日期",
  endDate: "结束日期",
  months: "月数",
  createTime: "创建时间"
}
```

#### notices（公告表）
```javascript
{
  _id: "公告ID",
  title: "公告标题",
  content: "公告内容",
  status: "active|inactive",
  createTime: "创建时间",
  updateTime: "更新时间"
}
```

#### serviceQR（客服二维码表）
```javascript
{
  _id: "二维码ID",
  imageUrl: "二维码图片URL",
  title: "客服名称",
  isActive: "是否启用",
  assignedCount: "分配次数",
  createTime: "创建时间"
}
```

#### banners（轮播图表）
```javascript
{
  _id: "轮播图ID",
  imageUrl: "图片URL",
  title: "图片标题",
  isActive: "是否启用",
  sort: "排序",
  createTime: "创建时间"
}
```

#### applications（申请表）
```javascript
{
  _id: "申请ID",
  openid: "申请人openid",
  name: "姓名",
  phone: "联系方式",
  specialty: "擅长类型",
  portfolio: ["作品图片URL数组"],
  status: "pending|approved|rejected",
  createTime: "申请时间",
  reviewTime: "审核时间",
  reviewerId: "审核人openid"
}
```

### 3.2 数据库权限设置
- 所有集合设置为"仅创建者可读写"
- 管理员通过云函数进行数据操作
- 用户只能操作自己的数据

---

## 四、自动计算逻辑

### 4.1 截稿日期计算
```javascript
// 下单时自动计算
deadline = createTime + deliveryDays * 24 * 60 * 60 * 1000
```

### 4.2 会员状态检查
```javascript
// 商品展示时过滤
if (today > member.endDate) {
  product.status = "inactive" // 自动下架
}
```

### 4.3 客服二维码分配
```javascript
// 下单时随机分配
if (order not exist) {
  show random(serviceQR where isActive = true)
} else {
  show order.serviceQR // 显示订单绑定的二维码
}
```

---

## 五、界面设计规范

### 5.1 色彩规范
- **主色调**：#A8E6CF（薄荷绿）
- **辅助色**：#D0F0C0（淡青）、#E6FFEB（浅绿）
- **文字色**：#2C3E50（深灰）
- **边框色**：#D0F0C0（淡青）

### 5.2 组件规范
- **按钮**：圆角25rpx，主色调背景
- **卡片**：圆角20rpx，白色背景，轻微阴影
- **输入框**：圆角15rpx，淡青边框
- **状态标签**：圆角20rpx，对应颜色背景

### 5.3 字体规范
- **主字体**：PingFang SC Regular
- **标题**：32-36rpx，加粗
- **正文**：28rpx
- **辅助文字**：24rpx

---

## 六、技术实现要点

### 6.1 云开发配置
- 环境ID配置
- 云函数部署
- 云存储权限设置
- 数据库权限配置

### 6.2 图片处理
- 商品图片压缩上传
- 轮播图尺寸规范
- 二维码图片管理
- 作品集图片展示

### 6.3 权限控制
- 页面级权限检查
- 数据操作权限验证
- 角色切换逻辑
- 管理员权限管理

### 6.4 性能优化
- 图片懒加载
- 数据分页加载
- 缓存策略
- 网络请求优化

---

## 七、开发计划

### 阶段一：基础框架（已完成）
- ✅ 项目结构搭建
- ✅ 云开发环境配置
- ✅ 基础页面框架
- ✅ 数据库设计

### 阶段二：核心功能
- 🔄 管理后台实现
- 🔄 我的页面实现
- 🔄 公告详情页
- 🔄 商品编辑页

### 阶段三：完善功能
- ⏳ 会员续费流程
- ⏳ 图片上传优化
- ⏳ 权限控制完善
- ⏳ 自动计算逻辑

### 阶段四：测试优化
- ⏳ 功能测试
- ⏳ 性能优化
- ⏳ 用户体验优化
- ⏳ 部署上线

---

## 八、验收标准

### 8.1 功能验收
- 所有角色权限正确控制
- 商品上传、编辑、展示正常
- 订单创建、查看、管理正常
- 会员管理、续费流程完整
- 客服二维码分配逻辑正确

### 8.2 性能验收
- 页面加载时间 < 3秒
- 图片上传成功率 > 95%
- 数据查询响应时间 < 1秒
- 小程序包大小 < 2MB

### 8.3 用户体验验收
- 界面美观，符合设计规范
- 操作流程简单直观
- 错误提示友好明确
- 响应式布局适配不同设备

