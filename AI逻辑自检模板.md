# AI前端逻辑自检模板·妙妙专用

## 🎯 使用说明

### 何时使用
- ✅ 开发任何新功能前
- ✅ 修复 Bug 前
- ✅ 重构代码前
- ✅ 用户报告数据不一致时
- ✅ 提交代码前

### 如何使用
1. 在对话开始时说：**"请先执行逻辑自检模板"**
2. AI 会自动生成检查报告
3. 只有通过检查后，AI 才会输出代码
4. 如果发现问题，AI 会先修复再输出

---

## 🧠 系统任务：逻辑闭环自检模板 v2.1

在输出任何前端代码（含 WXML / WXSS / JS / JSON）前，请自动执行以下检查：

---

## 🧭 一、功能闭环验证

对每一个交互功能，逐条检查：

1. ✅ 是否存在明确的**输入源**（用户操作/表单/按钮）
2. ✅ 是否有对应的**逻辑函数**（事件处理函数）
3. ✅ 是否有**状态更新**（setData / setState）
4. ✅ 是否有**结果展示或反馈**（页面更新 / Toast / 提示）

### 输出表格模板：

| 功能 | 输入 | 逻辑函数 | 状态更新 | 结果展示 | 是否闭环 |
|------|------|----------|----------|----------|----------|
| 上传商品 | 点击按钮 | addProduct() | setData({products}) | 跳转编辑页 | ✅ |
| 编辑商品 | 点击保存 | saveProduct() | setData({product}) | 无提示 | ⚠️ |
| 删除商品 | 点击删除 | deleteProduct() | 无 | 无 | ❌ |

---

## 📊 二、数据流一致性检查

对所有涉及数据的部分进行字段比对，确保：
- ✅ **读取端**和**写入端**字段名一致
- ✅ **页面A**和**页面B**对同一数据的字段名一致
- ✅ 关键数据（价格、标题、图片）来源正确
- ✅ 数据转换逻辑正确（如 basePrice vs price）

### 输出表格模板：

| 数据项 | 写入端字段 | 读取端字段 | 数据来源 | 转换逻辑 | 状态 |
|--------|-----------|-----------|----------|----------|------|
| 商品价格 | basePrice | price | product-edit | price = basePrice | ⚠️ |
| 商品名称 | name | name | product-edit | 无转换 | ✅ |
| 商品图片 | images[0] | image | product-edit | image = images[0] | ✅ |

### 重点检查项：
1. **存储数据结构** vs **读取数据结构**
2. **商品编辑页保存的字段** vs **商品列表页读取的字段**
3. **商品列表页显示的字段** vs **商品详情页显示的字段**

---

## 🧩 三、页面结构检查

检查：
- ✅ 所有 `<button>` 是否绑定事件
- ✅ 所有 `<input>` 是否有双向绑定
- ✅ 所有 `wx:for` 是否设置唯一 `wx:key`
- ✅ 所有必要数据是否初始化
- ✅ 所有条件渲染 `wx:if` 的数据是否存在

### 输出表格模板：

| 元素 | 问题 | 严重程度 | 修复建议 |
|------|------|----------|----------|
| 上传按钮 | 未绑定事件 | ⚠️ 中 | 添加 bindtap="addProduct" |
| 列表循环 | 未设置 key | ⚠️ 中 | 添加 wx:key="id" |
| 价格显示 | 数据 undefined | ❌ 高 | 确认字段名 |

---

## 🧮 四、错误处理与状态反馈

检查：
- ✅ 所有异步操作是否有错误处理
- ✅ 是否设置加载中提示 / 错误提示
- ✅ 是否在失败时能恢复状态
- ✅ 用户操作是否有明确反馈（Toast / Modal）

### 输出表格模板：

| 操作 | 异常处理 | 用户提示 | 建议 |
|------|----------|----------|------|
| 上传商品 | 无 catch | 无反馈 | 添加错误提示 Toast |
| 获取商品列表 | 有 catch | 有提示 | ✅ 合格 |
| 保存商品 | 有 catch | 无成功提示 | ⚠️ 添加成功提示 |

---

## 🔍 五、数据类型与格式检查

检查：
- ✅ 价格是 `Number` 还是 `String`
- ✅ 数组是否初始化为 `[]`
- ✅ 对象是否初始化为 `{}`
- ✅ 布尔值是否正确使用
- ✅ 日期格式是否统一

### 输出表格模板：

| 字段 | 期望类型 | 实际类型 | 转换逻辑 | 状态 |
|------|----------|----------|----------|------|
| price | Number | String | parseFloat() | ⚠️ 需转换 |
| images | Array | Array | 无需转换 | ✅ |
| isOnSale | Boolean | undefined | 默认 true | ⚠️ 需默认值 |

---

## 🧠 六、生成自动报告

### 输出格式：

```
🧾 自动逻辑闭环报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✔️ 检查页面：商品上传页
✔️ 检查时间：2025-01-XX XX:XX

📊 检查结果：
✅ 功能闭环：2/3 已完成
⚠️ 数据一致性：1 项命名不符
❌ 异常处理：1 项缺失

🔍 发现问题：
1. ❌ 商品价格字段不一致
   - 写入端：basePrice (String)
   - 读取端：price (Number)
   - 影响：首页显示价格为 0
   
2. ⚠️ 保存商品后无成功提示
   - 位置：product-edit/index.js saveProduct()
   - 建议：添加 wx.showToast

🧩 优化建议：
- 统一价格字段命名和类型
- 添加保存成功提示
- 完善错误处理机制

✅ 逻辑闭环度：67%

⚠️ 建议：修复 ❌ 项后再输出代码
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## ⚙️ 输出规则

1. ✅ 若检测到 ❌ 项，**必须先修复再输出代码**
2. ✅ 输出顺序固定为：**先报告 → 后代码**
3. ✅ 报告必须包含结尾总结句：
   > "本次逻辑闭环度 XX%，建议复测以下模块：XXX。"
4. ✅ 所有建议需**简明具体**，可直接执行

---

## 🔒 终止条件

仅当满足以下条件之一时，方可输出最终代码：
- ✅ 所有模块通过逻辑检查（闭环度 ≥ 90%）
- ✅ 仅存在轻微 ⚠️ 项（不影响核心功能）
- ✅ 已明确告知用户存在的问题和风险

---

## 💬 使用语句（推荐）

### 方式一：对话开始时
```
你是我的代码逻辑审查官，负责在输出任何代码前执行逻辑闭环自检模板 v2.1。
输出顺序：先报告 → 后代码。
每次修改必须包含自动报告表。
```

### 方式二：功能开发前
```
请先执行逻辑自检模板，检查【商品价格显示】功能的数据流一致性。
```

### 方式三：Bug 修复前
```
用户反馈价格显示不一致，请用逻辑自检模板排查问题。
```

---

## 📋 快速检查清单

在每次代码提交前，快速过一遍：

### 数据流检查
- [ ] 写入端和读取端字段名一致？
- [ ] 数据类型转换正确？
- [ ] 默认值设置合理？

### 功能闭环检查
- [ ] 用户操作有反馈？
- [ ] 异常情况有处理？
- [ ] 状态更新正确？

### 页面结构检查
- [ ] 所有按钮有事件？
- [ ] 所有循环有 key？
- [ ] 所有数据有初始化？

---

## 🎯 典型问题案例

### 案例1：价格显示不一致

**问题**：
- 商品管理页显示 ¥10
- 首页显示 ¥0

**自检发现**：
| 数据项 | 写入端 | 读取端 | 转换逻辑 | 状态 |
|--------|--------|--------|----------|------|
| 价格 | basePrice (String "10") | price (Number) | parseFloat(basePrice) &#124;&#124; 0 | ❌ |

**问题根源**：
- 商品编辑页保存为 `basePrice`
- 首页读取 `basePrice`，但如果有规格，计算逻辑错误
- 规格价格逻辑理解错误（一级是基础价格，二级是加价）

**修复方案**：
1. 统一价格字段逻辑
2. 修正规格价格计算
3. 添加调试日志

---

## 💡 模式说明

- **目标**：让 AI 拥有自测与逻辑验证能力
- **输出**：必须结构化、可读
- **角色**：妙妙是产品负责人，需要清晰问题点
- **建议**：需简明具体，可直接执行

---

## 🔄 版本记录

- **v2.1** (2025-01-27)
  - 新增数据类型与格式检查
  - 优化报告输出格式
  - 添加典型问题案例
  - 增强数据流一致性检查

- **v2.0** (2025-01-27)
  - 初始版本
  - 基于妙妙提供的模板创建

---

## 📞 反馈与改进

如果发现模板不适用或需要改进的地方，请随时告诉我：
- 哪些检查项不够用？
- 哪些检查项太繁琐？
- 需要增加什么新的检查维度？

我会持续优化这个模板，让它更适合我们的项目！

