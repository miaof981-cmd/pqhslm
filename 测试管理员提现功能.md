# æµ‹è¯•ç®¡ç†å‘˜æç°åŠŸèƒ½

## æµ‹è¯•æ­¥éª¤

### 1ï¸âƒ£ åˆ›å»ºæµ‹è¯•ç®¡ç†å‘˜
åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç®¡ç†å‘˜
const staffFinance = require('/utils/staff-finance.js')
const testStaff = {
  name: 'æµ‹è¯•ç®¡ç†å‘˜',
  role: 'è§†é¢‘ä¸“å‘˜',
  userId: '1001',  // ä½¿ç”¨å½“å‰ç™»å½•ç”¨æˆ·ID
  enableShare: true,
  shareAmount: 5,
  isActive: true
}

staffFinance.upsertStaff(testStaff)
console.log('âœ… æµ‹è¯•ç®¡ç†å‘˜å·²åˆ›å»º')

// æŸ¥çœ‹åˆ›å»ºç»“æœ
const staffList = staffFinance.getStaffList()
console.log('ç®¡ç†å‘˜åˆ—è¡¨:', staffList)
```

### 2ï¸âƒ£ æ£€æŸ¥ä¸ªäººä¸­å¿ƒ
1. è¿›å…¥"æˆ‘çš„"é¡µé¢
2. åº”è¯¥åœ¨"å…¶ä»–åŠŸèƒ½"åŒºåŸŸçœ‹åˆ°ä¸€ä¸ªç»¿è‰²çš„"ğŸ’° æç°"æŒ‰é’®
3. å¦‚æœæœ‰åˆ†æˆä½™é¢ï¼Œä¼šæ˜¾ç¤ºé‡‘é¢å¾½ç« ï¼ˆçº¢è‰²ï¼‰

### 3ï¸âƒ£ åˆ›å»ºæµ‹è¯•è®¢å•å¹¶åˆ†æˆ
åœ¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// åˆ›å»ºä¸€ä¸ªæµ‹è¯•è®¢å•
const testOrder = {
  id: `test_${Date.now()}`,
  fullOrderNo: `TEST${Date.now()}`,
  productId: 'product_test',
  productName: 'æµ‹è¯•å•†å“',
  artistId: '1001',
  status: 'completed',
  completedAt: new Date().toISOString()
}

// ä¿å­˜è®¢å•
const orders = wx.getStorageSync('orders') || []
orders.push(testOrder)
wx.setStorageSync('orders', orders)

// è®°å½•åˆ†æˆ
const staffFinance = require('/utils/staff-finance.js')
staffFinance.recordOrderShare(testOrder)

console.log('âœ… æµ‹è¯•è®¢å•å·²åˆ›å»ºå¹¶è®°å½•åˆ†æˆ')
```

### 4ï¸âƒ£ åˆ·æ–°ä¸ªäººä¸­å¿ƒ
1. é€€å‡ºå¹¶é‡æ–°è¿›å…¥"æˆ‘çš„"é¡µé¢
2. "æç°"æŒ‰é’®åº”è¯¥æ˜¾ç¤ºä½™é¢å¾½ç«  `Â¥5.00`
3. ç‚¹å‡»"æç°"æŒ‰é’®ï¼Œåº”è¯¥è·³è½¬åˆ°æç°é¡µé¢

### 5ï¸âƒ£ æ£€æŸ¥æç°é¡µé¢
1. åº”è¯¥çœ‹åˆ°"å¯æç°é‡‘é¢ï¼šÂ¥5.00"
2. åœ¨"è®¢å•åˆ†æˆ"ä¸€æ åº”è¯¥æ˜¾ç¤º `Â¥5.00`
3. ç‚¹å‡»"æŸ¥çœ‹æ”¶å…¥æ˜ç»†"ï¼Œåº”è¯¥èƒ½çœ‹åˆ°åˆ†æˆè®°å½•

---

## æ’æŸ¥é—®é¢˜

### é—®é¢˜1ï¼šæ²¡æœ‰æ˜¾ç¤ºæç°æŒ‰é’®
```javascript
// æ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€
const userId = wx.getStorageSync('userId')
console.log('å½“å‰ç”¨æˆ·ID:', userId)

const staffFinance = require('/utils/staff-finance.js')
const staffList = staffFinance.getStaffList()
const staff = staffList.find(s => String(s.userId) === String(userId))

console.log('ç®¡ç†å‘˜ä¿¡æ¯:', staff)
console.log('æ˜¯å¦æœ‰æ•ˆ:', staff && staff.isActive !== false)
```

### é—®é¢˜2ï¼šä½™é¢è®¡ç®—ä¸å¯¹
```javascript
// æ£€æŸ¥åˆ†æˆè®°å½•
const userId = wx.getStorageSync('userId')
const staffFinance = require('/utils/staff-finance.js')

const ledger = staffFinance.getLedgerByUserId(userId)
console.log('åˆ†æˆè®°å½•:', ledger)

const balance = staffFinance.computeIncomeByUserId(userId)
console.log('åˆ†æˆæ€»é¢:', balance)

const withdrawRecords = wx.getStorageSync('withdraw_records') || []
const withdrawn = withdrawRecords
  .filter(r => String(r.userId) === String(userId) && r.status === 'success')
  .reduce((sum, r) => sum + (parseFloat(r.amount) || 0), 0)

console.log('å·²æç°:', withdrawn)
console.log('å¯æç°ä½™é¢:', balance - withdrawn)
```

---

## æ¸…ç†æµ‹è¯•æ•°æ®
æµ‹è¯•å®Œæˆåï¼Œåœ¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// åˆ é™¤æµ‹è¯•ç®¡ç†å‘˜
const staffFinance = require('/utils/staff-finance.js')
const staffList = staffFinance.getStaffList()
const testStaff = staffList.find(s => s.name === 'æµ‹è¯•ç®¡ç†å‘˜')
if (testStaff) {
  staffFinance.removeStaff(testStaff._id)
  console.log('âœ… æµ‹è¯•ç®¡ç†å‘˜å·²åˆ é™¤')
}

// åˆ é™¤æµ‹è¯•è®¢å•
const orders = wx.getStorageSync('orders') || []
const cleanedOrders = orders.filter(o => !o.id.startsWith('test_'))
wx.setStorageSync('orders', cleanedOrders)

// åˆ é™¤æµ‹è¯•åˆ†æˆè®°å½•
wx.removeStorageSync('staff_finance_records')

console.log('âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç†')
```
