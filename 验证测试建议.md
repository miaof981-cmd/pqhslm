# 修复验证与测试建议

以下内容基于当前代码库的静态检查结果，供人工测试同事在微信小程序端进行验证时参考。每个 BUG 均包含代码侧验证要点与建议的手工测试动作。若某些功能涉及多端或多个角色，请按建议在对应身份下测试。

## 首页模块（普通用户身份）

### BUG-001：商品图片显示变形
- **代码验证**：商品列表与推荐区的商品图片均使用 `mode="aspectFill"`，并移除了 `object-fit` 相关样式，保证容器为正方形且不拉伸原图。【F:miniprogram/pages/home/index.wxml†L40-L48】【F:miniprogram/pages/home/index.wxss†L440-L457】
- **建议测试**：在首页上传正方形、横向、纵向图片，确认缩略图保持比例、居中裁剪，无明显拉伸；可多次刷新观察是否稳定。

### BUG-002：商品图片可点击放大预览
- **代码验证**：商品详情页轮播图绑定 `bindtap="previewImages"`，JS 中调用 `wx.previewImage` 预览全部图片数组。【F:miniprogram/pages/product-detail/index.wxml†L8-L21】【F:miniprogram/pages/product-detail/index.js†L715-L731】
- **建议测试**：进入任意商品详情，点击轮播图片进入全屏预览，左右滑动与长按保存是否正常，返回后轮播是否继续播放。

### BUG-003：搜索栏无法点击
- **代码验证**：首页搜索框使用 `hover-class` 提供点击态，并在 `onSearch` 中调用 `wx.navigateTo('/pages/search/index')`，失败时弹 Toast 提示；搜索页读取与保存历史记录，支持再次进入继续使用。【F:miniprogram/pages/home/index.wxml†L22-L31】【F:miniprogram/pages/home/index.js†L326-L338】【F:miniprogram/pages/search/index.js†L16-L132】
- **建议测试**：点击首页搜索框检查跳转及点击反馈；在搜索页输入关键字、确认后返回，再次进入是否保留历史记录；尝试清空历史记录。

### BUG-004：客服二维码弹窗不显示
- **代码验证**：商品详情页进入时会调用 `loadServiceQR`，从多个缓存键读取客服信息，若无二维码仍会弹出并显示“未配置”提示。【F:miniprogram/pages/product-detail/index.js†L262-L320】【F:miniprogram/pages/product-detail/index.wxml†L128-L147】
- **建议测试**：在配置和不配置客服二维码两种情况下点击“客服”按钮，分别观察弹窗展示二维码或提示文字；再次打开应维持相同状态。

### BUG-005：商品分类始终显示
- **代码验证**：商品详情基础信息中“分类”行常驻，未设置分类时显示“未分类”。【F:miniprogram/pages/product-detail/index.wxml†L44-L60】
- **建议测试**：分别查看有分类与无分类商品，确认文案正确显示。

### BUG-006：画师页面跳转优化
- **代码验证**：画师信息行整行可点击，`viewArtist` 会校验画师对象和 ID，缺失时弹 Toast。“›” 箭头仅在存在 ID 时显示。【F:miniprogram/pages/product-detail/index.wxml†L55-L58】【F:miniprogram/pages/product-detail/index.js†L734-L760】
- **建议测试**：在有关联画师与未关联画师的商品中分别点击画师行，确认能正常跳转或提示“未关联”。

### BUG-007：订单完成后销量同步
- **代码验证**：订单详情确认完成时调用 `productSales.updateProductSales`，销量会同步写回 `mock_products`。工具函数同时支持单个订单与多商品批量更新。【F:miniprogram/pages/order-detail/index.js†L521-L599】【F:miniprogram/utils/product-sales.js†L12-L94】
- **建议测试**：记录首页某商品销量，下单并在订单详情完成订单后回到首页，检查销量数值是否增加并在刷新后保持。

## 个人名片模块

### BUG-008：昵称修改入口不明显
- **代码验证**：昵称下方按钮采用白色描边与半透明背景，并在按压时缩放，提升视觉权重；`editNickname` 使用可编辑弹框保存昵称到本地并刷新 UI。【F:miniprogram/pages/user-center/index.wxss†L776-L793】【F:miniprogram/pages/user-center/index.js†L285-L313】
- **建议测试**：在“我的”页面观察按钮视觉效果，点击后尝试修改昵称并确认页面即时更新。

### BUG-009：授权失败保留用户信息
- **代码验证**：授权前备份 `userInfo`，失败时恢复缓存并提示“取消授权，信息已保留”。【F:miniprogram/pages/user-center/index.js†L332-L351】【F:miniprogram/pages/user-center/index.js†L340-L352】
- **建议测试**：在游客状态下触发头像授权并拒绝，确认昵称头像保持原状；再次授权并允许后应能更新。

## 我的约稿模块

### BUG-010：订单详情客服二维码
- **代码验证**：`loadServiceQRCode` 会依次检查订单字段与客服列表，找到后写入展示；WXML 中若仍为空则显示“加载中”占位。【F:miniprogram/pages/order-detail/index.js†L110-L155】【F:miniprogram/pages/order-detail/index.wxml†L158-L166】
- **建议测试**：打开不同订单，确认弹窗或页面区域能展示二维码；尝试长按识别/保存。

### BUG-011：多商品订单展示
- **代码验证**：若订单包含 `items` 数组，会逐项展示图片、规格、金额，并在底部显示“订单总计”。【F:miniprogram/pages/order-detail/index.wxml†L60-L88】
- **建议测试**：创建包含多件商品的订单，在详情页检查列表是否完整且金额正确累加。

### BUG-012：“其他”功能点击反馈
- **代码验证**：个人中心“其他”区的按钮增加缩放与背景变色点击态。【F:miniprogram/pages/user-center/index.wxss†L776-L793】
- **建议测试**：依次点击“平台售后”“我的买家秀”“打赏”，确认按钮缩放反馈明显，功能可进入或弹窗正常。

### BUG-013：申请退款入口
- **代码验证**：订单详情在进行中状态下展示“申请退款”按钮，确认后将状态标记为 `requesting` 并保存，弹出成功提示。【F:miniprogram/pages/order-detail/index.wxml†L200-L206】【F:miniprogram/pages/order-detail/index.js†L392-L453】
- **建议测试**：对制作中的订单点击申请退款，观察确认弹窗、成功提示以及页面刷新后的状态标签。

### BUG-014：评价状态持久化
- **代码验证**：提交评价后会同步更新 `orders`、`pending_orders`、`completed_orders` 三个存储，标记 `reviewed` 并刷新列表。【F:miniprogram/pages/order-list/index.js†L566-L623】
- **建议测试**：对已完成订单点击“评价”，确认提交后按钮变为“已评价”，重新进入页面保持状态。

### BUG-015：红点实时更新
- **代码验证**：个人中心 `onShow` 与 `loadData` 时都会调用 `loadOrders`，根据多种进行中状态计算红点数量并缓存到用户专属键值。【F:miniprogram/pages/user-center/index.js†L39-L83】【F:miniprogram/pages/user-center/index.js†L427-L468】
- **建议测试**：在用户身份新建或完成订单后返回“我的”页面，观察“制作中”数字是否立刻更新；切换身份再返回确认数值保持。

## 画师工作台模块

### BUG-016：分类选项更新
- **代码验证**：商品编辑页默认分类已替换为 Q 版头像、半身像、全身像、场景插画等橱窗类型。【F:miniprogram/pages/product-edit/index.js†L4-L14】
- **建议测试**：以画师身份新建商品时检查分类下拉的前 4 个选项是否符合需求，选择后回到首页确认分类展示正确。

### BUG-017：草稿保存提示优化
- **代码验证**：草稿保存使用防抖定时器静默写入本地，不再弹出 Toast；失败时仅输出日志。【F:miniprogram/pages/product-edit/index.js†L444-L517】
- **建议测试**：在商品编辑流程中暂停操作或返回再进入，确认草稿自动恢复，无频繁提示弹窗。

### BUG-018：多规格数据保留
- **代码验证**：重新选择“规格定价”时若已有一级规格数据，仅切换标记不清空；需要时可通过“重置规格”按钮手动清除。【F:miniprogram/pages/product-edit/index.js†L870-L939】
- **建议测试**：先配置一级规格，返回上一步再点击“开始设置规格”，确认原有规格仍在；通过“重置”按钮验证清空逻辑。

### BUG-019/020：多规格验证逻辑完善
- **代码验证**：`hasValidSpecPrices`、`updatePricePreview` 与 `calculateFinalPrice` 支持单级与双级规格组合，并保证最低价≥¥9.9。【F:miniprogram/pages/product-edit/index.js†L320-L378】【F:miniprogram/pages/product-edit/index.js†L1164-L1199】【F:miniprogram/pages/product-edit/index.js†L1403-L1458】
- **建议测试**：分别设置仅一级、一级+二级规格，确认价格预览表正确生成；尝试输入低于 9.9 的价格应提示不可保存。

## 客服工作台模块

### BUG-021：联系客户信息完善
- **代码验证**：点击“联系客户”会弹出包含客户名与订单号的提示，并支持跳转至订单详情查看；提示中说明复制群名的方式。【F:miniprogram/pages/service-workspace/index.js†L381-L401】
- **建议测试**：在客服工作台列表点击“联系客户”，检查弹窗信息是否完整，并尝试跳转订单详情。

### BUG-022：退款流程防重复
- **代码验证**：退款按钮增加 `refunding` 防抖标记与二次确认，执行后更新订单状态为 `refunded` 并记录退款历史。【F:miniprogram/pages/service-workspace/index.js†L403-L499】
- **建议测试**：对同一订单快速连点“处理退款”，确认只触发一次；退款成功后按钮消失且状态更新。

### BUG-023：仅支持全额退款
- **说明**：当前版本仅允许全额退款，金额自动读取订单价格，无需额外测试输入。

### BUG-024：退款状态同步
- **代码验证**：`doRefund` 写回 `orders` 与 `pending_orders`，标记状态与时间戳，并在 500ms 后刷新列表。【F:miniprogram/pages/service-workspace/index.js†L460-L498】
- **建议测试**：退款成功后刷新客服、画师、用户端订单，确认状态均为“已退款”，不再显示在进行中列表。

### BUG-025：订单复制功能
- **代码验证**：管理后台订单卡片保留两个复制图标：绿色复制订单号、蓝色复制群名。【F:miniprogram/pages/admin/index.wxml†L318-L323】
- **建议测试**：在“全部订单”列表分别点击两种图标，确认提示文案正确，并可粘贴验证内容。

### BUG-026：统计与提现功能
- **代码验证**：客服统计页加载待办、订单、快捷统计；提现页整合订单、打赏、客服与管理员分成，并检查实名认证后才允许提现操作。【F:miniprogram/pages/service-dashboard/index.js†L21-L145】【F:miniprogram/pages/withdraw/index.js†L40-L200】
- **建议测试**：进入统计页切换不同标签，确认数据刷新；在提现页查看余额明细，尝试未实名和已实名两种情况的提现流程。

## 管理后台模块

### BUG-027：客服管理支持多人
- **代码验证**：客服管理列表通过 `staffFinance.getStaffList()` 加载全部人员，新增时仅校验重复 ID，并无数量限制。【F:miniprogram/pages/staff-manage/index.js†L39-L168】
- **建议测试**：在“客服管理”连续添加多位客服，确认列表可正常展示，且可单独编辑/删除。

### BUG-028：仪表盘数据按时间刷新
- **代码验证**：仪表盘通过 `filterOrdersByTime` 根据今日/昨日/本周/本月筛选订单，数据变化后更新统计与待办数。【F:miniprogram/pages/admin/index.js†L150-L231】【F:miniprogram/pages/admin/index.js†L233-L259】
- **建议测试**：切换时间筛选项，观察订单数与收入是否随之变化；完成订单后再次进入仪表盘，确认数据更新。

### BUG-029：画师昵称显示优先级
- **代码验证**：商品列表中的画师名称依次读取申请记录、用户信息、商品字段，并过滤英文默认值，最后回退为“画师+ID”。【F:miniprogram/pages/admin/index.js†L331-L366】
- **建议测试**：检查存在中文昵称、仅有英文默认值以及完全缺失昵称的商品，确认显示符合预期。

### BUG-030：订单筛选保持状态
- **代码验证**：加载订单后调用 `applyCurrentOrderFilter`，并在 `filterOrders` 中记录当前筛选值，刷新后仍按选择的标签展示。【F:miniprogram/pages/admin/index.js†L503-L545】【F:miniprogram/pages/admin/index.js†L759-L777】
- **建议测试**：切换到“制作中”或“退款中”后刷新页面或返回再进入，确认仍停留在原筛选项。

### BUG-031：画师审核入口
- **代码验证**：仪表盘“待办事项”中提供“画师审核”入口，点击后跳转到 `review-manage` 页；审核页支持通过、驳回、搜索与话术管理。【F:miniprogram/pages/admin/index.wxml†L140-L169】【F:miniprogram/pages/admin/index.js†L956-L961】【F:miniprogram/pages/review-manage/index.js†L1-L200】
- **建议测试**：在仪表盘点击“画师审核”，确认可进入审核列表并对申请执行通过/驳回操作。

---

## 综合建议
1. 建议测试同事按照角色（普通用户/画师/客服/管理员）分别登录，逐一执行上述验证动作。
2. 涉及状态同步的功能（销量、红点、退款）建议在不同页面之间来回切换或重新进入，以确认本地存储读写无遗漏。
3. 若测试中发现数据未按预期刷新，可尝试清理对应的本地存储键（如 `mock_products`、`orders` 等）后重试，并记录复现步骤便于进一步排查。

