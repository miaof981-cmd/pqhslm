# è®¢å•æ•°æ®é“¾è·¯å®Œæ•´åˆ†æ

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šå¤šç”¨æˆ·åœºæ™¯ä¸‹çš„æ•°æ®éš”ç¦»

### âš ï¸ å½“å‰é—®é¢˜è¯†åˆ«

#### é—®é¢˜1ï¼šå·¥ä½œå°æ˜¾ç¤ºæ‰€æœ‰è®¢å•
**å½“å‰é€»è¾‘**ï¼š
```javascript
// workspace/index.js - loadPendingStats()
let allOrders = wx.getStorageSync('pending_orders') || []
```

**é—®é¢˜**ï¼š
- âŒ æ‰€æœ‰ç”¨æˆ·çš„è®¢å•éƒ½å­˜åœ¨åŒä¸€ä¸ª `pending_orders` ä¸­
- âŒ ç”»å¸ˆAèƒ½çœ‹åˆ°ç”»å¸ˆBçš„è®¢å•
- âŒ æ²¡æœ‰æŒ‰ç…§ç”»å¸ˆIDç­›é€‰è®¢å•

**æ­£ç¡®é€»è¾‘åº”è¯¥æ˜¯**ï¼š
```javascript
// åªåŠ è½½å±äºå½“å‰ç”»å¸ˆçš„è®¢å•
const currentUserId = wx.getStorageSync('userId')
let allOrders = wx.getStorageSync('pending_orders') || []
let myOrders = allOrders.filter(order => order.artistId === currentUserId)
```

---

#### é—®é¢˜2ï¼šè®¢å•åˆ›å»ºæ—¶ç¼ºå°‘ç”»å¸ˆID
**å½“å‰é€»è¾‘**ï¼š
```javascript
// order-success/index.js
const newOrder = {
  artistName: orderInfo.artistName,  // âœ… æœ‰ç”»å¸ˆæ˜µç§°
  // âŒ ç¼ºå°‘ artistId
}
```

**é—®é¢˜**ï¼š
- æ²¡æœ‰ä¿å­˜ç”»å¸ˆçš„ userId
- æ— æ³•æŒ‰ç”»å¸ˆIDç­›é€‰è®¢å•

**éœ€è¦æ·»åŠ **ï¼š
```javascript
const newOrder = {
  artistId: orderInfo.artistId,      // âœ… æ·»åŠ ç”»å¸ˆID
  artistName: orderInfo.artistName,
  artistAvatar: orderInfo.artistAvatar,  // âœ… æ·»åŠ ç”»å¸ˆå¤´åƒ
}
```

---

#### é—®é¢˜3ï¼šå®¢æœä¿¡æ¯åˆ†é…é€»è¾‘ç¼ºå¤±
**å½“å‰é€»è¾‘**ï¼š
```javascript
serviceName: 'å¾…åˆ†é…',
serviceAvatar: '/assets/default-avatar.png'
```

**é—®é¢˜**ï¼š
- âŒ æ‰€æœ‰è®¢å•å®¢æœéƒ½æ˜¯"å¾…åˆ†é…"
- âŒ æ²¡æœ‰å®¢æœåˆ†é…é€»è¾‘
- âŒ å®¢æœæ— æ³•æŸ¥çœ‹è‡ªå·±è´Ÿè´£çš„è®¢å•

**éœ€è¦å®ç°**ï¼š
1. ç®¡ç†å‘˜åˆ†é…å®¢æœç»™è®¢å•
2. ä¿å­˜ `serviceId` å’Œ `serviceName`
3. å®¢æœå·¥ä½œå°åªæ˜¾ç¤ºè‡ªå·±è´Ÿè´£çš„è®¢å•

---

## ğŸ”„ å®Œæ•´æ•°æ®æµç¨‹åˆ†æ

### åœºæ™¯1ï¼šç”¨æˆ·Aä¸‹å•ï¼Œç”»å¸ˆBæ¥å•

```
1. ç”¨æˆ·Aæµè§ˆå•†å“
   â†“
2. å•†å“æ•°æ®åŒ…å«ï¼š
   {
     artistId: 'user-1001',        // ç”»å¸ˆBçš„ID
     artistName: 'ç”»å¸ˆå°æ˜',
     artistAvatar: 'https://...'
   }
   â†“
3. ç”¨æˆ·Aç‚¹å‡»"ç«‹å³è´­ä¹°"
   â†“
4. è·³è½¬åˆ° order-success é¡µé¢ï¼Œæºå¸¦å‚æ•°ï¼š
   - productId
   - artistId  â† âš ï¸ ç›®å‰ç¼ºå¤±
   - artistName
   - artistAvatar  â† âš ï¸ ç›®å‰ç¼ºå¤±
   â†“
5. ä¿å­˜è®¢å•ï¼š
   {
     id: '202510271529058195',
     buyerName: 'ç”¨æˆ·A',          // âœ… ä¸‹å•è€…
     buyerAvatar: 'https://...',
     buyerOpenId: 'oXXXX...',
     
     artistId: 'user-1001',       // âœ… ç”»å¸ˆBçš„ID
     artistName: 'ç”»å¸ˆå°æ˜',
     artistAvatar: 'https://...',
     
     serviceId: '',               // âš ï¸ å¾…åˆ†é…
     serviceName: 'å¾…åˆ†é…',
     serviceAvatar: '/assets/default-avatar.png'
   }
   â†“
6. ç”»å¸ˆBæ‰“å¼€å·¥ä½œå°
   â†“
7. ç­›é€‰è®¢å•ï¼š
   const myOrders = allOrders.filter(o => o.artistId === currentUserId)
   â†“
8. æ˜¾ç¤ºï¼šåªæœ‰ç”»å¸ˆBçš„è®¢å•
```

---

### åœºæ™¯2ï¼šç®¡ç†å‘˜åˆ†é…å®¢æœ

```
1. ç®¡ç†å‘˜åœ¨åå°æŸ¥çœ‹è®¢å•
   â†“
2. é€‰æ‹©è®¢å• â†’ åˆ†é…å®¢æœ
   â†“
3. æ›´æ–°è®¢å•æ•°æ®ï¼š
   {
     serviceId: 'user-2001',      // å®¢æœå°çº¢çš„ID
     serviceName: 'å®¢æœå°çº¢',
     serviceAvatar: 'https://...'
   }
   â†“
4. å®¢æœå°çº¢æ‰“å¼€å·¥ä½œå°
   â†“
5. ç­›é€‰è®¢å•ï¼š
   const myOrders = allOrders.filter(o => o.serviceId === currentUserId)
   â†“
6. æ˜¾ç¤ºï¼šåªæœ‰å®¢æœå°çº¢è´Ÿè´£çš„è®¢å•
```

---

## ğŸ› å½“å‰ä»£ç å­˜åœ¨çš„æ•°æ®æ³„æ¼é£é™©

### é£é™©1ï¼šç”»å¸ˆçœ‹åˆ°æ‰€æœ‰è®¢å•
```javascript
// âŒ é”™è¯¯ç¤ºä¾‹
loadPendingStats() {
  let allOrders = wx.getStorageSync('pending_orders') || []
  // ç›´æ¥æ˜¾ç¤ºæ‰€æœ‰è®¢å•ï¼Œæ²¡æœ‰ç­›é€‰
}
```

### é£é™©2ï¼šå®¢æœåˆ†é…é€»è¾‘ç¼ºå¤±
- æ²¡æœ‰ `serviceId` å­—æ®µ
- æ— æ³•æŒ‰å®¢æœIDç­›é€‰
- å®¢æœæ— æ³•æŸ¥çœ‹è‡ªå·±çš„è®¢å•

### é£é™©3ï¼šå•†å“åˆ›å»ºæ—¶ç¼ºå°‘ç”»å¸ˆID
```javascript
// product-edit/index.js
// âŒ å¯èƒ½ç¼ºå°‘ artistId
const product = {
  artistName: userInfo.nickName,  // åªæœ‰æ˜µç§°
  // ç¼ºå°‘ artistId
}
```

---

## âœ… æ­£ç¡®çš„æ•°æ®ç»“æ„

### è®¢å•æ•°æ®ç»“æ„ï¼ˆå®Œæ•´ç‰ˆï¼‰
```javascript
{
  // è®¢å•åŸºç¡€ä¿¡æ¯
  id: '202510271529058195',
  productId: 'prod-001',
  productName: 'Qç‰ˆå¤´åƒå®šåˆ¶',
  productImage: 'data:image/jpeg;base64,...',
  spec: 'å¤§å¤´/æ‰‹æœºå£çº¸',
  price: '88.00',
  quantity: 1,
  
  // ä¸‹å•è€…ä¿¡æ¯ï¼ˆä¹°å®¶ï¼‰
  buyerId: 'user-3001',                    // âœ… ä¹°å®¶ID
  buyerName: 'ç”¨æˆ·A',
  buyerAvatar: 'https://...',
  buyerOpenId: 'oXXXX...',
  
  // ç”»å¸ˆä¿¡æ¯
  artistId: 'user-1001',                   // âœ… ç”»å¸ˆIDï¼ˆå…³é”®ï¼‰
  artistName: 'ç”»å¸ˆå°æ˜',
  artistAvatar: 'https://...',
  
  // å®¢æœä¿¡æ¯
  serviceId: 'user-2001',                  // âœ… å®¢æœIDï¼ˆå…³é”®ï¼‰
  serviceName: 'å®¢æœå°çº¢',
  serviceAvatar: 'https://...',
  
  // æ—¶é—´ä¿¡æ¯
  createTime: '2025-10-27 15:29:05',
  deadline: '2025-10-30 15:29',
  
  // çŠ¶æ€ä¿¡æ¯
  status: 'inProgress',
  statusText: 'è¿›è¡Œä¸­',
  workCompleted: false,
  workCompleteTime: ''
}
```

---

## ğŸ”§ éœ€è¦ä¿®å¤çš„æ–‡ä»¶

### 1. order-success/index.js
**æ·»åŠ ç”»å¸ˆIDå’Œå¤´åƒ**ï¼š
```javascript
const newOrder = {
  // ...å…¶ä»–å­—æ®µ
  
  // âœ… æ·»åŠ ç”»å¸ˆå®Œæ•´ä¿¡æ¯
  artistId: options.artistId || '',
  artistName: decodeURIComponent(options.artistName || 'ç”»å¸ˆ'),
  artistAvatar: decodeURIComponent(options.artistAvatar || '/assets/default-avatar.png'),
  
  // âœ… æ·»åŠ ä¹°å®¶ID
  buyerId: userId,
  buyerName: userInfo.nickName || 'å®¢æˆ·',
  buyerAvatar: userInfo.avatarUrl || '/assets/default-avatar.png',
}
```

### 2. workspace/index.js
**æŒ‰è§’è‰²ç­›é€‰è®¢å•**ï¼š
```javascript
loadPendingStats() {
  const currentUserId = wx.getStorageSync('userId')
  const { userRole } = this.data
  
  let allOrders = wx.getStorageSync('pending_orders') || []
  
  // âœ… æ ¹æ®è§’è‰²ç­›é€‰è®¢å•
  let myOrders = []
  
  if (userRole === 'artist') {
    // ç”»å¸ˆï¼šåªçœ‹è‡ªå·±çš„è®¢å•
    myOrders = allOrders.filter(o => o.artistId === currentUserId)
  } else if (userRole === 'service') {
    // å®¢æœï¼šåªçœ‹è‡ªå·±è´Ÿè´£çš„è®¢å•
    myOrders = allOrders.filter(o => o.serviceId === currentUserId)
  }
  
  // è®¡ç®—è®¢å•çŠ¶æ€
  myOrders = orderStatusUtil.calculateOrdersStatus(myOrders)
  
  // ...
}
```

### 3. product-detail/index.js
**ä¼ é€’ç”»å¸ˆå®Œæ•´ä¿¡æ¯**ï¼š
```javascript
buyNow() {
  const product = this.data.product
  
  wx.redirectTo({
    url: `/pages/order-success/index?` +
      `productId=${product.id}&` +
      `productName=${encodeURIComponent(product.name)}&` +
      `artistId=${product.artistId || ''}&` +  // âœ… æ·»åŠ 
      `artistName=${encodeURIComponent(product.artistName || 'ç”»å¸ˆ')}&` +
      `artistAvatar=${encodeURIComponent(product.artistAvatar || '')}&`  // âœ… æ·»åŠ 
      // ...å…¶ä»–å‚æ•°
  })
}
```

### 4. product-edit/index.js
**å•†å“åˆ›å»ºæ—¶ä¿å­˜ç”»å¸ˆID**ï¼š
```javascript
const userId = wx.getStorageSync('userId')
const userInfo = wx.getStorageSync('userInfo') || {}

const product = {
  // ...å…¶ä»–å­—æ®µ
  artistId: userId,                      // âœ… ä¿å­˜ç”»å¸ˆID
  artistName: userInfo.nickName || 'ç”»å¸ˆ',
  artistAvatar: userInfo.avatarUrl || '/assets/default-avatar.png'
}
```

---

## ğŸ“ æµ‹è¯•åœºæ™¯

### æµ‹è¯•1ï¼šå¤šç”»å¸ˆåœºæ™¯
```javascript
// åˆ›å»ºä¸¤ä¸ªç”»å¸ˆè´¦å·
// ç”»å¸ˆA: userId = 1001
// ç”»å¸ˆB: userId = 1002

// ç”»å¸ˆAåˆ›å»ºå•†å“ â†’ artistId = 1001
// ç”¨æˆ·ä¸‹å•ç”»å¸ˆAçš„å•†å“ â†’ order.artistId = 1001

// ç”»å¸ˆAç™»å½•å·¥ä½œå° â†’ åªçœ‹åˆ° artistId = 1001 çš„è®¢å• âœ…
// ç”»å¸ˆBç™»å½•å·¥ä½œå° â†’ çœ‹ä¸åˆ°ç”»å¸ˆAçš„è®¢å• âœ…
```

### æµ‹è¯•2ï¼šå®¢æœåœºæ™¯
```javascript
// å®¢æœå°çº¢: userId = 2001
// ç®¡ç†å‘˜åˆ†é…è®¢å•ç»™å®¢æœå°çº¢ â†’ order.serviceId = 2001

// å®¢æœå°çº¢ç™»å½•å·¥ä½œå° â†’ åªçœ‹åˆ° serviceId = 2001 çš„è®¢å• âœ…
```

---

## ğŸ¯ æ€»ç»“

### âŒ å½“å‰é—®é¢˜
1. å·¥ä½œå°æ˜¾ç¤ºæ‰€æœ‰è®¢å•ï¼Œæ²¡æœ‰æŒ‰ç”¨æˆ·ç­›é€‰
2. è®¢å•ç¼ºå°‘ `artistId` å’Œ `serviceId`
3. å•†å“ç¼ºå°‘ `artistId`
4. å®¢æœåŠŸèƒ½ä¸å®Œæ•´

### âœ… éœ€è¦ä¿®å¤
1. è®¢å•æ•°æ®æ·»åŠ  `artistId`ã€`buyerId`ã€`serviceId`
2. å·¥ä½œå°æŒ‰è§’è‰²ç­›é€‰è®¢å•
3. å•†å“æ•°æ®æ·»åŠ ç”»å¸ˆå®Œæ•´ä¿¡æ¯
4. å®Œå–„å®¢æœå·¥ä½œå°åŠŸèƒ½

### ğŸš€ ä¼˜å…ˆçº§
1. **é«˜ä¼˜å…ˆçº§**ï¼šä¿®å¤æ•°æ®éš”ç¦»é—®é¢˜ï¼ˆé˜²æ­¢æ•°æ®æ³„æ¼ï¼‰
2. **ä¸­ä¼˜å…ˆçº§**ï¼šå®Œå–„å®¢æœåŠŸèƒ½
3. **ä½ä¼˜å…ˆçº§**ï¼šä¼˜åŒ–UIå’Œäº¤äº’

