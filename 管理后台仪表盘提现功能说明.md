# ç®¡ç†åå°ä»ªè¡¨ç›˜æç°åŠŸèƒ½è¯´æ˜

## âœ… å·²å®Œæˆ

### åŠŸèƒ½ä½ç½®
**ç®¡ç†åå° â†’ ä»ªè¡¨ç›˜ â†’ æˆ‘çš„æ”¶å…¥å¡ç‰‡**

åœ¨ç®¡ç†åå°çš„ä»ªè¡¨ç›˜é¡¶éƒ¨ï¼ˆæ—¶é—´ç­›é€‰ä¸‹æ–¹ï¼‰ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªç´«è‰²æ¸å˜çš„"æˆ‘çš„æ”¶å…¥"å¡ç‰‡ã€‚

---

## ğŸ“Š æ”¶å…¥å¡ç‰‡æ˜¾ç¤ºå†…å®¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° æˆ‘çš„æ”¶å…¥          [æç°]    â”‚
â”‚    å¼ ä¸‰ Â· è§†é¢‘ä¸“å‘˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Â¥128.50  â”‚  Â¥200.00  â”‚  Â¥71.50  â”‚
â”‚  å¯æç°    â”‚  æ€»åˆ†æˆ    â”‚  å·²æç°  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ˜¾ç¤ºå­—æ®µ
- **å§“åå’Œè§’è‰²**ï¼šä»äººå‘˜ç®¡ç†ä¸­é…ç½®çš„ä¿¡æ¯
- **å¯æç°**ï¼šæ€»åˆ†æˆ - å·²æç°
- **æ€»åˆ†æˆ**ï¼šæ‰€æœ‰è®¢å•åˆ†æˆçš„æ€»å’Œ
- **å·²æç°**ï¼šå·²æˆåŠŸæç°çš„é‡‘é¢

---

## ğŸ¯ æ˜¾ç¤ºæ¡ä»¶

**åªæœ‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰ä¼šæ˜¾ç¤ºè¿™ä¸ªå¡ç‰‡ï¼š**

1. âœ… å½“å‰ç™»å½•ç”¨æˆ·IDåœ¨"äººå‘˜ç®¡ç†"ä¸­æœ‰è®°å½•
2. âœ… è¯¥ç®¡ç†å‘˜çš„"åå°æƒé™"å¼€å…³æ˜¯å¼€å¯çš„
3. âœ… ç³»ç»Ÿèƒ½ä»æœ¬åœ°å­˜å‚¨è¯»å–åˆ°ç®¡ç†å‘˜é…ç½®

---

## ğŸ” æ’æŸ¥æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥äººå‘˜ç®¡ç†é…ç½®

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ§åˆ¶å°è¿è¡Œï¼š

```javascript
const userId = wx.getStorageSync('userId')
console.log('å½“å‰ç™»å½•ç”¨æˆ·ID:', userId)

const staffFinance = require('/utils/staff-finance.js')
const staffList = staffFinance.getStaffList()
console.log('æ‰€æœ‰ç®¡ç†å‘˜:', staffList)

const myStaff = staffList.find(s => String(s.userId) === String(userId))
console.log('æˆ‘çš„ç®¡ç†å‘˜è®°å½•:', myStaff)
```

**é¢„æœŸç»“æœï¼š**
- åº”è¯¥èƒ½æ‰¾åˆ°ä¸€æ¡ç®¡ç†å‘˜è®°å½•
- `userId` åº”è¯¥åŒ¹é…
- `isActive` åº”è¯¥ä¸º `true`

---

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥ç®¡ç†åå°æ•°æ®åŠ è½½

åˆ·æ–°ç®¡ç†åå°ä»ªè¡¨ç›˜ï¼Œåœ¨æ§åˆ¶å°æŸ¥çœ‹ï¼š

```javascript
// åº”è¯¥çœ‹åˆ°è¿™äº›æ—¥å¿—ï¼š
// ğŸ” æ£€æŸ¥ç®¡ç†å‘˜èº«ä»½: { userId: '1001', æ‰¾åˆ°ç®¡ç†å‘˜: true, ç®¡ç†å‘˜ä¿¡æ¯: {...} }
// ğŸ’° ç®¡ç†å‘˜æ”¶å…¥ç»Ÿè®¡: { å§“å: 'XX', æ€»åˆ†æˆ: 0, å·²æç°: 0, å¯æç°: 0 }
```

---

### ç¬¬ä¸‰æ­¥ï¼šæ‰‹åŠ¨åˆ›å»ºæµ‹è¯•æ•°æ®

å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ˜¾ç¤ºï¼Œåœ¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
const staffFinance = require('/utils/staff-finance.js')
const userId = wx.getStorageSync('userId')

// ç¡®ä¿æœ‰ç®¡ç†å‘˜è®°å½•
staffFinance.upsertStaff({
  name: 'æµ‹è¯•ç®¡ç†å‘˜',
  role: 'è§†é¢‘ä¸“å‘˜',
  userId: userId,  // ä½¿ç”¨å½“å‰ç”¨æˆ·ID
  enableShare: true,
  shareAmount: 5,
  isActive: true
})

console.log('âœ… ç®¡ç†å‘˜å·²åˆ›å»ºï¼Œè¯·åˆ·æ–°é¡µé¢')

// é‡æ–°åŠ è½½é¡µé¢æ•°æ®
getCurrentPages()[getCurrentPages().length - 1].loadDashboard()
```

---

### ç¬¬å››æ­¥ï¼šåˆ›å»ºæµ‹è¯•è®¢å•ç”Ÿæˆåˆ†æˆ

```javascript
const staffFinance = require('/utils/staff-finance.js')

// åˆ›å»ºæµ‹è¯•è®¢å•
const testOrder = {
  id: `test_${Date.now()}`,
  fullOrderNo: `TEST${Date.now()}`,
  productId: 'test_product',
  productName: 'æµ‹è¯•å•†å“',
  artistId: '1001',
  status: 'completed',
  completedAt: new Date().toISOString()
}

// ä¿å­˜è®¢å•
const orders = wx.getStorageSync('orders') || []
orders.push(testOrder)
wx.setStorageSync('orders', orders)

// è®°å½•åˆ†æˆ
staffFinance.recordOrderShare(testOrder)

console.log('âœ… æµ‹è¯•è®¢å•å·²åˆ›å»ºå¹¶è®°å½•åˆ†æˆ')

// é‡æ–°åŠ è½½é¡µé¢
getCurrentPages()[getCurrentPages().length - 1].loadDashboard()
```

åˆ·æ–°åï¼Œ"å¯æç°"åº”è¯¥æ˜¾ç¤º `Â¥5.00`

---

## ğŸ’¡ ä½¿ç”¨è¯´æ˜

### æŸ¥çœ‹æ”¶å…¥
1. è¿›å…¥ç®¡ç†åå°
2. é»˜è®¤æ˜¾ç¤ºä»ªè¡¨ç›˜
3. é¡¶éƒ¨ä¼šæ˜¾ç¤º"æˆ‘çš„æ”¶å…¥"å¡ç‰‡

### æç°æ“ä½œ
1. ç‚¹å‡»å¡ç‰‡å³ä¸Šè§’çš„"æç°"æŒ‰é’®
2. è·³è½¬åˆ°æç°é¡µé¢
3. å¯ä»¥æŸ¥çœ‹è¯¦ç»†æ”¶å…¥æ˜ç»†
4. å¡«å†™æç°é‡‘é¢å¹¶æäº¤

---

## ğŸ“‹ æ•°æ®æµç¨‹

```
è®¢å•å®Œæˆ
    â†“
staffFinance.recordOrderShare(order)
    â†“
å†™å…¥ staff_finance_records
    â†“
ç®¡ç†åå°åŠ è½½æ•°æ®
    â†“
loadMyIncome() è®¡ç®—ä½™é¢
    â†“
æ˜¾ç¤º"æˆ‘çš„æ”¶å…¥"å¡ç‰‡
    â†“
ç‚¹å‡»"æç°"æŒ‰é’®
    â†“
è·³è½¬åˆ°æç°é¡µé¢
```

---

## ğŸ¨ æ ·å¼ç‰¹ç‚¹

- **ç´«è‰²æ¸å˜èƒŒæ™¯**ï¼šé†’ç›®çš„è§†è§‰æ•ˆæœ
- **æ¯›ç»ç’ƒæ•ˆæœ**ï¼šæ•°æ®ç»Ÿè®¡åŒºåŸŸä½¿ç”¨åŠé€æ˜èƒŒæ™¯
- **ä¸‰æ å¸ƒå±€**ï¼šå¯æç°ã€æ€»åˆ†æˆã€å·²æç°
- **å“åº”å¼æŒ‰é’®**ï¼šç‚¹å‡»æç°æŒ‰é’®æœ‰ç¼©æ”¾åŠ¨ç”»

---

## âš™ï¸ é…ç½®é¡¹

### ä¿®æ”¹å¡ç‰‡é¢œè‰²
ç¼–è¾‘ `admin/index.wxss`ï¼Œæ‰¾åˆ° `.my-income-card`ï¼š

```css
.my-income-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  /* å¯æ”¹ä¸ºå…¶ä»–æ¸å˜è‰²ï¼Œå¦‚ï¼š
     ç»¿è‰²ï¼š#6BCF7F 0%, #52B788 100%
     æ©™è‰²ï¼š#FF6B6B 0%, #FF8E53 100%
  */
}
```

### è°ƒæ•´å¡ç‰‡ä½ç½®
ç¼–è¾‘ `admin/index.wxml`ï¼Œç§»åŠ¨ `<view wx:if="{{myIncome.isStaff}}" class="my-income-card">` ä»£ç å—

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šå¡ç‰‡ä¸æ˜¾ç¤º
- æ£€æŸ¥æ˜¯å¦åœ¨äººå‘˜ç®¡ç†ä¸­æ·»åŠ äº†å½“å‰ç”¨æˆ·
- ç¡®è®¤"åå°æƒé™"å¼€å…³æ˜¯å¦å¼€å¯
- æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—

### é—®é¢˜2ï¼šä½™é¢ä¸º0
- æ£€æŸ¥æ˜¯å¦æœ‰è®¢å•å®Œæˆ
- æŸ¥çœ‹æ˜¯å¦è®°å½•äº†åˆ†æˆï¼ˆ`staff_finance_records`ï¼‰
- ç¡®è®¤è®¢å•åˆ†æˆå¼€å…³æ˜¯å¦å¼€å¯

### é—®é¢˜3ï¼šæç°æŒ‰é’®æ— ååº”
- æ£€æŸ¥ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸ
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ—¥å¿—
- ç¡®è®¤æç°é¡µé¢è·¯å¾„æ˜¯å¦æ­£ç¡®

---

## ğŸ“ æ¸…ç†æµ‹è¯•æ•°æ®

æµ‹è¯•å®Œæˆåï¼Œæ¸…ç†æµ‹è¯•æ•°æ®ï¼š

```javascript
// åˆ é™¤æµ‹è¯•è®¢å•
const orders = wx.getStorageSync('orders') || []
const cleanedOrders = orders.filter(o => !o.id.startsWith('test_'))
wx.setStorageSync('orders', cleanedOrders)

// åˆ é™¤æµ‹è¯•åˆ†æˆè®°å½•
wx.removeStorageSync('staff_finance_records')

// åˆ é™¤æµ‹è¯•ç®¡ç†å‘˜ï¼ˆå¯é€‰ï¼‰
const staffFinance = require('/utils/staff-finance.js')
const staffList = staffFinance.getStaffList()
const testStaff = staffList.find(s => s.name === 'æµ‹è¯•ç®¡ç†å‘˜')
if (testStaff) {
  staffFinance.removeStaff(testStaff._id)
}

console.log('âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç†')

// åˆ·æ–°é¡µé¢
getCurrentPages()[getCurrentPages().length - 1].loadDashboard()
```
